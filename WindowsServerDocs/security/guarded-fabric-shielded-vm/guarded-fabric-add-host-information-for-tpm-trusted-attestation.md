---
title: Добавление сведений об узле для аттестации с доверенным платформенным модулем
ms.prod: windows-server
ms.topic: article
ms.assetid: f0aa575b-b34e-4f6c-8416-ed3e398e0ad2
manager: dongill
author: rpsqrd
ms.author: ryanpu
ms.technology: security-guarded-fabric
ms.date: 06/21/2019
ms.openlocfilehash: cfc1d0d2b99a79e6c1deb013fab350e3abc6167c
ms.sourcegitcommit: acfdb7b2ad283d74f526972b47c371de903d2a3d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2020
ms.locfileid: "87769672"
---
# <a name="add-host-information-for-tpm-trusted-attestation"></a>Добавление сведений об узле для аттестации с доверенным платформенным модулем

> Область применения: Windows Server 2019, Windows Server (половина ежегодного канала), Windows Server 2016

Для режима TPM администратор структуры захватывает три типа информации об узле, каждый из которых необходимо добавить в конфигурацию HGS:

- Идентификатор TPM (Екпуб) для каждого узла Hyper-V
- Политики целостности кода — белый список разрешенных двоичных файлов для узлов Hyper-V.
- Базовый уровень TPM (измерения загрузки), представляющий набор узлов Hyper-V, работающих на одном и том же классе оборудования.

После того как администратор Fabric захватывает сведения, добавьте его в конфигурацию HGS, как описано в следующей процедуре.

1. Получите XML-файлы, содержащие сведения о Екпуб, и скопируйте их на сервер HGS. Для каждого узла будет один XML-файл. Затем в консоли Windows PowerShell с повышенными привилегиями на сервере HGS выполните следующую команду. Повторите команду для каждого из XML-файлов.

    ```powershell
    Add-HgsAttestationTpmHost -Path <Path><Filename>.xml -Name <HostName>
    ```

    > [!NOTE]
    > Если при добавлении идентификатора TPM к сертификату ненадежного ключа подтверждения (Екцерт) возникает ошибка, убедитесь, что [корневые сертификаты доверенного платформенного модуля были добавлены](guarded-fabric-install-trusted-tpm-root-certificates.md) в узел HGS.
    > Кроме того, некоторые поставщики TPM не используют Екцертс.
    > Чтобы проверить, отсутствует ли Екцерт, Откройте XML-файл в редакторе, таком как Блокнот, и проверьте сообщение об ошибке, указывающее, что Екцерт не найден.
    > Если это так и вы доверяете доверенному платформенному модулю на компьютере, можно использовать `-Force` флаг, чтобы переопределить эту проверку безопасности и добавить идентификатор узла в HGS.

2. Получите политику целостности кода, созданную администратором структуры для узлов, в двоичном формате ( \* . p7b). Скопируйте его на сервер HGS. Затем выполните следующую команду.

    Для `<PolicyName>` Укажите имя для политики CI, описывающее тип узла, к которому она применяется. Рекомендуется присвоить ей имя после создания или модели компьютера, а также выполнить на нем специальную конфигурацию программного обеспечения.<br>Для `<Path>` укажите путь и имя файла политики целостности кода.

    ```powershell
    Add-HgsAttestationCIPolicy -Path <Path> -Name '<PolicyName>'
    ```

    > [!NOTE]
    > Если вы используете политику целостности подписанного кода, зарегистрируйте неподписанную копию той же политики с помощью HGS.
    > Подпись в политиках целостности кода используется для управления обновлениями политики, но не измеряется в доверенном платформенном модуле и поэтому не может быть подтверждена службой HGS.

3. Получите файл журнала TCG, захваченный администратором структуры на узле-образце. Скопируйте файл на сервер HGS. Затем выполните следующую команду. Как правило, политика будет названа после класса оборудования, который она представляет (например, «редакция модели изготовителя»).

    ```powershell
    Add-HgsAttestationTpmPolicy -Path <Filename>.tcglog -Name '<PolicyName>'
    ```

Это завершает процесс настройки кластера HGS для работы в режиме TPM. Администратору структуры может потребоваться предоставить два URL-адреса из HGS, прежде чем можно будет завершить настройку для узлов. Чтобы получить эти URL-адреса, на сервере HGS выполните команду [Get-HgsServer](https://docs.microsoft.com/powershell/module/hgsserver/get-hgsserver?view=win10-ps).

## <a name="next-step"></a>Следующий шаг

> [Подтверждение аттестации](guarded-fabric-confirm-hosts-can-attest-successfully.md)
