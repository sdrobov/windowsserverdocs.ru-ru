---
title: Архитектура интерфейса поставщика поддержки безопасности
description: Безопасность Windows Server
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: de09e099-5711-48f8-adbd-e7b8093a0336
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 4db407b24b00bc8313d2e17f1fcf55d9fa160c8c
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71403306"
---
# <a name="security-support-provider-interface-architecture"></a>Архитектура интерфейса поставщика поддержки безопасности

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

В этом справочном разделе по ИТ-специалисту описываются протоколы проверки подлинности Windows, которые используются в архитектуре интерфейса поставщика поддержки безопасности (SSPI).

В качестве основы для проверки подлинности Windows используется интерфейс SSPI (Майкрософт). Приложения и службы инфраструктуры, требующие проверки подлинности, используют SSPI, чтобы предоставить его.

SSPI — это реализация универсального API службы безопасности (GSSAPI) в операционных системах Windows Server. Дополнительные сведения о GSSAPI см. в документе RFC 2743 и RFC 2744 в базе данных IETF RFC.

Поставщики услуг обеспечения безопасности по умолчанию (SSP), которые вызывают определенные протоколы проверки подлинности в Windows, включены в SSPI как библиотеки DLL. Эти SSP по умолчанию описаны в следующих разделах. Дополнительные SSP можно включать, если они могут работать с SSPI.

Как показано на следующем рисунке, SSPI в Windows предоставляет механизм, который передает маркеры проверки подлинности по существующему каналу связи между клиентским компьютером и сервером. Если необходимо проверить подлинность двух компьютеров или устройств, чтобы они могли безопасно обмениваться данными, запросы на проверку подлинности направляются на SSPI, что завершает процесс проверки подлинности, независимо от используемого в данный момент сетевого протокола. SSPI возвращает прозрачные большие двоичные объекты. Они передаются между приложениями, после чего они могут быть переданы на уровень SSPI. Таким образом, SSPI позволяет приложению использовать различные модели безопасности, доступные на компьютере или в сети, не изменяя интерфейс до системы безопасности.

![Схема, демонстрирующая архитектуру интерфейса поставщика поддержки безопасности](../media/security-support-provider-interface-architecture/AuthN_SecuritySupportProviderInterfaceArchitecture.jpg)

В следующих разделах описываются SSP по умолчанию, взаимодействующие с SSPI. SSP используются различными способами в операционных системах Windows для повышения безопасности обмена данными в незащищенной сетевой среде.

-   [Поставщик поддержки безопасности Kerberos](#BKMK_KerbSSP)

-   [Поставщик поддержки безопасности NTLM](#BKMK_NTLMSSP)

-   [Поставщик поддержки дайджест-безопасности](#BKMK_DigestSSP)

-   [Поставщик поддержки безопасности SChannel](#BKMK_SchannelSSP)

-   [Согласование поставщика поддержки безопасности](#BKMK_NegoSSP)

-   [Поставщик поддержки безопасности учетных данных](#BKMK_CredSSP)

-   [Поставщик поддержки безопасности расширений Negotiate](#BKMK_NegoExtsSSP)

-   [Поставщик поддержки безопасности PKU2U](#BKMK_PKU2USSP)

Также включается в этот раздел:

[Выбор поставщика поддержки безопасности](security-support-provider-interface-architecture.md#BKMK_SecuritySupportProviderSelection)

### <a name="BKMK_KerbSSP"></a>Поставщик поддержки безопасности Kerberos
Этот поставщик общих служб использует только протокол Kerberos версии 5, реализованный корпорацией Майкрософт. Этот протокол основан на стандартах RFC 4120 и черновой версии рабочей группы сети. Это Стандартный промышленный протокол, который используется с паролем или смарт-картой для интерактивного входа в систему. Он также является предпочтительным методом проверки подлинности для служб в Windows.

Поскольку протокол Kerberos был протоколом проверки подлинности по умолчанию, начиная с Windows 2000, все доменные службы поддерживают SSP Kerberos. Доступны следующие службы:

-   Запросы Active Directory, использующие протокол LDAP

-   Удаленное управление сервером или рабочей станцией, использующее службу удаленного вызова процедур

-   Службы печати

-   Проверка подлинности клиента и сервера

-   Удаленный доступ к файлам, использующий протокол SMB (также известный как обычная файловая система Internet System или CIFS)

-   Управление распределенной файловой системой и ссылки

-   Проверка подлинности в интрасети для службы IIS (IIS)

-   Проверка подлинности в центре безопасности для протокола IPsec

-   Запросы сертификатов для Active Directory служб сертификатов для пользователей и компьютеров домена

Расположение:%windir%\Windows\System32\kerberos.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применимо к** в начале этого раздела, а также в windows Server 2003 и Windows XP.

**Дополнительные ресурсы по протоколу Kerberos и поставщику общих служб Kerberos**

-   [Microsoft Kerberos (Windows)](https://msdn.microsoft.com/library/aa378747(VS.85).aspx)

-   [ @ NO__T-1 МС-КИЛЕ @ NO__T-2: Расширения протокола Kerberos @ no__t-0

-   [ @ NO__T-1 МС-SFU @ NO__T-2: Расширения протокола Kerberos: Служба для спецификации протокола ограниченного делегирования "no__t-0"

-   [Kerberos SSP/AP (Windows)](https://msdn.microsoft.com/library/aa377942(VS.85).aspx)

-   [Усовершенствования Kerberos](https://technet.microsoft.com/library/cc749438(v=ws.10).aspx) для Windows Vista

-   [Изменения проверки подлинности Kerberos](https://technet.microsoft.com/library/dd560670(v=ws.10).aspx) для Windows 7 

-   [Технический справочник по проверке подлинности Kerberos](https://technet.microsoft.com/library/cc739058(v=ws.10).aspx)

### <a name="BKMK_NTLMSSP"></a>Поставщик поддержки безопасности NTLM
Поставщик поддержки NTLM (NTLM SSP) — это протокол двоичного обмена сообщениями, используемый интерфейсом поставщика услуг обеспечения безопасности (SSPI) для разрешения проверки подлинности NTLM и ответа, а также для согласования параметров целостности и конфиденциальности. NTLM используется везде, где используется Аутентификация SSPI, в том числе для блока сообщений сервера или проверки подлинности CIFS, проверки подлинности HTTP Negotiate (например, веб-проверки подлинности в Интернете) и службы удаленного вызова процедур. В состав NTLM SSP входят протоколы проверки подлинности NTLM и NTLM версии 2 (NTLMv2).

Поддерживаемые операционные системы Windows могут использовать поставщик общих служб NTLM для следующих действий:

-   Проверка подлинности клиента и сервера

-   Службы печати

-   Доступ к файлам с помощью протокола CIFS (SMB)

-   Безопасная служба удаленного вызова процедур или служба DCOM

Расположение:%windir%\Windows\System32\msv1_0.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применимо к** в начале этого раздела, а также в windows Server 2003 и Windows XP.

**Дополнительные ресурсы по протоколу NTLM и поставщику общих служб NTLM**

-   [Пакет проверки подлинности MSV1_0 (Windows)](https://msdn.microsoft.com/library/aa378753(VS.85).aspx)

-   [Изменения в проверке подлинности NTLM](https://technet.microsoft.com/library/dd566199(v=ws.10).aspx) в Windows 7 

-   [Microsoft NTLM (Windows)](https://msdn.microsoft.com/library/aa378749(VS.85).aspx)

-   [Аудит и запрещение рекомендаций по использованию NTLM](https://technet.microsoft.com/library/jj865674(v=ws.10).aspx)

### <a name="BKMK_DigestSSP"></a>Поставщик поддержки дайджест-безопасности
Дайджест-проверка подлинности — это промышленный стандарт, который используется для проверки подлинности через протокол LDAP и Web. При дайджест-проверке подлинности учетные данные передаются по сети в виде хэша MD5 или дайджеста сообщения.

Дайджест-файл SSP (WDigest. dll) используется для следующих действий:

-   Доступ к Internet Explorer и службы IIS (IIS)

-   Запросы LDAP

Расположение:%windir%\Windows\System32\Digest.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применимо к** в начале этого раздела, а также в windows Server 2003 и Windows XP.

**Дополнительные ресурсы для протокола дайджеста и дайджест-поставщика общих служб**

-   [Дайджест-проверка подлинности Microsoft (Windows)](https://msdn.microsoft.com/library/aa378745(VS.85).aspx)

-   [ @ NO__T-1 МС-ДПСП @ NO__T-2: Расширения протокола Digest @ no__t-0

### <a name="BKMK_SchannelSSP"></a>Поставщик поддержки безопасности SChannel
Безопасный канал (Schannel) используется для проверки подлинности на основе веб-сервера, например, когда пользователь пытается получить доступ к защищенному веб-серверу.

Протокол TLS, протокол SSL, протокол шифрования (PCT) и Протокол датаграмм (DTLS) основаны на криптографии с открытым ключом. Schannel предоставляет все эти протоколы. Для всех протоколов канала SCHANNEL используется модель клиент-сервер. Schannel SSP использует сертификаты открытого ключа для проверки подлинности сторон. При проверке подлинности для поставщика услуг SChannel SSP выбирает протокол в следующем порядке предпочтения:

-   Безопасность транспортного уровня (TLS) версии 1,0

-   Безопасность транспортного уровня (TLS) версии 1,1

-   Безопасность транспортного уровня (TLS) версии 1,2

-   Протокол SSL версии 2,0

-   Протокол SSL версии 3,0

-   Технология частной связи (PCT)

    **Примечание** . По умолчанию PCT отключен.

Выбранный протокол является предпочтительным протоколом проверки подлинности, который может поддерживаться клиентом и сервером. Например, если сервер поддерживает все протоколы SChannel, а клиент поддерживает только SSL 3,0 и SSL 2,0, то процесс проверки подлинности использует SSL 3,0.

DTLS используется при явном вызове приложением. Дополнительные сведения о DTLS и других протоколах, используемых поставщиком SChannel, см. в статье [техническое руководство по поставщику поддержки безопасности SChannel](../tls/schannel-security-support-provider-technical-reference.md).

Расположение:%windir%\Windows\System32\Schannel.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применимо к** в начале этого раздела, а также в windows Server 2003 и Windows XP.

> [!NOTE]
> Протокол TLS 1,2 появился в этом поставщике в Windows Server 2008 R2 и Windows 7. DTLS был введен в этот поставщик в Windows Server 2012 и Windows 8.

**Дополнительные ресурсы по протоколам TLS и SSL и поставщику общих служб SChannel**

-   [Безопасный канал (Windows)](https://msdn.microsoft.com/library/aa380123(VS.85).aspx)

-   [Технический справочник по TLS/SSL](https://technet.microsoft.com/library/cc784149(v=ws.10).aspx)

-   [ @ NO__T-1 МС-ТЛСП @ NO__T-2: Профиль безопасности транспортного уровня (TLS) @ no__t-0

### <a name="BKMK_NegoSSP"></a>Согласование поставщика поддержки безопасности
Простой и защищенный механизм согласования с API GSS (SPNEGO) образует базу для согласованного поставщика общих служб (вхичкан), который используется для согласования определенного протокола проверки подлинности. Когда приложение обращается к SSPI для входа в сеть, оно может указать поставщика общих служб для обработки запроса. Если приложение указывает на согласованный поставщик общих служб, он анализирует запрос и выбирает соответствующего поставщика для выполнения запроса на основе настроенных пользователем политик безопасности.

SPNEGO указывается в RFC 2478.

В поддерживаемых версиях операционных систем Windows поставщик поддержки согласования безопасности выбирает между протоколом Kerberos и NTLM. Согласование выбирает протокол Kerberos по умолчанию, если только этот протокол не может использоваться одной из систем, участвующих в проверке подлинности, или вызывающее приложение не предоставил достаточно сведений для использования протокола Kerberos.

Расположение:%windir%\Windows\System32\lsasrv.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применимо к** в начале этого раздела, а также в windows Server 2003 и Windows XP.

**Дополнительные ресурсы для согласованного поставщика общих служб**

-   [Microsoft Negotiate (Windows)](https://msdn.microsoft.com/library/aa378748(VS.85).aspx)

-   [ @ NO__T-1 МС-СПНГ @ NO__T-2: Простые и защищенные расширения GSS-API (SPNEGO) @ no__t-0

-   [ @ NO__T-1 МС-N2HT @ NO__T-2: Согласование и Nego2 спецификация протокола проверки подлинности HTTP @ no__t-0

### <a name="BKMK_CredSSP"></a>Поставщик поддержки безопасности учетных данных
Поставщик службы безопасности учетных данных (CredSSP) обеспечивает взаимодействие с пользователем единого входа (SSO) при запуске новых служб терминалов и службы удаленных рабочих столов сеансов. CredSSP позволяет приложениям делегировать учетные данные пользователей с клиентского компьютера (с помощью клиентского поставщика общих служб) целевому серверу (через серверный поставщик общих служб) на основе политик клиента. Политики CredSSP настраиваются с помощью групповая политика, а делегирование учетных данных по умолчанию отключено.

Расположение:%windir%\Windows\System32\credssp.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применяется к** в начале этого раздела.

**Дополнительные ресурсы для поставщика общих служб учетных данных**

-   [ @ NO__T-1 МС-КССП @ NO__T-2: Спецификация протокола службы поддержки безопасности учетных данных (CredSSP) @ no__t-0

-   [Поставщик службы безопасности учетных данных и единый вход для служб терминалов](https://technet.microsoft.com/library/cc749211(v=ws.10).aspx)

### <a name="BKMK_NegoExtsSSP"></a>Поставщик поддержки безопасности расширений Negotiate
Negotiate Extensions (Негоекстс) — это пакет проверки подлинности, который согласовывает использование SSP, кроме NTLM или протокола Kerberos, для приложений и сценариев, реализованных корпорацией Майкрософт и другими компаниями-поставщиками программного обеспечения.

Это расширение для пакета Negotiate позволяет выполнять следующие сценарии.

-   **Широкая доступность клиентов в федеративной системе.** Документы могут быть доступны на сайтах SharePoint, и их можно редактировать с помощью полнофункционального Microsoft Office приложения.

-   **Полнофункциональная поддержка клиентов для служб Microsoft Office.** Пользователи могут входить в Microsoft Office службы и использовать полнофункциональное приложение Microsoft Office.

-   **Размещен Microsoft Exchange Server и Outlook.** Доверие между доменами не установлено, так как сервер Exchange Server размещен в Интернете. Outlook использует службу Windows Live для проверки подлинности пользователей.

-   **Широкая доступность клиентов между клиентскими компьютерами и серверами.** Используются компоненты сети и проверки подлинности операционной системы.

Пакет Negotiate для Windows обрабатывает SSP Негоекстс так же, как и для Kerberos и NTLM. Негоекстс. dll загружается в локальный системный администратор (LSA) при запуске. При получении запроса на проверку подлинности на основе источника запроса Негоекстс согласовывает поддерживаемые SSP. Он собирает учетные данные и политики, шифрует их и отправляет эти сведения соответствующему поставщику общих служб, в котором создается маркер безопасности.

SSP, поддерживаемые Негоекстс, не являются изолированными SSP, такими как Kerberos и NTLM. Поэтому в Негоекстс SSP, когда метод проверки подлинности завершается неудачей по какой бы то ни было причине, будет выведено сообщение о сбое проверки подлинности. Нет возможных методов повторного согласования или резервной проверки подлинности.

Расположение:%windir%\Windows\System32\negoexts.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применяется к** в начале этого раздела, за исключением windows Server 2008 и Windows Vista.

### <a name="BKMK_PKU2USSP"></a>Поставщик поддержки безопасности PKU2U
Протокол PKU2U появился и реализован в качестве поставщика общих служб в Windows 7 и Windows Server 2008 R2. Этот поставщик общих служб обеспечивает одноранговую проверку подлинности, в частности, с помощью функции мультимедиа и общего доступа к файлам, которая появилась в Windows 7. Эта функция позволяет совместно использовать компьютеры, не входящие в домен.

Расположение:%windir%\Windows\System32\pku2u.dll

Этот поставщик включен по умолчанию в версии, указанные в списке **применяется к** в начале этого раздела, за исключением windows Server 2008 и Windows Vista.

**Дополнительные ресурсы по протоколу PKU2U и поставщику общих служб PKU2U**

-   [Знакомство с интеграцией сетевых удостоверений](https://technet.microsoft.com/library/dd560662(v=ws.10).aspx)

## <a name="BKMK_SecuritySupportProviderSelection"></a>Выбор поставщика поддержки безопасности
Windows SSPI может использовать любой протокол, поддерживаемый с помощью установленных поставщиков поддержки безопасности. Однако, поскольку не все операционные системы поддерживают те же пакеты SSP, что и компьютер под управлением Windows Server, клиенты и серверы должны согласовать протокол, который они поддерживают. Windows Server предпочитает клиентским компьютерам и приложениям использовать протокол Kerberos — надежный протокол на основе стандартов, если это возможно, но операционная система по-своему может разрешить клиентским компьютерам и клиентским приложениям, которые не поддерживают Kerberos. Протокол для проверки подлинности.

Перед проверкой подлинности два взаимодействующих компьютера должны согласовать протокол, который они могут поддерживать. Для использования любого протокола с помощью SSPI каждый компьютер должен иметь соответствующий поставщик общих служб. Например, чтобы клиентский компьютер и сервер использовали протокол проверки подлинности Kerberos, они должны поддерживать протокол Kerberos V5. Windows Server использует функцию **енумератесекуритипаккажес** , чтобы определить, какие SSP поддерживаются на компьютере и каковы возможности этих SSP.

Выбор протокола проверки подлинности может обрабатываться одним из следующих двух способов.

1.  [Протокол одиночной проверки подлинности](#BKMK_SingleAuth)

2.  [Параметр Negotiate](#BKMK_Negotiate)

### <a name="BKMK_SingleAuth"></a>Протокол одиночной проверки подлинности
Если на сервере указан один допустимый протокол, клиентский компьютер должен поддерживать указанный протокол или сбой связи. Если указан один допустимый протокол, Обмен данными проверки подлинности выполняется следующим образом:

1.  Клиентский компьютер запрашивает доступ к службе.

2.  Сервер отвечает на запрос и указывает протокол, который будет использоваться.

3.  Клиентский компьютер проверяет содержимое ответа и проверяет, поддерживает ли он указанный протокол. Если клиентский компьютер поддерживает указанный протокол, проверка подлинности продолжится. Если клиентский компьютер не поддерживает протокол, проверка подлинности завершится неудачей независимо от того, имеет ли клиентский компьютер права доступа к ресурсу.

### <a name="BKMK_Negotiate"></a>Параметр Negotiate
Параметр Negotiate можно использовать для того, чтобы клиент и сервер пытались найти допустимый протокол. Это основано на простом и защищенном механизме согласования GSS-API (SPNEGO). Когда проверка подлинности начинается с параметра для согласования по протоколу проверки подлинности, Обмен SPNEGO выполняется следующим образом:

1.  Клиентский компьютер запрашивает доступ к службе.

2.  Сервер отвечает со списком протоколов проверки подлинности, которые он может поддерживать, и запросом проверки подлинности или ответом на основе протокола, который является первым выбором. Например, сервер может перечислить протокол Kerberos и NTLM и отправить ответ проверки подлинности Kerberos.

3.  Клиентский компьютер проверяет содержимое ответа и проверяет, поддерживает ли он любой из указанных протоколов.

    -   Если клиентский компьютер поддерживает предпочтительный протокол, проверка подлинности продолжается.

    -   Если клиентский компьютер не поддерживает предпочтительный протокол, но поддерживает один из других протоколов, указанных сервером, клиентский компьютер позволяет серверу выяснить, какой протокол проверки подлинности он поддерживает, а проверка подлинности продолжается.

    -   Если клиентский компьютер не поддерживает ни один из перечисленных протоколов, происходит сбой обмена аутентификацией.

## <a name="see-also"></a>См. также
[Архитектура проверки подлинности Windows](https://technet.microsoft.com/library/dn169024(v=ws.10).aspx)


