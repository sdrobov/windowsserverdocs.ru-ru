---
title: Процедуры с учетными данными в проверке подлинности Windows
description: Безопасность Windows Server
ms.prod: windows-server
ms.technology: security-windows-auth
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 2de8383ce6a946dfdd80cfc027478c495037169b
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80857587"
---
# <a name="credentials-processes-in-windows-authentication"></a>Процедуры с учетными данными в проверке подлинности Windows

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

В этом справочном разделе для ИТ – специалиста описано, как проверка подлинности Windows обрабатывает учетные данные.

Управление учетными данными Windows — это процесс, с помощью которого операционная система получает учетные данные от службы или пользователя и защищает эту информацию для будущего представления целевому объекту, выполняющему проверку подлинности. В случае компьютера, присоединенного к домену, целевой объект, выполняющий проверку подлинности, является контроллером домена. Учетные данные, используемые при проверке подлинности, представляют собой цифровые документы, связывающие удостоверение пользователя с какой-либо формой подтверждения подлинности, например сертификатом, паролем или закреплением.

По умолчанию учетные данные Windows проверяются по базе данных диспетчера учетных записей безопасности (SAM) на локальном компьютере или на Active Directory на компьютере, присоединенном к домену, через службу Winlogon. Учетные данные собираются с помощью пользовательского интерфейса входа в систему или программным путем через интерфейс прикладного программирования (API), который должен быть представлен целевой базе данных для проверки подлинности.

Локальная информация о безопасности хранится в реестре в разделе **HKEY_LOCAL_MACHINE \секурити**. Сохраненные сведения включают параметры политики, значения безопасности по умолчанию и сведения об учетной записи, например кэшированные учетные данные для входа. Также хранится копия базы данных SAM, хотя она защищена от записи.

На следующей схеме показаны необходимые компоненты и пути, которые проходят через систему для проверки подлинности пользователя или процесса при успешном входе.

![Схема, на которой показаны необходимые компоненты и пути, переданные по системе для проверки подлинности пользователя или процесса при успешном входе в систему.](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

В следующей таблице описаны все компоненты, управляющие учетными данными в процессе проверки подлинности в момент входа в систему.

**Компоненты проверки подлинности для всех систем**

|Component|Описание|
|-------|--------|
|Вход пользователя в систему|Winlogon. exe — это исполняемый файл, отвечающий за управление взаимодействием безопасных пользователей. Служба Winlogon инициирует процесс входа для операционных систем Windows, передавая учетные данные, собранные действием пользователя на защищенном рабочем столе (в пользовательском интерфейсе входа), в локальный центр безопасности (LSA) через Secur32. dll.|
|Вход в приложение|Вход в приложение или службу, для которых не требуется интерактивный вход. Большинство процессов, инициированных пользователем, выполняются в пользовательском режиме с помощью Secur32. dll, а процессы, инициированные при запуске, такие как службы, выполняются в режиме ядра с помощью Ксекдд. sys.<p>Дополнительные сведения о пользовательском режиме и режиме ядра см. в разделе приложения и пользовательский режим или службы и режим ядра в этой статье.|
|Secur32.dll|Несколько поставщиков проверки подлинности, образующих основу процесса проверки подлинности.|
|Lsasrv.dll|Служба LSA Server, которая применяет политики безопасности и выступает в качестве диспетчера пакетов безопасности для LSA. LSA содержит функцию Negotiate, которая выбирает протокол NTLM или Kerberos после определения того, какой протокол должен быть успешным.|
|Поставщики поддержки безопасности|Набор поставщиков, которые могут по отдельности вызывать один или несколько протоколов проверки подлинности. Набор поставщиков по умолчанию может меняться в каждой версии операционной системы Windows, а пользовательские поставщики могут быть написаны.|
|Netlogon.dll|Служба Net Logon выполняет следующие службы:<p>— Обслуживает безопасный канал компьютера (не путать с Schannel) с контроллером домена.<br />— Передает учетные данные пользователя по безопасному каналу на контроллер домена и возвращает идентификаторы безопасности домена (SID) и права пользователя для пользователя.<br />— Публикует записи ресурсов службы в системе доменных имен (DNS) и использует DNS для разрешения имен в IP-адреса контроллеров домена.<br />— Реализует протокол репликации на основе удаленного вызова процедур (RPC) для синхронизации основных контроллеров домена (PDC) и резервных контроллеров домена (BDC).|
|Самсрв. dll|Диспетчер учетных записей безопасности (SAM), в котором хранятся локальные учетные записи безопасности, обеспечивает применение локально хранимых политик и поддерживает интерфейсы API.|
|Реестр|Реестр содержит копию базы данных SAM, параметры локальной политики безопасности, значения безопасности по умолчанию и сведения об учетной записи, которые доступны только системе.|

В этом разделе содержатся следующие подразделы:

-   [Ввод учетных данных для входа пользователя](#BKMK_CrentialInputForUserLogon)

-   [Ввод учетных данных для входа в приложение и службу](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [Локальный центр безопасности](#BKMK_LSA)

-   [Кэшированные учетные данные и проверка](#BKMK_CachedCredentialsAndValidation)

-   [Хранилище учетных данных и проверка](#BKMK_CredentialStorageAndValidation)

-   [База данных диспетчера учетных записей безопасности](#BKMK_SAM)

-   [Локальные домены и доверенные домены](#BKMK_LocalDomainsAndTrustedDomains)

-   [Сертификаты в проверке подлинности Windows](#BKMK_CertificatesInWindowsAuthentication)

## <a name="credential-input-for-user-logon"></a><a name="BKMK_CrentialInputForUserLogon"></a>Ввод учетных данных для входа пользователя
В Windows Server 2008 и Windows Vista Архитектура графической идентификации и аутентификации (GINA) была заменена моделью поставщика учетных данных, которая позволяет перечислить различные типы входа с помощью плиток входа в систему. Обе модели описаны ниже.

**Графическая идентификация и архитектура проверки подлинности**

Архитектура модели для идентификации и проверки подлинности (GINA) относится к операционным системам Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Windows 2000 Professional. В этих системах каждый интерактивный сеанс входа в систему создает отдельный экземпляр службы WinLogon. Архитектура GINA загружается в пространство процесса, используемое Winlogon, получает и обрабатывает учетные данные и выполняет вызовы интерфейсов проверки подлинности через Лсалогонусер.

Экземпляры Winlogon для интерактивного входа в сеанс 0. В сеансе 0 размещаются системные службы и другие критические процессы, в том числе процесс локального центра безопасности (LSA).

На следующей схеме показан процесс учетных данных для Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Microsoft Windows 2000 Professional.

![Схема, демонстрирующая процесс учетных данных для Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Microsoft Windows 2000 Professional](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**Архитектура поставщика учетных данных**

Архитектура поставщика учетных данных применяется к версиям, указанным в списке **применяется к** в начале этого раздела. В этих системах архитектура ввода учетных данных изменилась на расширяемую структуру, используя поставщики учетных данных. Эти поставщики представлены разными плитками для входа в систему на защищенном рабочем столе, где разрешено любое количество сценариев входа в систему — разные учетные записи одного и того же пользователя и разные методы проверки подлинности, такие как пароль, смарт-карта и биометрия.

При использовании архитектуры поставщика учетных данных Winlogon всегда запускает пользовательский интерфейс входа после получения события безопасной последовательности. Пользовательский интерфейс входа запрашивает у каждого поставщика учетных данных количество различных типов учетных данных, для которых настроен поставщик. Поставщики учетных данных имеют возможность указать одну из этих плиток по умолчанию. Когда все поставщики перечисляют плитки, Пользовательский интерфейс входа отображает их пользователю. Пользователь взаимодействует с плиткой для предоставления своих учетных данных. Пользовательский интерфейс входа отправляет эти учетные данные для проверки подлинности.

Поставщики учетных данных не являются механизмами принудительного применения. Они используются для сбора и сериализации учетных данных. Локальный центр безопасности и пакеты проверки подлинности обеспечивают безопасность.

Поставщики учетных данных регистрируются на компьютере и отвечают за следующее:

-   Описание учетных данных, необходимых для проверки подлинности.

-   Обработка связи и логики с внешними центрами проверки подлинности.

-   Упаковка учетных данных для интерактивного входа в сеть.

Пакетные учетные данные для интерактивного входа в систему и подключения к сети включают процесс сериализации. Путем сериализации учетных данных плитки для входа в систему могут отображаться в пользовательском интерфейсе входа. Таким образом, ваша организация может управлять отображением входа в систему, таким как пользователи, целевые системы для входа в систему, предварительный доступ к политикам блокировки и разблокировки рабочей станции, используя настроенные поставщики учетных данных. На одном компьютере может существовать несколько поставщиков учетных данных.

Поставщики единого входа (SSO) можно разрабатывать как стандартный поставщик учетных данных или как поставщик предварительного доступа для входа.

Каждая версия Windows содержит один поставщик учетных данных по умолчанию и один поставщик предварительного доступа по умолчанию (PLAP), также известный как поставщик единого входа. Поставщик единого входа позволяет пользователям устанавливать подключение к сети перед входом на локальный компьютер. При реализации этого поставщика поставщик не перечислит плитки в пользовательском интерфейсе входа.

Поставщик единого входа предназначен для использования в следующих сценариях:

-   **Проверка подлинности сети и вход в систему осуществляется разными поставщиками учетных данных.** К этому сценарию относятся следующие варианты:

    -   Пользователь имеет возможность подключиться к сети, например подключение к виртуальной частной сети (VPN), прежде чем войти на компьютер, но это подключение не требуется.

    -   Для получения сведений, используемых во время интерактивной проверки подлинности на локальном компьютере, требуется проверка подлинности сети.

    -   За несколько проверок подлинности сети следует один из других сценариев. Например, пользователь проходит проверку подлинности в поставщике услуг Интернета (ISP), выполняет проверку подлинности в VPN, а затем использует учетные данные учетной записи пользователя для локального входа.

    -   Кэшированные учетные данные отключены, а подключение к службам удаленного доступа через VPN необходимо перед локальным входом для проверки подлинности пользователя.

    -   У пользователя домена нет локальной учетной записи, настроенной на компьютере, присоединенном к домену, и перед завершением интерактивного входа необходимо установить подключение к службам удаленного доступа через VPN-подключение.

-   **Проверка подлинности сети и вход в систему осуществляется с помощью одного и того же поставщика учетных данных.** В этом сценарии перед входом в систему пользователь должен подключиться к сети.

**Перечисление плиток входа**

Поставщик учетных данных перечисляет плитки входа в следующих экземплярах:

-   Для этих операционных систем, указанных в списке **применяется к** в начале этого раздела.

-   Поставщик учетных данных перечисляет плитки для входа на рабочую станцию. Поставщик учетных данных обычно сериализует учетные данные для проверки подлинности в локальном центре безопасности. Этот процесс отображает сведения о плитках для каждого пользователя и конкретных целевых систем каждого пользователя.

-   Архитектура входа и аутентификации позволяет пользователю использовать плитки, перечисленные поставщиком учетных данных для разблокировки рабочей станции. Как правило, пользователь, выполнивший вход в систему, является плиткой по умолчанию, но при входе в систему нескольких пользователей отображается множество плиток.

-   Поставщик учетных данных перечисляет плитки в ответ на запрос пользователя на изменение пароля или другой частной информации, такой как ПИН-код. Как правило, пользователь, выполнивший вход в систему, является плиткой по умолчанию; Однако при входе в систему нескольких пользователей отображается множество плиток.

-   Поставщик учетных данных перечисляет плитки на основе сериализованных учетных данных, которые будут использоваться для проверки подлинности на удаленных компьютерах. Пользовательский интерфейс учетных данных не использует тот же экземпляр поставщика, что и пользовательский интерфейс входа, разблокируйте рабочую станцию или смените пароль. Поэтому сведения о состоянии не могут храниться в поставщике между экземплярами пользовательского интерфейса учетных данных. Эта структура приводит к одной плитке для каждого удаленного входа в систему, предполагая, что учетные данные правильно сериализованы. Этот сценарий также используется в контроле учетных записей (UAC), который может помочь предотвратить несанкционированные изменения на компьютере, запрашивая у пользователя разрешение или пароль администратора перед тем, как разрешить действия, которые могут повлиять на работу компьютера, или изменить параметры, влияющие на работу других пользователей компьютера.

На следующей схеме показан процесс учетных данных для операционных систем, указанных в списке **применимые к** в начале этого раздела.

![Схема, на которой показан процесс учетных данных для операционных систем, указанных в списке * * применяется к * * в начале этого раздела](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="credential-input-for-application-and-service-logon"></a><a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>Ввод учетных данных для входа в приложение и службу
Проверка подлинности Windows предназначена для управления учетными данными для приложений или служб, которые не нуждаются в взаимодействии с пользователем. Приложения в пользовательском режиме ограничены с точки зрения доступа к системным ресурсам, в то время как службы могут иметь неограниченный доступ к системной памяти и внешним устройствам.

Системные службы и приложения уровня транспорта обращаются к поставщику поддержки безопасности (SSP) через интерфейс поставщика поддержки безопасности (SSPI) в Windows, который предоставляет функции для перечисления пакетов безопасности, доступных в системе, выбора пакета и использования этого пакета для получения проверенного соединения.

При проверке подлинности подключения клиента или сервера:

-   Приложение на клиентской стороне соединения отправляет учетные данные на сервер с помощью функции SSPI `InitializeSecurityContext (General)`.

-   Приложение на стороне сервера в соединении отвечает с помощью функции SSPI `AcceptSecurityContext (General)`.

-   Функции SSPI `InitializeSecurityContext (General)` и `AcceptSecurityContext (General)` повторяются до тех пор, пока все необходимые сообщения проверки подлинности не будут переданы в соответствие с успешным или неудачной проверкой подлинности.

-   После проверки подлинности подключения LSA на сервере использует сведения от клиента для создания контекста безопасности, содержащего маркер доступа.

-   Затем сервер может вызвать функцию SSPI `ImpersonateSecurityContext`, чтобы присоединить маркер доступа к потоку олицетворения для службы.

**Приложения и пользовательский режим**

Пользовательский режим в Windows состоит из двух систем, способных передавать запросы ввода-вывода в соответствующие драйверы режима ядра: систему среды, которая запускает приложения, написанные для множества различных типов операционных систем, и целую систему, которая использует системные функции от имени системы среды.

Целая система управляет функциями систем'спеЦифик от имени системы среды и состоит из процесса системы безопасности (LSA), службы рабочей станции и службы сервера. Процесс системы безопасности работает с маркерами безопасности, предоставляет или запрещает доступ к учетным записям пользователей на основе разрешений для ресурсов, обрабатывает запросы на вход и инициирует проверку подлинности входа, а также определяет системные ресурсы, которые должны быть проверены операционной системой.

Приложения могут работать в пользовательском режиме, где приложение может запускаться как любой участник, в том числе в контексте безопасности локальной системы (SYSTEM). Приложения также могут работать в режиме ядра, где приложение может запускаться в контексте безопасности локальной системы (SYSTEM).

ИНТЕРФЕЙС SSPI доступен через модуль Secur32. dll, который используется для получения интегрированных служб безопасности для проверки подлинности, целостности сообщений и конфиденциальности сообщений. Он обеспечивает уровень абстракции между протоколами уровня приложения и протоколами безопасности. Поскольку различным приложениям требуются различные способы идентификации пользователей и проверки подлинности, а также различные способы шифрования данных по сети, SSPI предоставляет способ доступа к динамическим библиотекам (DLL), содержащим различные функции проверки подлинности и шифрования. Эти библиотеки DLL называются поставщиками поддержки безопасности (SSP).

Управляемые учетные записи служб и виртуальные учетные записи появились в Windows Server 2008 R2 и Windows 7 для предоставления важных приложений, таких как Microsoft SQL Server и службы IIS (IIS), с изоляцией собственных доменных учетных записей, одновременно устраняя необходимость администратора вручную администрировать имя участника-службы (SPN) и учетные данные для этих учетных записей. Дополнительные сведения об этих функциях и их роли в проверке подлинности см. в [документации по управляемым учетным записям служб для Windows 7, Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx) и [групповых управляемых учетных записей служб](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**Службы и режим ядра**

Несмотря на то, что большинство приложений Windows выполняются в контексте безопасности пользователя, запустившего его, это не относится к службам. Многие службы Windows, такие как службы сети и печати, запускаются контроллером служб при запуске компьютера пользователем. Эти службы могут работать как локальная служба или локальная система и могут продолжать работать после выхода последнего пользователя.

> [!NOTE]
> Обычно службы выполняются в контекстах безопасности, известных как "Локальная система", "Сетевая служба" или "Локальная служба".  В Windows Server 2008 R2 появились службы, работающие под управляемой учетной записью службы, которая является субъектами домена.

Перед запуском службы контроллер службы входит в систему с помощью учетной записи, назначенной для службы, а затем представляет учетные данные службы для проверки подлинности LSA. Служба Windows реализует программный интерфейс, который диспетчером контроллеров служб может использовать для управления службой. Служба Windows может запускаться автоматически при запуске системы или вручную с помощью программы управления службами. Например, когда клиентский компьютер Windows присоединяется к домену, служба сообщений на компьютере подключается к контроллеру домена и открывает защищенный канал. Для получения подключения, прошедшего проверку подлинности, служба должна иметь учетные данные, которым доверяет локальный администратор безопасности удаленного компьютера. При взаимодействии с другими компьютерами в сети LSA использует учетные данные учетной записи домена локального компьютера, так же как и все остальные службы, работающие в контексте безопасности локальной системы и сетевой службы. Службы на локальном компьютере работают от имени системы, поэтому учетные данные не нужно предоставлять LSA.

Файл Ксекдд. sys управляет и шифрует эти учетные данные и использует вызов локальной процедуры в LSA. Файл имеет тип DRV (driver) и известен как поставщик поддержки безопасности в режиме ядра (SSP), и в этих версиях, указанных в списке **применимо к** в начале этого раздела, используется соответствие стандарту FIPS 140-2 уровня 1.

Режим ядра имеет полный доступ к оборудованию и системным ресурсам компьютера. Режим ядра останавливает службы и приложения пользовательского режима на доступ к критическим областям операционной системы, к которым у них нет доступа.

## <a name="local-security-authority"></a><a name="BKMK_LSA"></a>Локальный центр безопасности
Локальный администратор безопасности (LSA) — это защищенный системный процесс, который выполняет проверку подлинности и регистрирует пользователей на локальном компьютере. Кроме того, LSA сохраняет информацию обо всех аспектах локальной безопасности на компьютере (эти аспекты совместно называются локальной политикой безопасности) и предоставляют различные службы для перевода между именами и идентификаторами безопасности (SID). Процесс системы безопасности, служба локального центра безопасности (LSASS), отслеживает политики безопасности и учетные записи, действующие на компьютерную систему.

LSA проверяет удостоверение пользователя на основе того, какие из следующих двух сущностей выдавали учетную запись пользователя:

-   **Локальный центр безопасности.** LSA может проверить сведения о пользователе, проверив базу данных диспетчера учетных записей безопасности (SAM), расположенную на том же компьютере. На любой рабочей станции или рядовом сервере могут храниться локальные учетные записи пользователей и сведения о локальных группах. Тем не менее эти учетные записи можно использовать только для доступа к рабочей станции или компьютеру.

-   **Центр безопасности для локального домена или для доверенного домена.** LSA обращается к сущности, выдавшей учетную запись, и запрашивает проверку действительности учетной записи и запрос, полученный от владельца учетной записи.

Служба LSASS сохраняет в памяти учетные данные пользователей с активными сеансами Windows. Сохраненные учетные данные позволяют пользователям легко обращаться к сетевым ресурсам, таким как общие файловые ресурсы, почтовые ящики Exchange Server и сайты SharePoint, без повторного ввода учетных данных для каждой удаленной службы.

Служба LSASS способна хранить учетные данных в различных форматах, включая

-   Зашифрованный обычный текст с возможностью дешифровки

-   Билеты Kerberos (билеты на предоставление билета (TGT), билеты службы)

-   NT-хэш

-   Хэш диспетчера LAN (LM)

Если пользователь входит в систему Windows с помощью смарт-карты, LSASS не сохраняет пароль в виде открытого текста, но сохраняет соответствующее значение хэша NT для учетной записи и ПИН-код в виде открытого текста для этой карты. Если для смарт-карты, необходимой для интерактивного входа, включается атрибут учетной записи, то для соответствующего профиля происходит автоматическая генерация произвольного NT-хэша, который используется вместо изначального хэша пароля. Хэш пароля, автоматически сгенерированный при установке атрибута, не изменяется.

Если пользователь входит в систему на компьютере под управлением Windows с паролем, совместимым с хэшами LAN Manager (LM), это средство проверки подлинности находится в памяти.

Хранение учетных данных в памяти в виде обычного текста нельзя выключить, даже если этого требуют поставщики учетных данных.

Сохраненные учетные данные напрямую связываются с сеансами входа служба LSASS (LSASS), которые были запущены после последнего перезапуска и не закрываются. Например, сеансы с сохраненными учетными данными LSA создаются, когда пользователь выполняет одно из следующих действий.

-   Выполняет вход в локальный сеанс или сеанс протокол удаленного рабочего стола (RDP) на компьютере.

-   Запускает задание с помощью команды **RunAs**

-   Запускает на компьютере активную службу Windows

-   Запускает назначенное или пакетное задание

-   Запускает на локальном компьютере задание с помощью средства удаленного администрирования.

В некоторых обстоятельствах секреты LSA, являющиеся секретными частями данных, которые доступны только для СИСТЕМНЫХ процессов, хранятся на жестком диске. Некоторые из этих секретов представляют собой учетные данные, которые должны сохраниться после перезагрузки и хранящиеся на жестком диске в зашифрованном виде. Учетные данные, хранящиеся в виде секретов LSA, могут включать

-   Пароль учетной записи домен Active Directory служб компьютера (AD DS)

-   Пароли учетных записей служб Windows, настроенных на компьютере

-   Пароли учетных записей настроенных назначенных заданий

-   Пароли учетных записей для пулов приложений IIS и веб-сайтов.

-   Пароли для учетных записей Майкрософт

Операционная система клиента, появившаяся в Windows 8.1, обеспечивает дополнительную защиту для LSA, чтобы предотвратить чтение памяти и внедрение кода незащищенными процессами. Эта защита повышает безопасность для учетных данных, которые LSA хранит и управляет.

Дополнительные сведения об этих дополнительных целях защиты см. в разделе [Настройка дополнительной защиты LSA](../credentials-protection-and-management/configuring-additional-lsa-protection.md).

## <a name="cached-credentials-and-validation"></a><a name="BKMK_CachedCredentialsAndValidation"></a>Кэшированные учетные данные и проверка
Механизмы проверки полагаются на представление учетных данных во время входа в систему. Однако если компьютер отключен от контроллера домена и пользователь выполняет показ учетных данных домена, Windows использует процесс кэшированных учетных данных в механизме проверки.

Каждый раз, когда пользователь входит в домен, Windows кэширует предоставленные учетные данные и сохраняет их в кусте безопасности в реестре операционной системы.

С помощью кэшированных учетных данных пользователь может войти в домен, не подключаясь к контроллеру домена в этом домене.


## <a name="credential-storage-and-validation"></a><a name="BKMK_CredentialStorageAndValidation"></a>Хранилище учетных данных и проверка
Не всегда желательно использовать один набор учетных данных для доступа к различным ресурсам. Например, администратор может использовать администратора, а не учетные данные пользователя при доступе к удаленному серверу. Аналогично, если пользователь обращается к внешним ресурсам, таким как банковский счет, он может использовать только учетные данные, которые отличаются от учетных данных домена. В следующих разделах описываются различия в управлении учетными данными между текущими версиями операционных систем Windows и операционными системами Windows Vista и Windows XP.

### <a name="remote-logon-credential-processes"></a>Процессы для учетных данных удаленного входа
Протокол удаленного рабочего стола (RDP) управляет учетными данными пользователя, подключающегося к удаленному компьютеру с помощью клиента удаленный рабочий стол, который появился в Windows 8. Учетные данные в форме с открытым текстом отправляются на целевой узел, где узел пытается выполнить процесс проверки подлинности, и при успешном подключении подключает пользователя к разрешенным ресурсам. Протокол RDP не сохраняет учетные данные на клиенте, но учетные данные домена пользователя хранятся в LSASS.

В Windows Server 2012 R2 и Windows 8.1 Ограниченный административный режим обеспечивает дополнительную защиту сценариев удаленного входа в систему. Этот режим удаленный рабочий стол приводит к тому, что клиентское приложение выполняет запрос входа в сеть с помощью одностороннего функции NT (НТОВФ) или использует билет службы Kerberos при проверке подлинности на удаленном узле. После проверки подлинности администратора администратор не имеет соответствующих учетных данных в LSASS, так как они не были предоставлены удаленному узлу. Вместо этого у администратора есть учетные данные учетной записи компьютера для сеанса. Учетные данные администратора не предоставляются удаленному узлу, поэтому действия выполняются в качестве учетной записи компьютера. Ресурсы также ограничены учетной записью компьютера, и администратор не может получить доступ к ресурсам с собственной учетной записью.

### <a name="automatic-restart-sign-on-credential-process"></a>Процесс автоматического перезапуска учетных данных входа
При входе пользователя на устройство Windows 8.1 LSA сохраняет учетные данные пользователя в зашифрованной памяти, доступном только для LSASS. exe. Если Центр обновления Windows инициирует автоматический перезапуск без присутствия пользователя, эти учетные данные используются для настройки автоматического входа пользователя в систему.

При перезапуске пользователь автоматически входит в систему с помощью механизма автоматического входа, а затем компьютер дополнительно блокируется для защиты сеанса пользователя. Блокировка инициируется с помощью Winlogon, в то время как управление учетными данными выполняется с помощью LSA. Автоматически войдя в систему и блокируя сеанс пользователя на консоли, приложения блокировки экрана пользователя перезапускаются и доступны.

Дополнительные сведения о АРСО см. [в &#40;статье регистрация автоматического перезапуска Winlogon АРСО&#41;](winlogon-automatic-restart-sign-on-arso.md).

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>Сохранение имен пользователей и паролей в Windows Vista и Windows XP
В Windows Server 2008, Windows Server 2003, Windows Vista и Windows XP, **сохраненные имена пользователей и пароли** на панели управления, упрощают управление и использование нескольких наборов учетных данных для входа в систему, включая сертификаты X. 509, используемые со смарт-картами и учетные данные Windows Live (теперь называется учетная запись Майкрософт). Учетные данные — часть профиля пользователя хранятся до тех пор, пока они не понадобятся. Это действие может повысить уровень безопасности для каждого отдельного ресурса, гарантируя, что при компрометации одного пароля он не подвергается безопасности.

После того как пользователь войдет в систему и попытается получить доступ к дополнительным ресурсам, защищенным паролем, например к общему ресурсу на сервере, и если учетные данные пользователя по умолчанию не достаточны для получения доступа, будут запрошены **сохраненные имена пользователей и пароли** . Если в **сохраненных именах пользователей и паролях**были сохранены альтернативные учетные данные с правильными регистрационными данными, эти учетные данные используются для получения доступа. В противном случае пользователю предлагается ввести новые учетные данные, которые затем можно сохранить для повторного использования в сеансе входа в систему или во время следующего сеанса.

Действуют следующие ограничения.

-   Если **сохраненные имена пользователей и пароли** содержат недопустимые или неверные учетные данные для определенного ресурса, доступ к ресурсу будет запрещен, а диалоговое окно **сохраненные имена пользователей и пароли** не появится.

-   **Сохраненные имена пользователей и пароли** хранят учетные данные только для NTLM, протокола Kerberos, учетная запись Майкрософт (ранее Windows Live ID) и проверки подлинности SSL (SSL). Некоторые версии Internet Explorer поддерживают собственный кэш для обычной проверки подлинности.

Эти учетные данные становятся зашифрованными частью локального профиля пользователя в каталоге \Documents and Сеттингс\усернаме\аппликатион Дата\микрософт\кредентиалс. В результате эти учетные данные могут перемещаться с пользователем, если политика сети пользователя поддерживает перемещаемые профили пользователей. Однако если пользователь копирует **сохраненные имена пользователей и пароли** на два разных компьютера и изменяет учетные данные, связанные с ресурсом на одном из этих компьютеров, это изменение не распространяется на **сохраненные имена пользователей и пароли** на втором компьютере.

### <a name="windows-vault-and-credential-manager"></a>Хранилище Windows и диспетчер учетных данных
Диспетчер учетных данных появился в Windows Server 2008 R2 и Windows 7 как функция панели управления для хранения имен пользователей и паролей и управления ими. Диспетчер учетных данных позволяет пользователям хранить учетные данные, относящиеся к другим системам и веб-сайтам, в безопасном хранилище Windows. Некоторые версии Internet Explorer используют эту функцию для проверки подлинности на веб-сайтах.

Управление учетными данными с помощью диспетчера учетных данных контролируется пользователем локального компьютера. Чтобы пользователям было удобно регистрироваться в поддерживаемых браузерах и Windows-приложениях, они могут сохранять и хранить учетные данные с этих ресурсов. Учетные данные сохраняются в специальных зашифрованных папках на компьютере в профиле пользователя. Приложения, поддерживающие эту функцию (с помощью API диспетчера учетных данных), такие как веб-браузеры и приложения, могут предоставлять правильные учетные данные другим компьютерам и веб-сайтам в процессе входа в систему.

Когда веб-сайт, приложение или другой компьютер запрашивают проверку подлинности с помощью NTLM или протокола Kerberos, появляется диалоговое окно, в котором можно установить флажок **обновить учетные данные по умолчанию** или **Сохранить пароль** . Это диалоговое окно, позволяющее пользователю сохранять учетные данные локально, создается приложением, которое поддерживает API-интерфейсы диспетчера учетных данных. Если пользователь устанавливает флажок **Сохранить пароль** , диспетчер учетных данных отслеживает имя пользователя, пароль и связанные сведения для используемой службы проверки подлинности.

При следующем использовании службы Диспетчер учетных данных автоматически предоставляет учетные данные, хранящиеся в хранилище Windows. Если данные не принимаются, пользователю предлагается ввести правильную информацию для получения доступа. Если доступ предоставляется с новыми учетными данными, то диспетчер учетных данных перезаписывает предыдущие учетные данные с новым, а затем сохраняет новые учетные данные в хранилище Windows.

## <a name="security-accounts-manager-database"></a><a name="BKMK_SAM"></a>База данных диспетчера учетных записей безопасности
Диспетчер учетных записей безопасности (SAM) — это база данных, в которой хранятся локальные учетные записи пользователей и группы. Он имеется в каждой операционной системе Windows; Однако при присоединении компьютера к домену Active Directory управляет учетными записями домена в Active Directory доменах.

Например, клиентские компьютеры под управлением операционной системы Windows участвуют в сетевом домене, взаимодействующем с контроллером домена, даже если никто из пользователей не вошел в систему. Чтобы инициировать обмен данными, компьютер должен иметь активную учетную запись в домене. Прежде чем принимать подключения от компьютера, LSA на контроллере домена проверяет подлинность удостоверения компьютера, а затем конструирует контекст безопасности компьютера так же, как и для участника безопасности. Этот контекст безопасности определяет удостоверение и возможности пользователя или службы на определенном компьютере или пользователя, службы или компьютера в сети. Например, маркер доступа, содержащийся в контексте безопасности, определяет ресурсы (такие как файловый ресурс или принтер), к которым можно получить доступ, и действия (например, чтение, запись или изменение), которые могут быть выполнены этим участником, пользователем, компьютером или службой на этом ресурсе.

Контекст безопасности пользователя или компьютера может отличаться от одного компьютера к другому, например, когда пользователь входит в систему на сервере или на рабочую станцию, отличную от основной рабочей станции пользователя. Он также может отличаться от одного сеанса к другому, например, когда администратор изменяет права и разрешения пользователя. Кроме того, контекст безопасности обычно отличается, если пользователь или компьютер работает на автономной основе, в сети или в составе домена Active Directory.

## <a name="local-domains-and-trusted-domains"></a><a name="BKMK_LocalDomainsAndTrustedDomains"></a>Локальные домены и доверенные домены
Если между двумя доменами существует отношение доверия, механизмы проверки подлинности для каждого домена полагаются на допустимость проверки подлинности, поступающих из другого домена. Отношения доверия помогают предоставить контролируемый доступ к общим ресурсам в домене ресурсов (доверяющем домене), убедившись, что входящие запросы на аутентификацию поступают от доверенного центра (доверенного домена). Таким образом, отношения доверия действуют как мосты, позволяющие проходить только проверенные запросы проверки подлинности между доменами.

Как конкретное отношение доверия проходит проверку подлинности, зависит от того, как оно настроено. Отношения доверия могут быть односторонними, предоставляя доступ из доверенного домена к ресурсам в доверяющем домене или двусторонним образом, предоставляя доступ из каждого домена к ресурсам в другом домене. Отношения доверия также являются нетранзитивными. в этом случае доверие существует только между двумя доменами партнерских партнеров или транзитивным. в этом случае доверие автоматически распространяется на любые другие домены, которым доверяет любой из партнеров.

Сведения о доверительных отношениях доменов и лесов в отношении проверки подлинности см. в разделе [делегированная проверка подлинности и доверительные отношения](https://technet.microsoft.com/library/dn169022.aspx).

## <a name="certificates-in-windows-authentication"></a><a name="BKMK_CertificatesInWindowsAuthentication"></a>Сертификаты в проверке подлинности Windows
Инфраструктура открытых ключей (PKI) — это сочетание программного обеспечения, технологий шифрования, процессов и служб, которые позволяют Организации защищать свои коммуникации и бизнес-транзакции. Возможности PKI для защиты связи и бизнес-транзакций основаны на обмене цифровыми сертификатами между прошедшими проверку подлинности пользователями и доверенными ресурсами.

Цифровой сертификат — это электронный документ, содержащий сведения о сущности, которой он принадлежит, сущности, которой он был выдан, уникальный серийный номер или другая уникальная идентификация, даты выдачи и срока действия, а также цифровой отпечаток.

Проверка подлинности — это процесс определения того, может ли удаленный узел быть доверенным. Чтобы установить надежность, удаленный узел должен предоставить приемлемый сертификат проверки подлинности.

Удаленные узлы устанавливают надежность, получая сертификат из центра сертификации (ЦС). Центр сертификации может, в свою очередь, иметь сертификацию от более высокого центра, что создает цепочку доверия. Чтобы определить, является ли сертификат надежным, приложение должно определить удостоверение корневого центра сертификации, а затем определить, является его надежным.

Аналогичным образом удаленный узел или локальный компьютер должен определить, является ли сертификат, представленный пользователем или приложением, подлинным. Сертификат, представленный пользователем с помощью LSA и SSPI, оценивается на подлинность на локальном компьютере для локального входа в сеть или в домене через хранилища сертификатов в Active Directory.

Для создания сертификата данные проверки подлинности проходят через алгоритмы хэширования, например алгоритм SHA-1 (SHA1), для создания дайджеста сообщений. Затем дайджест сообщения подписывается с помощью закрытого ключа отправителя, чтобы подтвердить, что дайджест сообщения был создан отправителем.

> [!NOTE]
> SHA1 используется по умолчанию в Windows 7 и Windows Vista, но был изменен на SHA2 в Windows 8.

**Проверка подлинности смарт-карты**

Технология смарт-карт — это пример проверки подлинности на основе сертификатов. Вход в сеть со смарт-картой обеспечивает строгую форму проверки подлинности, так как она использует идентификацию и подтверждение владения при проверке подлинности пользователя в домене. Службы сертификации Active Directory (AD CS) обеспечивают идентификацию на основе криптографии путем выдачи сертификата входа для каждой смарт-карты.

Дополнительные сведения о проверке подлинности смарт-карт см. в статье [техническое руководство по смарт-картам Windows](https://technet.microsoft.com/library/ff404297.aspx).

Технология виртуальных смарт-карт появилась в Windows 8. Он сохраняет сертификат смарт-карты на компьютере, а затем защищает его с помощью микросхемы безопасности доверенный платформенный модуль (TPM) на устройстве (TPM). Таким образом, ПК фактически превращается в смарт-карту, которая должна получать ПИН-код пользователя для проверки подлинности.

**Удаленная и беспроводная аутентификация**

Проверка подлинности удаленных и беспроводных сетей — еще одна технология, использующая сертификаты для аутентификации. Служба проверки подлинности в Интернете (IAS) и виртуальные частные сети используют протокол расширенной проверки подлинности — безопасность транспортного уровня (EAP-TLS), защищенный протокол PEAP или протокол IPsec для проверки подлинности на основе сертификатов для многих типов доступа к сети, включая VPN и беспроводные подключения.

Сведения о проверке подлинности на основе сертификатов в сети см. в разделе [Проверка подлинности доступа к сети и сертификаты](https://technet.microsoft.com/library/cc759575(WS.10).aspx).

## <a name="see-also"></a><a name="BKMK_SeeAlso"></a> См. также
[Основные понятия проверки подлинности Windows](https://docs.microsoft.com/windows-server/security/windows-authentication/windows-authentication-concepts)


