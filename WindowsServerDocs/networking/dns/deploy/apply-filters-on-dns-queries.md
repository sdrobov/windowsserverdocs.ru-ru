---
title: Использование политики DNS для применения фильтров к запросам DNS
description: Этот раздел является частью руководств по сценариям политики DNS для Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-dns
ms.topic: article
ms.assetid: b86beeac-b0bb-4373-b462-ad6fa6cbedfa
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 95b68995326dc3d3bf48ca36caa9b2ab4923a7c3
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71406207"
---
# <a name="use-dns-policy-for-applying-filters-on-dns-queries"></a>Использование политики DNS для применения фильтров к запросам DNS

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете, как настроить политику DNS в Windows Server&reg; 2016 для создания фильтров запросов на основе предоставленных условий. 

Фильтры запросов в политике DNS позволяют настроить DNS-сервер на отправку пользовательского способа на основе DNS-запроса и DNS-клиента, отправляющего запрос DNS.

Например, можно настроить политику DNS с помощью списка блоков фильтра запросов, который блокирует запросы DNS от известных вредоносных доменов, что предотвращает реагирование DNS на запросы из этих доменов. Поскольку ответ от DNS-сервера не отправляется, истекает время ожидания запроса DNS участника домена.

Еще один пример — создание списка разрешений фильтра запросов, который позволяет только определенному набору клиентов разрешать определенные имена.

## <a name="bkmk_criteria"></a>Условия фильтра запросов
Фильтры запросов можно создавать с помощью любых логических сочетаний (и/или/или не) следующих критериев.

|Имя|Описание|
|-----------------|---------------------|
|Подсеть клиента|Имя предопределенной клиентской подсети. Используется для проверки подсети, из которой был отправлен запрос.|
|Транспортный протокол|Транспортный протокол, используемый в запросе. Возможные значения: UDP и TCP.|
|Протокол Интернета|Сетевой протокол, используемый в запросе. Возможные значения: IPv4 и IPv6.|
|IP-адрес интерфейса сервера|IP-адрес сетевого интерфейса DNS-сервера, получившего запрос DNS.|
|FQDN|Полное доменное имя записи в запросе с возможностью использования подстановочных знаков.|
|Тип запроса|Тип записи, запрашиваемой \(, SRV, txt и т. д\).|
|Время суток|Время суток, когда получен запрос.|

В следующих примерах показано, как создать фильтры для политики DNS, которые либо блокируют, либо разрешают запросы разрешения имен DNS.

>[!NOTE]
>В примерах команд в этом разделе используется команда Windows PowerShell **Add-днссерверкуериресолутионполици**. Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps). 

## <a name="bkmk_block1"></a>Блокировка запросов из домена

В некоторых случаях может потребоваться блокировать разрешение DNS-имен для доменов, которые определены как вредоносные, или для доменов, которые не соответствуют рекомендациям по использованию вашей организации. Можно выполнять блокировку запросов для доменов с помощью политики DNS.

Политика, настроенная в этом примере, не создается в какой-либо конкретной зоне. вместо этого создается политика уровня сервера, которая применяется ко всем зонам, настроенным на DNS-сервере. Политики уровня сервера оцениваются первыми и, таким же, сначала сопоставляются при получении запроса DNS-сервером.

В следующем примере команда настраивает политику на уровне сервера, чтобы заблокировать любые запросы с **суффиксом домена contosomalicious.com**.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicy" -Action IGNORE -FQDN "EQ,*.contosomalicious.com" -PassThru 
`

>[!NOTE]
>Если для параметра **действия** задано значение **игнорировать**, DNS-сервер настроен на удаление запросов без ответа. Это приводит к истечению времени ожидания DNS-клиента в вредоносном домене.

## <a name="bkmk_block2"></a>Блокировка запросов из подсети
В этом примере можно заблокировать запросы из подсети, если они будут заражены некоторыми вредоносными программами и пытаются связаться с вредоносными сайтами с помощью DNS-сервера. 

"Add-Днссерверклиентсубнет-Name" MaliciousSubnet06 "-IPv4Subnet 172.0.33.0/24-PassThru

Add-Днссерверкуериресолутионполици-Name "BlockListPolicyMalicious06" — действие IGNORE-Клиентсубнет "EQ, MaliciousSubnet06"-PassThru "

В следующем примере показано, как использовать критерии подсети в сочетании с критериями полного доменного имени, чтобы блокировать запросы определенных вредоносных доменов от зараженных подсетей.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06" –FQDN “EQ,*.contosomalicious.com” -PassThru
`

## <a name="bkmk_block3"></a>Блокировка типа запроса
Может потребоваться запретить разрешение имен для определенных типов запросов на серверах. Например, можно заблокировать запрос ANY, который можно использовать злонамеренно для создания атак с усилением.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyQType" -Action IGNORE -QType "EQ,ANY" -PassThru
`

## <a name="bkmk_allow1"></a>Разрешить запросы только из домена
Политику DNS можно использовать только для блокировки запросов. их можно использовать для автоматического утверждения запросов из конкретных доменов или подсетей. При настройке списков разрешения DNS-сервер обрабатывает запросы только из разрешенных доменов, блокируя все остальные запросы из других доменов.

Приведенный ниже пример команды позволяет выполнять запросы к DNS-серверу только компьютерам и устройствам в contoso.com и дочерних доменах.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicyDomain" -Action IGNORE -FQDN "NE,*.contoso.com" -PassThru 
`

## <a name="bkmk_allow2"></a>Разрешить запросы только из подсети
Можно также создать списки разрешений для IP-подсетей, чтобы все запросы, не исходящие из этих подсетей, игнорировались.

`
Add-DnsServerClientSubnet -Name "AllowedSubnet06" -IPv4Subnet 172.0.33.0/24 -PassThru
`
`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicySubnet” -Action IGNORE -ClientSubnet  "NE, AllowedSubnet06" -PassThru
`

## <a name="bkmk_allow3"></a>Разрешить только определенные Ктипес
Списки разрешений можно применять к Ктипес. 

Например, если у вас есть внешние клиенты, которые запрашивают интерфейс DNS-сервера 164.8.1.1, запрашиваются только определенные Ктипес, а также другие Ктипес, такие как записи SRV или TXT, которые используются внутренними серверами для разрешения имен или для целей мониторинга.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListQType" -Action IGNORE -QType "NE,A,AAAA,MX,NS,SOA" –ServerInterface “EQ,164.8.1.1” -PassThru
`

Вы можете создавать тысячи политик DNS в соответствии с требованиями к управлению трафиком, а все новые политики применяются динамически, без перезапуска DNS-сервера во входящих запросах. 
