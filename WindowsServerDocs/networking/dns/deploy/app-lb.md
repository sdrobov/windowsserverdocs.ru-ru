---
title: Использование политики DNS для балансировки нагрузки приложений
description: Этот раздел является частью руководств по сценариям политики DNS для Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-dns
ms.topic: article
ms.assetid: f9c313ac-bb86-4e48-b9b9-de5004393e06
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 356c61c2cc5b60f43a69f17966c97f3c69d05cda
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71356037"
---
# <a name="use-dns-policy-for-application-load-balancing"></a>Использование политики DNS для балансировки нагрузки приложений

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела можно узнать, как настроить политику DNS для выполнения балансировки нагрузки приложений.

Предыдущие версии Windows Server DNS предоставляли балансировку нагрузки только с помощью запросов с циклическим перебором; но с DNS в Windows Server 2016 можно настроить политику DNS для балансировки нагрузки приложений.

При развертывании нескольких экземпляров приложения можно использовать политику DNS для балансировки нагрузки трафика между разными экземплярами приложения, тем самым динамически выделяя нагрузку на трафик для приложения.

## <a name="example-of-application-load-balancing"></a>Пример балансировки нагрузки приложений

Ниже приведен пример того, как можно использовать политику DNS для балансировки нагрузки приложений.

В этом примере используется одна вымышленная компания-служба подарочных услуг Contoso, которая предоставляет сетевые Гифинг службы и веб-сайт с именем **contosogiftservices.com**.

Веб-сайт contosogiftservices.com размещается в нескольких центрах обработки данных, каждый из которых имеет разные IP-адреса.

В Северная Америка, который является основным рынком для подарочных услуг Contoso, веб-сайт размещается в трех центрах обработки данных: Чикаго, IL, Далласе, Техас и Сиэтл, штат Вашингтон.

Веб-сервер в Сиэтле имеет оптимальную аппаратную конфигурацию и может работать в два раза больше нагрузки, чем два других сайта. Подарочным службам Contoso нужен трафик приложений, направленный следующим образом.

- Так как веб-сервер в Сиэтле включает больше ресурсов, половина клиентов приложения направляется на этот сервер.
- Один квартал клиентов приложения направляется в Далласе, TX Datacenter
- Один квартал клиентов приложения направляется в Чикаго, IL, Datacenter

Этот сценарий показан на следующем рисунке.

![Балансировка нагрузки приложений DNS с помощью политики DNS](../../media/Dns-App-Lb/dns-app-lb.jpg)


### <a name="how-application-load-balancing-works"></a>Как работает балансировка нагрузки приложений

После настройки DNS-сервера с политикой DNS для балансировки нагрузки приложений с помощью этого примера сценария DNS-сервер ответит 50% времени на адрес веб-сервера в Сиэтле, 25% времени с адресом веб-сервера Dallas и 25% времени с адрес веб-сервера в Чикаго.

Таким же для каждых четырех запросов, получаемых DNS-сервером, он реагирует на два ответа в Сиэтле и по одному для Dallas и Чикаго.

Одной из возможных проблем с балансировкой нагрузки с помощью политики DNS является кэширование записей DNS клиентом DNS и сопоставителя или ЛДНС, которые могут повлиять на балансировку нагрузки, так как клиент или сопоставитель не отправляют запросы на DNS-сервер.

Вы можете уменьшить воздействие этого поведения, используя низкое значение времени @ no__t-0to @ no__t-1Live \(TTL @ no__t-3 для записей DNS, которые должны быть сбалансированы при нагрузке.

### <a name="how-to-configure-application-load-balancing"></a>Настройка балансировки нагрузки приложений

В следующих разделах показано, как настроить политику DNS для балансировки нагрузки приложений.

#### <a name="create-the-zone-scopes"></a>Создание областей зоны

Сначала необходимо создать области зоны contosogiftservices.com для центров обработки данных, где они размещены.

Область зоны — это уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, при этом каждая область зоны содержит собственный набор записей DNS. Одна и та же запись может присутствовать в нескольких областях с разными IP-адресами или IP-адресами.

>[!NOTE]
>По умолчанию область зоны существует в зонах DNS. Эта область зоны имеет то же имя, что и зона, а устаревшие операции DNS работают в этой области.

Для создания областей зоны можно использовать следующие команды Windows PowerShell.
    
    Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "SeattleZoneScope"
    
    Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "DallasZoneScope"
    
    Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "ChicagoZoneScope"

Дополнительные сведения см. в разделе [Add-днссерверзонескопе](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps) .

#### <a name="bkmk_records"></a>Добавление записей в области зоны

Теперь необходимо добавить записи, представляющие узел веб-сервера, в области зоны.

В **сеаттлезонескопе**можно добавить запись www.contosogiftservices.com с IP-адресом 192.0.0.1, который находится в центре обработки данных в Сиэтле.

В **чикагозонескопе**можно добавить ту же запись @no__t -1www. контосогифтсервицес. com @ no__t-2 с IP-адресом 182.0.0.1 в центре обработки данных в Чикаго.

Аналогичным образом в **далласзонескопе**можно добавить запись @no__t -1www. контосогифтсервицес. com @ no__t-2 с IP-адресом 162.0.0.1 в центре обработки данных в Чикаго.

Для добавления записей в области зоны можно использовать следующие команды Windows PowerShell.
    
    Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.0.0.1" -ZoneScope "SeattleZoneScope
    
    Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "182.0.0.1" -ZoneScope "ChicagoZoneScope"
    
    Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "162.0.0.1" -ZoneScope "DallasZoneScope"
    

Дополнительные сведения см. в разделе [Add-днссерверресаурцерекорд](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).

#### <a name="bkmk_policies"></a>Создание политик DNS

После создания разделов (областей зоны) и добавления записей необходимо создать политики DNS, которые распределяют входящие запросы по этим областям, чтобы на 50% запросов contosogiftservices.com был получен ответ с IP-адресом для Интернета. сервер в Сиэтле Datacenter и остальные равномерно распределяются между центрами обработки данных в Чикаго и Далласе.

Для создания политики DNS, которая распределяет трафик приложений между тремя центрами обработки данных, можно использовать следующие команды Windows PowerShell.

>[!NOTE]
>В приведенной ниже команде примера выражение-Зонескопе "Сеаттлезонескопе, 2; Чикагозонескопе, 1; Далласзонескопе, 1», настраивает DNS-сервер с массивом, включающим в себя сочетание параметров \<ZoneScope @ no__t-1, \<weight @ no__t-3.
    
    Add-DnsServerQueryResolutionPolicy -Name "AmericaPolicy" -Action ALLOW -ZoneScope "SeattleZoneScope,2;ChicagoZoneScope,1;DallasZoneScope,1" -ZoneName "contosogiftservices.com"
    

Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  

Теперь вы успешно создали политику DNS, которая обеспечивает балансировку нагрузки приложений между веб-серверами в трех разных центрах обработки данных.

Вы можете создавать тысячи политик DNS в соответствии с требованиями к управлению трафиком, а все новые политики применяются динамически, без перезапуска DNS-сервера во входящих запросах.
