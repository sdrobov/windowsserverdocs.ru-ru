---
title: Распределение пропускной способности шлюза
description: ''
manager: dougkim
ms.prod: windows-server
ms.technology: networking-hv-switch
ms.topic: get-started-article
ms.assetid: ''
ms.author: lizross
author: eross-msft
ms.date: 08/22/2018
ms.openlocfilehash: 8e0709360449e1175988b14a963047ee72f26ade
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80313037"
---
# <a name="gateway-bandwidth-allocation"></a>Распределение пропускной способности шлюза

>Область применения: Windows Server

В Windows Server 2016 отдельная пропускная способность туннеля для IPsec, GRE и L3 была соотношением общей емкости шлюза. Таким образом, клиенты будут предоставлять емкость шлюза на основе стандартной пропускной способности TCP, ожидающей использования виртуальной машины шлюза.

Кроме того, максимальная пропускная способность туннеля IPsec в шлюзе ограничена (3/20)\*емкости шлюза, предоставленной клиентом. Например, если емкость шлюза устанавливается равным 100 Мбит/с, то емкость туннеля IPsec будет составлять 150 Мбит/с. Эквивалентные коэффициенты для туннелей GRE и L3 — 1/5 и 1/2 соответственно.

Хотя это работало в большинстве развертываний, модель фиксированного соотношения не подходит для сред с высокой пропускной способностью. Даже если скорость передачи данных была высокой (скажем, выше 40 Гбит/с), максимальная пропускная способность туннелей шлюза SDN ограничена из-за внутренних факторов.

В Windows Server 2019 для типа туннеля зафиксирована максимальная пропускная способность.

-   IPsec = 5 Гбит/с

-   GRE = 15 Гбит/с

-   L3 = 5 Гбит/с

Таким образом, даже если узел или виртуальная машина шлюза поддерживает сетевые карты с более высокой пропускной способностью, будет исправлена максимальная доступная пропускная способность. Еще одна проблема заключается в том, что вы выполняете произвольный перебор шлюзов, что происходит при предоставлении очень большого числа для емкости шлюза.

## <a name="gateway-capacity-calculation"></a>Вычисление емкости шлюза

В идеале вы устанавливаете пропускную способность шлюза в качестве пропускной способности, доступной для виртуальной машины шлюза. Например, если имеется одна виртуальная машина с одним шлюзом и пропускная способность NIC-адаптера равна 25 Гбит/с, то пропускная способность шлюза также может быть равна 25 Гбит/с.

Если шлюз используется только для подключений IPsec, максимальный объем доступной фиксированной емкости составляет 5 Гбит/с. Например, если вы подготавливаете подключения IPsec к шлюзу, вы можете предоставить только суммарную пропускную способность (входящий и исходящий трафик) как 5 Гбит/с.

При использовании шлюза для подключения IPsec и GRE можно настроить максимальную пропускную способность IPsec 5 Гбит/с или максимум 15 Гбит/с для пропускной способности GRE. Например, если вы подготавливаете 2 Гбит/с для пропускной способности IPsec, у вас осталось 3 Гбит/с на пропускной способности IPsec для инициализации шлюза или 9 Гбит/с для пропускной способности GRE.

Чтобы положить это на более Математические термины:

- Общая емкость шлюза = 25 Гбит/с

- Общая доступная емкость IPsec = 5 Гбит/с (фиксированная)

- Общая доступная емкость GRE = 15 Гбит/с (фиксированная)

- Коэффициент пропускной способности IPsec для этого шлюза = 25/5 = 5 Гбит/с

- Коэффициент пропускной способности GRE для этого шлюза = 25/15 = 5/3 Гбит/с

Например, при выделении клиенту 2 Гбит/с для пропускной способности IPsec:

Оставшаяся доступная емкость шлюза = общая емкость шлюза — соотношение пропускной способности IPsec * выделенная пропускная способность IPsec (используемая емкость)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25 – 5 * 2 = 15 Гбит/с

Оставшаяся пропускная способность IPsec, которую можно выделить на шлюзе 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5-2 = 3 Гбит/с

Оставшаяся пропускная способность GRE, которую можно выделить на шлюзе = Оставшаяся емкость шлюза или GRE, пропускная способность 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15 * 3/5 = 9 Гбит/с

Коэффициент пропускной способности зависит от общей емкости шлюза. Обратите внимание, что необходимо задать общую емкость для пропускной способности TCP, доступной для виртуальной машины шлюза. Если на шлюзе размещено несколько виртуальных машин, необходимо соответствующим образом настроить общую емкость шлюза.

Кроме того, если емкость шлюза меньше, чем общая доступная емкость туннеля, общая доступная емкость туннеля будет равна емкости шлюза. Например, если для шлюза задано значение 4 Гбит/с, общая доступная емкость для IPsec, L3 и GRE устанавливается равным 4 Гбит/с, при этом коэффициент пропускной способности для каждого туннеля составляет 1 Гбит/с.

## <a name="windows-server-2016-behavior"></a>Поведение Windows Server 2016

Алгоритм расчета емкости шлюза для Windows Server 2016 остается неизменным. В Windows Server 2016 максимальная пропускная способность туннеля IPsec ограничена (3/20)\*емкости шлюза на шлюзе. Эквивалентные коэффициенты для туннелей GRE и L3 — 1/5 и 1/2 соответственно.

При обновлении с Windows Server 2016 до Windows Server 2019:

1.  **Туннели GRE и L3:** Логика распределения Windows Server 2019 вступает в силу после обновления узлов сетевого контроллера до Windows Server 2019

2.  **Туннели IPSec:** Логика распределения шлюза Windows Server 2016 продолжит функционировать, пока все шлюзы в пуле шлюзов не будут обновлены до Windows Server 2019. Для всех шлюзов в пуле шлюзов необходимо настроить **Автоматический**режим службы шлюза Azure.

>[!NOTE]
>После обновления до Windows Server 2019 шлюз перестает быть подготовленным (в соответствии с изменениями логики распределения с Windows Server 2016 до Windows Server 2019). В этом случае существующие подключения на шлюзе продолжают существовать. Ресурс RESTFUL для шлюза выдает предупреждение о чрезмерной подготовке шлюза. В этом случае необходимо переместить некоторые подключения к другому шлюзу.

---