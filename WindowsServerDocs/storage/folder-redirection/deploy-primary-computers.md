---
title: Развертывание основных компьютеров для перенаправления папок и использования перемещаемых профилей пользователей
description: Включение поддержки основных компьютеров и назначение пользователям для перенаправления папок и использования перемещаемых профилей пользователей.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: 935d3ccf7de777a71d7c75179629b448dbb73a08
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86966286"
---
# <a name="deploy-primary-computers-for-folder-redirection-and-roaming-user-profiles"></a>Развертывание основных компьютеров для перенаправления папок и использования перемещаемых профилей пользователей

>Применяется к: Windows 10, Windows 8, Windows 8.1, Windows Server 2019, Windows Server 2016, Windows Server 2012, Windows Server 2012 R2

В этой статье описывается включение поддержки основных компьютеров и их назначение пользователям. Это действие позволяет управлять тем, какие компьютеры используют перенаправление папок и перемещаемые профили пользователей.

> [!IMPORTANT]
> При включении поддержки основного компьютера для перемещаемых профилей пользователей всегда следует включать поддержку основного компьютера для перенаправления папок. Это позволяет сохранить документы и другие пользовательские файлы вне профилей пользователей, что помогает уменьшить размер профилей и быстро входить в систему.

## <a name="prerequisites"></a>Предварительные условия

## <a name="software-requirements"></a>Требования к программному обеспечению

К поддержке основного компьютера предъявляются следующие требования:

- Схема доменных служб Active Directory (AD DS) должна включать дополнения схемы Windows Server 2012 (схема обновляется автоматически при установке контроллера домена Windows Server 2012). Дополнительные сведения об обновлении схемы AD DS см. в разделе [Adprep.exe integration](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh472161(v=ws.11)#adprepexe-integration>) (Интеграция Аdprep.exe) и статье [Running Adprep.exe](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd464018(v=ws.10)>) (Работа Adprep.exe).
- Клиентские компьютеры должны работать под управлением: Windows 10, Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012.

> [!TIP]
> Хотя для поддержки основного компьютера требуется перенаправление папок или перемещаемые профили пользователей, при первом развертывании этих технологий рекомендуется настроить поддержку основного компьютера перед включением объектов групповой политики (GPO), в которых настраиваются перенаправление папок и перемещаемые профили пользователей. предотвратить копирование данных пользователя на неосновные компьютеры до включения поддержки основного компьютера. Дополнительные сведения см. в статьях [Deploy Folder Redirection](deploy-folder-redirection.md) (Развертывание перенаправления папок) и [Deploy Roaming User Profiles](deploy-roaming-user-profiles.md) (Развертывание перемещаемых профилей пользователей).

## <a name="step-1-designate-primary-computers-for-users"></a>Шаг 1. Назначение основных компьютеров для пользователей

На первом шаге при развертывании поддержки основных компьютеров следует назначить основной компьютер для каждого пользователя. Для этого можно использовать Центр администрирования Active Directory, чтобы получить различающиеся имена соответствующих компьютеров, а затем установить атрибут **msDs-PrimaryComputer**.

> [!TIP]
> Как использовать Windows PowerShell для работы с основными компьютерами, см. в записи блога [о подробностях работы с основными компьютерами Windows 8](<https://blogs.technet.microsoft.com/askds/2012/10/23/digging-a-little-deeper-into-windows-8-primary-computer/>).

Вот как указать основные компьютеры для пользователей:

1. Откройте диспетчер сервера на компьютере с установленными средствами администрирования Active Directory.
2. В меню **Инструменты** щелкните **Active Directory Administration Center** (Центр администрирования Active Directory). Отобразится центр администрирования Active Directory.
3. Перейдите к контейнеру **Компьютеры** в соответствующем домене.
4. Щелкните правой кнопкой мыши компьютер, который необходимо назначить основным, и выберите пункт **Свойства**.
5. В области навигации выберите элемент **Расширения**.
6. Перейдите на вкладку **Редактор атрибутов**, прокрутите содержимое до пункта **distinguishedName**, щелкните **Просмотр**, щелкните правой кнопкой мыши значение в списке, выберите команду **Копировать**, нажмите кнопку **ОК**, а затем щелкните **Отмена**.
7. Перейдите в контейнер **Пользователи** в соответствующем домене, щелкните правой кнопкой мыши имя пользователя, которому следует назначить компьютер, и выберите пункт **Свойства**.
8. В области навигации выберите элемент **Расширения**.
9. Перейдите на вкладку **Редактор атрибутов**, выберите **msDs-PrimaryComputer**, а затем щелкните **Изменить**. Отобразится диалоговое окно "Редактор многозначных строк".
10. Щелкните правой кнопкой мыши в текстовом поле, выберите команду **Вставить**, щелкните **Добавить**, нажмите кнопку **ОК**, а затем снова нажмите кнопку **ОК**.

## <a name="step-2-optionally-enable-primary-computers-for-folder-redirection-in-group-policy"></a>Шаг 2. Включение перенаправления папок в групповой политике на основных компьютерах (необязательно)

Далее в групповой политике можно настроить перенаправление папок для основных компьютеров. Это позволяет перенаправлять папки пользователя на компьютеры, назначенные в качестве основных компьютеров, но не на другие компьютеры. Можно управлять перенаправлением папок на основных компьютерах отдельно для каждого компьютера или для каждого пользователя.

Вот как включить перенаправление папок для основных компьютеров:

1. В средстве "Управление групповой политикой" щелкните правой кнопкой мыши GPO, созданный при начальной настройке перенаправления папок или перемещаемых профилей пользователей (например, в разделах **Параметры переназначения папок** или **Roaming User Profiles Settings** (Параметры перемещаемых профилей пользователей)), а затем выберите команду **Изменить**.
2. Чтобы включить поддержку основных компьютеров с использованием групповой политики на основе компьютеров, перейдите в раздел **Конфигурация компьютера**. Для групповой политики на основе пользователей перейдите на вкладку **Конфигурация пользователя**.
    - Групповая политика на основе компьютеров применяет настройки основного компьютера ко всем компьютерам, к которым применяется GPO, в результате влияя на всех пользователей компьютеров.
    - Групповая политика на основе пользователей применяет настройки основного компьютера ко всем учетным записям пользователей, к которым применяется GPO, влияя на все компьютеры, куда пользователи выполнили вход.
3. В разделе **Конфигурация компьютера** или **Конфигурация пользователя** перейдите к элементу **Политики**, затем щелкните **Административные шаблоны**, **Система**, а затем **Перенаправление папок**.
4. Щелкните правой кнопкой мыши **Перенаправлять папки только на основных компьютерах**, а затем выберите пункт **Изменить**.
5. Выберите **Включено**, а затем нажмите кнопку **ОК**.

## <a name="step-3-optionally-enable-primary-computers-for-roaming-user-profiles-in-group-policy"></a>Шаг 3. Включение перемещаемых профилей пользователей в групповой политике на основных компьютерах (необязательно)

Далее в групповой политике можно настроить перемещаемые профили пользователей для основных компьютеров. Это позволяет перемещать профили пользователей на компьютеры, назначенные в качестве основных компьютеров, но не на другие компьютеры.

Вот как включить поддержку основных компьютеров для перемещаемых профилей пользователей:

1. Включите поддержку перенаправления папок на основных компьютерах, если это еще не сделано.<br>Это позволяет сохранить документы и другие пользовательские файлы вне профилей пользователей, что помогает уменьшить размер профилей и быстро входить в систему.
2. В средстве "Управления групповыми политиками" щелкните правой кнопкой мыши GPO, который вы создали (например, в разделе **Roaming User Profiles Settings** (Параметры перемещаемых профилей пользователей)), а затем выберите команду **Изменить**.
3. Перейдите к разделу **Конфигурация компьютера**, щелкните **Политики**, **Административные шаблоны**, **Система**, а затем **Профили пользователей**.
4. Щелкните правой кнопкой мыши элемент **Загружать перемещаемые профили только на основные компьютеры**, а затем выберите команду **Изменить**.
5. Выберите **Включено**, а затем нажмите кнопку **ОК**.

## <a name="step-4-enable-the-gpo"></a>Шаг 4. Включение GPO

После завершения настройки перенаправления папок и перемещаемых профилей пользователей включите GPO, если он еще не включен. Это позволяет применить GPO к затронутым пользователям и компьютерам.

Вот как включить GPO для перенаправления папок или перемещаемых профилей пользователей:

1. Откройте средство "Управление групповой политикой".
2. Щелкните правой кнопкой мыши созданные вами объекты групповой политики и выберите пункт **Связь включена**. Рядом с соответствующим пунктом меню появится флажок.

## <a name="step-5-test-primary-computer-function"></a>Шаг 5. Проверка функциональности основного компьютера

Чтобы проверить поддержку основного компьютера, войдите на основной компьютер, убедитесь, что папки и профили перенаправлены, затем войдите на компьютер, не являющийся основным, и убедитесь, что папки и профили не перенаправляются.

Вот как протестировать функциональность основного компьютера:

1. Войдите в систему основного компьютера при помощи учетной записи пользователя, для которого вы настроили перенаправление папок и перемещаемые профили.
2. Если вход на компьютер уже выполнен с помощью учетной записи пользователя, откройте сеанс Windows PowerShell или окно командной строки от имени администратора, введите следующую команду и выйдите из системы, чтобы убедиться, что новые параметры групповой политики применены к клиентскому компьютеру:

    ```PowerShell
    Gpupdate /force
    ```

3. Откройте проводник.
1. Щелкните правой кнопкой мыши перенаправленную папку (например, "Мои документы" в библиотеке документов) и выберите пункт **Свойства**.
1. Перейдите на вкладку **Местоположение** и убедитесь, что отображается путь к указанной общей папке, а не локальный путь. Чтобы убедиться, что профиль пользователя перемещается, перейдите в **Панель управления**, выберите разделы **Система и безопасность**, **Система**, **Дополнительные параметры системы**, щелкните элемент **Параметры** в разделе с профилями пользователей и убедитесь, что в столбце **Тип** есть надпись **Перемещение**.
1. Войдите с использованием той же учетной записи на компьютер, который не задан как основной компьютер пользователя.
1. Повторите шаги 2–5, чтобы найти локальные пути и тип **локального** профиля.

> [!NOTE]
> Если папки перенаправлены на компьютер до включения поддержки основных компьютеров, папки останутся перенаправленными, если для каждой папки не будет настроен следующий параметр политики перенаправления: **Перенаправьте папку обратно в локальное местоположение профиля пользователя при удалении политики**. Аналогичным образом, для профилей, ранее перемещенных на определенном компьютере, будет отображаться состояние **Перемещаемый** в столбцах **Тип**. Тем не менее, в столбце **Состояние** будет отображаться надпись **Локальный**.

## <a name="more-information"></a>Дополнительные сведения

- [Развертывание перенаправления папок с помощью автономных файлов](deploy-folder-redirection.md)
- [Развертывание перемещаемых профилей пользователя](deploy-roaming-user-profiles.md)
- [Общие сведения о перенаправлении папок, автономных файлах и перемещаемых профилях пользователей](folder-redirection-rup-overview.md).
- [Подробности работы с основными компьютерами Windows 8](/archive/blogs/askds/digging-a-little-deeper-into-windows-8-primary-computer)
