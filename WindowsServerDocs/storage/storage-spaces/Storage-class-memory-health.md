---
ms.assetid: 2bab6bf6-90e7-46a7-b917-14a7a8f55366
title: Управление работоспособностью памяти хранилища (NVDIMM-N) в Windows
ms.prod: windows-server
ms.author: jgerend
manager: dongill
ms.technology: storage-spaces
ms.topic: article
author: JasonGerend
ms.date: 06/25/2019
ms.localizationpriority: medium
ms.openlocfilehash: cda974bf264c7e497c8d472338cf7b5f7d13a534
ms.sourcegitcommit: acfdb7b2ad283d74f526972b47c371de903d2a3d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2020
ms.locfileid: "87769053"
---
# <a name="storage-class-memory-nvdimm-n-health-management-in-windows"></a>Управление работоспособностью памяти хранилища (NVDIMM-N) в Windows

> Область применения: Windows Server 2019, Windows Server 2016, Windows Server (половина ежегодного канала), Windows 10

В этой статье представлены сведения об обработке ошибок и управлении работоспособностью памяти хранилища (NVDIMM-N) в Windows для системных администраторов и ИТ-специалистов. Описаны различия между памятью хранилища и традиционными запоминающими устройствами.

Если вы не знакомы с поддержкой Windows устройств памяти хранилища, просмотрите обзор, представленный в следующих видеороликах.
- [Использование энергонезависимой памяти (NVDIMM-N) в качестве блочного хранилища в Windows Server 2016](https://channel9.msdn.com/Events/Build/2016/P466)
- [Использование энергонезависимой памяти (NVDIMM-N) в качестве хранилища с байтовым адресом в Windows Server 2016](https://channel9.msdn.com/Events/Build/2016/P470)
- [Ускорение SQL Server 2016 с помощью постоянной памяти в Windows Server 2016](https://channel9.msdn.com/Shows/Data-Exposed/SQL-Server-2016-and-Windows-Server-2016-SCM--FAST)

См. также раздел [изучение и развертывание энергонезависимой памяти в Локальные дисковые пространства](deploy-pmem.md).

JEDEC-совместимые устройства памяти хранилища NVDIMM-N поддерживаются в Windows с помощью собственных драйверов начиная с Windows Server 2016 и Windows 10 (версия 1607). Эти устройства работают точно так же, как и другие диски (HDD и SSD), но есть некоторые отличия.

Все описанные здесь ситуации встречаются довольно редко и зависят от условий эксплуатации оборудования.

Рассмотренные ниже случаи могут относиться к конфигурациям дисковых пространств. Например, к конфигурации, в которой два устройства NVDIMM-N используются как зеркальный кэш обратной записи в дисковом пространстве. Чтобы настроить такую конфигурацию, см. статью о [настройке дисковых пространств с кэшем обратной записи NVDIMM-N](/sql/relational-databases/performance/configuring-storage-spaces-with-a-nvdimm-n-write-back-cache?view=sql-server-ver15).

В Windows Server 2016 графический пользовательский интерфейс дисковых пространств отображает тип шины NVDIMM-N как UNKNOWN (НЕИЗВЕСТНО). В этом выпуске не урезаны никакие функции и по-прежнему присутствует возможность создания пулов хранилищ виртуальных дисков. Тип шины можно проверить с помощью следующей команды:

```powershell
PS C:\>Get-PhysicalDisk | fl
```
Параметр BusType в выходных данных командлета правильно отобразит тип шины как "SCM".

## <a name="checking-the-health-of-storage-class-memory"></a>Проверка работоспособности памяти хранилища
Чтобы запросить сведения о работоспособности памяти хранилища, используйте указанные ниже команды в сеансе Windows PowerShell.

```powershell
PS C:\> Get-PhysicalDisk | where BusType -eq "SCM" | select SerialNumber, HealthStatus, OperationalStatus, OperationalDetails
```

Будут получены такие примеры результатов.

| SerialNumber | HealthStatus | OperationalStatus | OperationalDetails |
| --- | --- | --- | --- |
| 802c-01-1602-117cb5fc | Работоспособно | ОК | |
| 802c-01-1602-117cb64f | Предупреждение | Прогнозируемый сбой | {Превышено пороговое значение, ошибка NVDIMM\_N} |

> [!NOTE]
> Чтобы найти физическое расположение устройства NVDIMM-N, указанного в событии, перейдите в раздел **EventData** > **Расположение** на вкладке **Сведения** соответствующего события в компоненте "Просмотр событий". Обратите внимание, что в Windows Server 2016 расположение устройств NVDIMM-N указывается неверно, но эта проблема исправлена в Windows Server версии 1709.

Для получения сведений о различных состояниях работоспособности см. следующие разделы.

## <a name="warning-health-status"></a>Состояние работоспособности "Предупреждение"

Это состояние возникает, если при проверке работоспособности устройства памяти хранилища для него отображается значение **Предупреждение**, как показано в примере.

| SerialNumber | HealthStatus | OperationalStatus | OperationalDetails |
| --- | --- | --- | --- |
| 802c-01-1602-117cb5fc | Работоспособно | ОК | |
| 802c-01-1602-117cb64f | Предупреждение | Прогнозируемый сбой | {Превышено пороговое значение, ошибка NVDIMM\_N} |

В следующей таблице перечислены некоторые сведения об этом состоянии.

| Направление | Описание |
| --- | --- |
| Вероятное состояние | Предупреждение NVDIMM-N: превышено пороговое значение |
| Причина | Устройства NVDIMM-N отслеживают различные пороговые значения, например температуру, время действия NVM и/или источника энергии. При превышении одного из этих пороговых значений в операционную систему поступает соответствующее уведомление. |
| Общее поведение | Устройство сохраняет полную работоспособность. Это предупреждение, а не ошибка. |
| Поведение дисковых пространств | Устройство сохраняет полную работоспособность. Это предупреждение, а не ошибка. |
| Дополнительные сведения | Поле OperationalStatus объекта PhysicalDisk. Журнал событий — Microsoft-Windows-ScmDisk0101/Operational |
| Что следует делать | В зависимости от порогового значения, после превышения которого поступило предупреждение, возможно, понадобится заменить все устройство NVDIMM-N или некоторые его компоненты. Например, если превышено пороговое значение времени действия NVM, имеет смысл заменить NVDIMM-N. |

## <a name="writes-to-an-nvdimm-n-fail"></a>Сбой записи в NVDIMM-N

Это состояние возникает, если при проверке работоспособности устройства памяти хранилища для него отображается значение **Неработоспособное**, а для рабочего состояния появляется сообщение **Ошибка ввода-вывода**, как показано в этом примере:

| SerialNumber | HealthStatus | OperationalStatus | OperationalDetails |
| --- | --- | --- | --- |
| 802c-01-1602-117cb5fc | Работоспособно | ОК | |
| 802c-01-1602-117cb64f | Unhealthy | {Устаревшие метаданные, ошибка ввода-вывода, временная ошибка} | {Потеря сохраняемости данных, потеря данных, NV...} |

В следующей таблице перечислены некоторые сведения об этом состоянии.

| Направление | Описание |
| --- | --- |
| Вероятное состояние | Потеря сохраняемости / питания для резервного копирования |
|Причина|Устройствам NVDIMM-N для сохранения данных требуется резервный источник питания. Обычно это батарея или суперконденсатор. Если резервный источник питания недоступен или устройство не может его использовать по любой причине (ошибка контроллера или флэш-памяти), данные подвергаются риску и ОС Windows запрещает для таких устройств любые последующие операции записи. Для эвакуации данных сохраняется возможность чтения.|
|Общее поведение|Том NTFS будет отключен.<br>В поле состояния работоспособности PhysicalDisk будет отображаться значение "Неработоспособное" для всех устройств NVDIMM-N в зоне риска.|
|Поведение дисковых пространств|Дисковое пространство будет оставаться работоспособным до тех пор, пока в зоне риска будет только одно устройство NVDIMM-N. Если в зону риска попадет несколько устройств, запись в дисковом пространстве не будет выполнена. <br>В поле состояния работоспособности PhysicalDisk будет отображаться значение "Неработоспособное" для всех устройств NVDIMM-N в зоне риска.|
|Дополнительные сведения|Поле OperationalStatus объекта PhysicalDisk.<br>Журнал событий — Microsoft-Windows-ScmDisk0101/Operational|
|Что следует делать|Рекомендуется выполнить резервное копирование данных на устройствах NVDIMM-N в зоне риска. Чтобы получить доступ для чтения, можно вручную перевести диск в оперативный режим (он отобразится как том NTFS только для чтения).<br><br>Чтобы полностью удалить это состояние, необходимо устранить основную причину (т. е. в зависимости от проблемы провести обслуживание источника питания или заменить NVDIMM-N). Том на NVDIMM-N должен быть переведен в автономный режим, а затем снова в оперативный, либо же необходимо перезагрузить систему.<br><br>Чтобы устройство NVDIMM-N снова можно было использовать в дисковых пространствах, воспользуйтесь командлетом **Reset-PhysicalDisk**, который повторно интегрирует устройство и запустит процесс восстановления.|

## <a name="nvdimm-n-is-shown-with-a-capacity-of-0-bytes-or-as-a-generic-physical-disk"></a>Для устройства NVDIMM-N отображается емкость 0 байт, или устройство распознается как "Универсальный физический диск".

Это состояние возникает, если устройство памяти хранилища не удается инициализировать, поскольку для его емкости отображается значение "0 байт". Или оно распознается как объект "Общий физический диск" в рабочем состоянии **Связь потеряна**, как показано в примере ниже.

| SerialNumber | HealthStatus | OperationalStatus | OperationalDetails |
| --- | --- | --- | --- |
|802c-01-1602-117cb5fc|Работоспособно|ОК||
||Предупреждение|Связь потеряна||

В следующей таблице перечислены некоторые сведения об этом состоянии.

|Направление|Описание|
|---|---|
|Вероятное состояние|BIOS не предоставляет NVDIMM-N для ОС|
|Причина|Устройства NVDIMM-N созданы для DRAM. При ссылке на поврежденный адрес DRAM большинство процессоров инициируют проверку компьютера и перезагрузку сервера. В таком случае некоторые серверные платформы отключают привязку NVDIMM, предотвращая доступ к нему ОС, осуществление которого может сопровождаться повторной проверкой системы. Кроме того, это может произойти, если BIOS обнаруживает, что произошел сбой NVDIMM-N и устройство необходимо заменить.|
|Общее поведение|NVDIMM-N отображается как неинициализированное устройство емкостью 0 байт, недоступное для чтения или записи.|
|Поведение дисковых пространств|Дисковое пространство сохраняет работоспособность (при условии, что в зоне риска только одно устройство NVDIMM-N).<br>Объект PhysicalDisk NVDIMM-N отображается как "Общий физический диск" с состоянием работоспособности "Предупреждение".|
|Дополнительные сведения|Поле OperationalStatus объекта PhysicalDisk. <br>Журнал событий — Microsoft-Windows-ScmDisk0101/Operational|
|Что следует делать|Устройства NVDIMM-N должны быть заменены или обработаны таким образом, чтобы серверная платформа снова предоставляла их для ОС узла. Рекомендуется замена устройства, иначе могут произойти дополнительные неустранимые ошибки. Новое устройство для замены в конфигурации дисковых пространств можно добавить при помощи командлета **Add-Physicaldisk**.|

## <a name="nvdimm-n-is-shown-as-a-raw-or-empty-disk-after-a-reboot"></a>После перезагрузки устройство NVDIMM-N отображается как RAW или пустой диск

Это состояние возникает, если при проверке работоспособности устройства памяти хранилища для него отображается сообщение **Неработоспособно**, а значение рабочего статуса — **Нераспознанные метаданные**, как показано в этом примере.

| SerialNumber | HealthStatus | OperationalStatus | OperationalDetails |
| --- | --- | --- | --- |
|802c-01-1602-117cb5fc|Работоспособно|ОК|{Неизвестно}|
|802c-01-1602-117cb64f|Unhealthy|{Нераспознанные метаданные, устаревшие метаданные}|{Неизвестно}|

В следующей таблице перечислены некоторые сведения об этом состоянии.

|Направление|Описание|
|---|---|
|Вероятное состояние|Сбой резервного копирования/восстановления|
|Причина|Сбой процедуры резервного копирования или восстановления, скорее всего, приведет к потере всех данных на NVDIMM-N. При загрузке операционной системы NVDIMM-N будет отображаться как новое устройство без секционирования или файловой системы и распознаваться как необработанные данные, что свидетельствует об отсутствии файловой системы.|
|Общее поведение|NVDIMM-N будет находиться в режиме только для чтения. Для возобновления использования потребуется явное действие пользователя.|
|Поведение дисковых пространств|Дисковые пространства сохраняют работоспособность (если в зоне риска только одно устройство NVDIMM).<br>Объект физического диска NVDIMM-N будет отображаться с состоянием работоспособности "Неработоспособно" и не будет использоваться дисковыми пространствами.|
|Дополнительные сведения|Поле OperationalStatus объекта PhysicalDisk.<br>Журнал событий — Microsoft-Windows-ScmDisk0101/Operational|
|Что следует делать|Если пользователь предпочитает не заменять устройство в зоне риска, можно воспользоваться командлетом **Reset-PhysicalDisk**, чтобы отменить состояние "только для чтения" для NVDIMM-N в зоне риска. В средах дисковых пространств также будет выполнена попытка повторно интегрировать NVDIMM-N в дисковое пространство и запустить процесс восстановления.|

## <a name="interleaved-sets"></a>Чередующиеся наборы

Чередующиеся наборы обычно создаются в BIOS платформах, чтобы несколько NVDIMM-N отображались как одно устройство для операционной системы узла.

Windows Server 2016 и Windows 10 Anniversary Edition не поддерживают чередующиеся наборы NVDIMM-N.

На время написания этой статьи не существует механизма, позволяющего операционной системе узла правильно определить отдельные NVDIMM-N в таком наборе и явно сообщить пользователю, какое устройство вызвало ошибку или требует обслуживания.
