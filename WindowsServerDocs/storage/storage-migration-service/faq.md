---
title: 'Служба миграции хранилища: часто задаваемые вопросы'
description: Часто задаваемые вопросы о службе миграции хранилища, например о том, какие файлы исключаются из передачи при переходе с одного сервера на другой.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 06/02/2020
ms.topic: article
ms.prod: windows-server
ms.technology: storage
ms.openlocfilehash: efe16dd9bdc971b97bc401cf10e14439c46069de
ms.sourcegitcommit: d99bc78524f1ca287b3e8fc06dba3c915a6e7a24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87181740"
---
# <a name="storage-migration-service-frequently-asked-questions-faq"></a>Служба миграции хранилища: часто задаваемые вопросы

Этот раздел содержит ответы на часто задаваемые вопросы об использовании [службы миграции хранилища](overview.md) для миграции серверов.

## <a name="what-files-and-folders-are-excluded-from-transfers"></a>Какие файлы и папки исключаются из передачи?

Служба миграции хранилища не переносит файлы или папки, которые могут помешать работе Windows. В частности, мы не будем переносить и перемещать в папку Приксистингдата в месте назначения:

- Windows, Program Files, Program Files (x86), Program Data, Users
- $Recycle. bin, Recycle, очистки, сведения о системном томе, $UpgDrv $, $SysReset, $Windows. ~ BT, $Windows. ~ LS, Windows. old, Загрузка, восстановление, документы и параметры
- pagefile.sys, hiberfil.sys, swapfile.sys, winpepge.sys, config.sys, bootsect. bak, bootmgr, бутнкст
- Любые файлы или папки на исходном сервере, которые конфликтуют с исключенными папками в назначении. <br>Например, если в источнике есть папка Н:\виндовс и она сопоставлена с папкой C:\ том в месте назначения, он не переносится, независимо от того, что он содержит, так как он повлияет на системную папку C:\Windows в месте назначения.

## <a name="are-locked-files-migrated"></a>Перенесены ли заблокированные файлы?

Служба миграции хранилища не выполняет миграцию файлов, которые монопольно заблокировали приложения. Служба автоматически повторяет попытку три раза с 60-секундной задержкой между попытками, и вы можете управлять количеством попыток и задержкой. Можно также повторно выполнить передачи, чтобы скопировать только те файлы, которые ранее были пропущены из-за нарушений общего доступа.

## <a name="are-domain-migrations-supported"></a>Поддерживаются ли миграция доменов?

Служба миграции хранилища не допускает миграцию между доменами Active Directory. Миграция между серверами всегда будет присоединять целевой сервер к тому же домену. Учетные данные миграции можно использовать из разных доменов в Active Directory лесу. Служба миграции хранилища поддерживает миграцию между рабочими группами.

## <a name="are-clusters-supported-as-sources-or-destinations"></a>Поддерживаются ли кластеры как источники или назначения?

Служба миграции хранилища поддерживает миграцию с кластерами и в кластеры после установки накопительного обновления [KB4513534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) или последующих обновлений. Это включает миграцию из исходного кластера в целевой, а также миграцию с автономного исходного сервера на целевой кластер для целей консолидации устройств. Однако вы не можете перенести кластер на отдельный сервер.

## <a name="do-local-groups-and-local-users-migrate"></a>Переносятся ли локальные группы и локальные пользователи?

Служба миграции хранилища поддерживает миграцию локальных пользователей и групп после установки накопительного пакета обновления [KB4513534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) или последующих обновлений.

## <a name="is-domain-controller-migration-supported"></a>Поддерживается ли миграция контроллера домена?

В настоящее время служба миграции хранилища не выполняет миграцию контроллеров домена в Windows Server 2019. В качестве обходного решения при условии, что в домене Active Directory несколько контроллеров домена, понизьте контроллер домена перед переносом, а затем перенесите назначение после вырезания по завершении. Если вы решили перенести источник или назначение контроллера домена, вы не сможете выполнить вырезание. Не следует переносить пользователей и группы при миграции с контроллера домена или на него.

## <a name="what-attributes-are-migrated-by-the-storage-migration-service"></a>Какие атрибуты переносятся службой миграции хранилища?

Служба миграции хранилища переносит все флаги, параметры и безопасность общих ресурсов SMB. Этот список флагов, переносимых службой миграции хранилища, включает:

    - Общее состояние
    - Тип доступности
    - Тип общего ресурса
    - Режим перечисления папок *(перечисление на основе доступа или ABE)*
    - Режим кэширования
    - Режим аренды
    - Экземпляр SMB
    - Время ожидания ЦС
    - Ограничение одновременных пользователей
    - Постоянно доступно
    - Описание
    - Шифрование данных
    - Удаленное взаимодействие удостоверений
    - Инфраструктура
    - Имя
    - путь
    - Область действия
    - Имя области
    - Дескриптор безопасности
    - Теневое копирование
    - Специальные функции
    - Временные таблицы

## <a name="can-i-consolidate-multiple-servers-into-one-server"></a>Можно ли объединить несколько серверов в один сервер?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает консолидацию нескольких серверов в одном сервере. Примером консолидации будет перенос трех отдельных исходных серверов, которые могут иметь одни и те же имена общих папок и пути к локальным файлам, на один новый сервер, виртуализированный этими путями и общими папками, чтобы предотвратить перекрытие или конфликт, а затем ответить на все три предыдущие имена серверов и IP-адрес. Однако можно перенести отдельные серверы на несколько ресурсов файлового сервера в одном кластере.

## <a name="can-i-migrate-from-sources-other-than-windows-server"></a>Можно ли выполнить миграцию из источников, отличных от Windows Server?

Служба миграции хранилища поддерживает миграцию с серверов Samba Linux после установки накопительного пакета обновления [KB4513534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) или последующих обновлений. См. требования к списку поддерживаемых версий Samba и дистрибутивов для Linux.

## <a name="can-i-migrate-previous-file-versions"></a>Можно ли перенести предыдущие версии файлов?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает миграцию предыдущих версий (сделанных со службой теневого копирования томов) файлов. Будет перенесена только текущая версия.

## <a name="optimizing-inventory-and-transfer-performance"></a>Оптимизация инвентаризации и производительности при переносе

Служба переноса хранилища содержит многопоточное средство чтения и копирования, которое называется службой прокси-службы миграции хранилища, которая предназначена для быстрого и значительного анализа данных, недостаточных для копирования файлов. Хотя конфигурация по умолчанию будет оптимальной для многих клиентов, существуют способы повышения производительности SMS во время инвентаризации и перемещения.

- **Используйте Windows Server 2019 для целевой операционной системы.** Windows Server 2019 содержит прокси-службу службы миграции хранилища. При установке этого компонента и переходе на узел назначения Windows Server 2019 все операции передачи работают как прямая линия анализа между источником и назначением. Эта служба выполняется в Orchestrator во время передачи, если конечные компьютеры — Windows Server 2012 R2 или Windows Server 2016, то есть передача данных в два прыжка и будет значительно ниже. Если на компьютерах назначения Windows Server 2012 R2 или Windows Server 2016 имеется несколько заданий, то Orchestrator станет узким местом.

- **Изменение потоков перемещения по умолчанию.** Служба прокси-сервера службы миграции хранилища копирует 8 файлов одновременно в заданном задании. Количество одновременных потоков копирования можно увеличить, изменив следующее значение реестра REG_DWORD имя значения в десятичном формате на каждом узле, на котором выполняется прокси-сервер службы миграции хранилища:

    HKEY_Local_Machine \Софтваре\микрософт\смспрокси

    филетрансферсреадкаунт

   Допустимый диапазон — от 1 до 512 в Windows Server 2019. Вам не нужно перезапускать службу, чтобы приступить к использованию этого параметра при условии создания нового задания. Будьте внимательны с этим параметром. Установка этого параметра может потребовать дополнительных ядер, производительности хранилища и пропускной способности сети. Слишком большое значение может привести к снижению производительности по сравнению с параметрами по умолчанию.

- **Изменение параллельных потоков общего доступа по умолчанию.** Прокси-служба службы миграции хранилища копирует из 8 общих папок одновременно в заданном задании. Вы можете увеличить число одновременных потоков совместного доступа, изменив следующие значения реестра REG_DWORD в десятичном формате на сервере Orchestrator службы миграции хранилища:

    HKEY_Local_Machine \Софтваре\микрософт\смс

    ендпоинтфилетрансфертасккаунт

   Допустимый диапазон — от 1 до 512 в Windows Server 2019. Вам не нужно перезапускать службу, чтобы приступить к использованию этого параметра при условии создания нового задания. Будьте внимательны с этим параметром. Установка этого параметра может потребовать дополнительных ядер, производительности хранилища и пропускной способности сети. Слишком большое значение может привести к снижению производительности по сравнению с параметрами по умолчанию.

    Сумма Филетрансферсреадкаунт и Ендпоинтфилетрансфертасккаунт — это количество файлов, которые служба миграции хранилища может одновременно копировать из одного исходного узла в задании. Чтобы добавить более Параллельные исходные узлы, создайте и запустите более одновременные задания.

- **Добавление ядер и памяти.**  Настоятельно рекомендуется, чтобы на исходном, Orchestrator и конечном компьютерах имелось по крайней мере два ядра процессора или два виртуальных ЦП, и многие из них могут значительно повысить производительность инвентаризации и перемещения, особенно при объединении с Филетрансферсреадкаунт (выше). При передаче файлов, размер которых превышает стандартную производительность передачи для форматов Office (гигабайт или больше), будет выгоднее использовать больше памяти, чем минимум 2 ГБ.

- **Создание нескольких заданий.** При создании задания с несколькими источниками серверов к каждому серверу применяется последовательная связь для инвентаризации, передачи и прямую миграцию. Это означает, что каждый сервер должен завершить свой этап перед запуском другого сервера. Чтобы параллельно запустить больше серверов, просто создайте несколько заданий, каждый из которых содержит только один сервер. SMS поддерживает до 100 одновременно выполняющихся заданий, то есть одна Orchestrator может параллельно использовать множество конечных компьютеров Windows Server 2019. Не рекомендуется запускать несколько параллельных заданий, если конечные компьютеры работают под управлением Windows Server 2016 или Windows Server 2012 R2, как если бы служба прокси-сервера SMS не была запущена на целевом объекте, Orchestrator должна выполнить все передачи и стать узким местом. Возможность параллельного выполнения серверов внутри одного задания — это функция, которую планируется добавить в более поздней версии SMS.

- **Используйте SMB 3 с сетями RDMA.** При передаче с компьютера с ОС Windows Server 2012 или более поздней версии SMB 3. x поддерживает режим SMB Direct и сети RDMA. RDMA перемещает большую часть ресурсов ЦП на передачу процессоров материнской платы в интегрированные сетевые адаптеры, уменьшая задержку и загрузку ЦП сервера. Кроме того, сети RDMA, такие как РОЦЕ и iWARP, обычно имеют значительно большую пропускную способность, чем обычно TCP/Ethernet, включая 25, 50 и 100 ГБ на интерфейс. Использование SMB Direct обычно перемещает ограничение скорости передачи из сети в само хранилище.

- **Используйте многоканальный протокол SMB 3.** При передаче с компьютера с ОС Windows Server 2012 или более поздней версии SMB 3. x поддерживает многоканальные копии, что может значительно повысить производительность копирования файлов. Эта функция работает автоматически при условии, что у источника и назначения есть:

   - несколько сетевых адаптеров;
   - Один или несколько сетевых адаптеров, поддерживающих масштабирование на стороне приема (RSS)
   - Один или несколько сетевых адаптеров, настроенных с помощью объединения сетевых карт
   - один или несколько сетевых адаптеров с поддержкой RDMA.

- **Обновление драйверов.** При необходимости установите последние версии встроенного по и драйверов для хранилища и микропрограммного обеспечения поставщика, последние драйверы HBA поставщика, последнюю версию встроенного по для производителей BIOS/UEFI, последние драйверы сети поставщика и новейшие драйверы набора микросхем для материнских устройств на исходных, целевых и Orchestrator серверах. Перезапустите узлы при необходимости. Для настройки общих хранилищ и сетевого оборудования обратитесь к документации поставщика оборудования.

- **Включить высокопроизводительную обработку.** Убедитесь, что для параметров BIOS или UEFI настроена высокая производительность, например отключено C-состояние, установлена скорость QPI, включена архитектура NUMA и установлена максимально возможная частота памяти. Убедитесь, что для параметра Управление питанием в Windows Server установлено значение Высокая производительность. При необходимости перезагрузите компьютер. Не забудьте вернуть их в соответствующие состояния после завершения миграции.

- **Настройка оборудования** Ознакомьтесь с [рекомендациями по настройке производительности для Windows server 2016](/windows-server/administration/performance-tuning/) для настройки Orchestrator и конечных компьютеров под управлением windows Server 2019 и windows Server 2016. Раздел " [Настройка производительности сетевой подсистемы](../../networking/technologies/network-subsystem/net-sub-performance-tuning-nics.md) " содержит особенно ценные сведения.

- **Используйте более быстрое хранилище.** В то время как может быть трудно обновить скорость хранения исходного компьютера, следует обеспечить, чтобы целевое хранилище было как можно быстрее при операции записи ввода-вывода, так как источником является производительность чтения ввода-вывода, чтобы гарантировать отсутствие ненужных узких мест при передаче. Если назначением является виртуальная машина, убедитесь, что по крайней мере в целях миграции она выполняется на наиболее быстром уровне хранилища на узлах гипервизора, например на уровне Flash или с Локальные дисковые пространства кластерах ХЦИ, использующих зеркальные все Flash-или гибридные пространства. После завершения миграции SMS можно выполнить динамическую миграцию виртуальной машины на более медленный уровень или узел.

- **Обновление антивирусной программы.** Всегда проследите за тем, чтобы на исходном и целевом компьютерах выполнялась последняя исправленная версия антивирусной программы, чтобы обеспечить минимальные затраты на производительность. В качестве теста можно *временно* исключить проверку папок, которые вы выполняете инвентаризацию или миграцию на исходном и целевом серверах. Если скорость перемещения улучшена, обратитесь к поставщику антивирусного по, чтобы получить инструкции или обновленную версию антивирусной программы или объяснение ожидаемого снижения производительности.

## <a name="can-i-migrate-from-ntfs-to-refs"></a>Можно ли выполнить миграцию из NTFS в REFS?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает миграцию с файловой системы NTFS на REFS. Можно выполнить миграцию из NTFS в NTFS и REFS в ReFS. Это связано с множеством различий в функциональности, метаданных и других аспектах, которые ReFS не дублируют из NTFS. ReFS предназначено как файловая система рабочей нагрузки приложения, а не Общая файловая система. Дополнительные сведения см. в разделе [Общие сведения о отказоустойчивой файловой системе (ReFS)](../refs/refs-overview.md) .

## <a name="can-i-move-the-storage-migration-service-database"></a>Можно ли переместить базу данных службы миграции хранилища?

Служба миграции хранилища использует базу данных модуля расширенного хранилища (ESE), которая устанавливается по умолчанию в скрытой папке к:\програмдата\микрософт\сторажемигратионсервице. Эта база данных будет расти по мере добавления заданий и завершения передачи и может потреблять значительное дисковое пространство после переноса миллионов файлов, если не удалить задания. Если необходимо переместить базу данных, выполните следующие действия.

1. На компьютере Orchestrator следует отключить службу "Служба миграции хранилища".
2. Стать владельцем `%programdata%/Microsoft/StorageMigrationService` папки
3. Добавьте учетную запись пользователя, чтобы полностью контролировать этот общий ресурс и все его файлы и вложенные папки.
4. Переместите папку на другой диск на компьютере Orchestrator.
5. Задайте следующее значение REG_SZ реестра:

    HKEY_Local_Machine \Софтваре\микрософт\смс DatabasePath = *путь к новой папке базы данных на другом томе*

6. Убедитесь, что система имеет полный доступ ко всем файлам и вложенным папкам этой папки.
7. Удалите разрешения собственных учетных записей.
8. Запустите службу "Служба миграции хранилища".

## <a name="does-the-storage-migration-service-migrate-locally-installed-applications-from-the-source-computer"></a>Переносят ли служба миграции хранилища локально установленные приложения с исходного компьютера?

Нет, служба миграции хранилища не выполняет миграцию локально установленных приложений. После завершения миграции переустановите все приложения на конечный компьютер, работающий на исходном компьютере. Нет необходимости перенастраивать пользователей или их приложения; Служба миграции хранилища предназначена для того, чтобы сделать сервер невидимым для клиентов.

## <a name="what-happens-with-existing-files-on-the-destination-server"></a>Что происходит с существующими файлами на целевом сервере?

При выполнении переноса служба миграции хранилища выполняет поиск зеркальных данных с исходного сервера. Целевой сервер не должен содержать рабочие данные или подключенных пользователей, так как эти данные могут быть перезаписаны. По умолчанию при первом переносе резервная копия всех данных на целевом сервере создается в качестве меры предосторожности. Во всех последующих передачах по умолчанию служба миграции хранилища будет зеркально размещать данные в целевом объекте. Это означает не только добавление новых файлов, но и произвольное перезапись существующих файлов и удаление всех файлов, отсутствующих в источнике. Такое поведение является намеренным и обеспечивает оптимальное качество исходного компьютера.

## <a name="what-do-the-error-numbers-mean-in-the-transfer-csv"></a>Что означают номера ошибок в CSV-файле перемещения?

Большинство ошибок, обнаруженных в CSV-файле для перемещения, являются системными кодами ошибок Windows. Сведения о каждой ошибке можно узнать, просмотрев [документацию по кодам ошибок Win32](/windows/win32/debug/system-error-codes).

## <a name="what-are-my-options-to-give-feedback-file-bugs-or-get-support"></a><a name="give-feedback"></a>Какие варианты можно оставить для отправки отзыва, ошибок в файлах или получения поддержки?

Чтобы отправить отзыв о службе миграции хранилища, сделайте следующее:

- Используйте средство "центр обратной связи", включенное в Windows 10, щелкнув "предложить функцию" и указав категорию "Windows Server" и подкатегорию "миграция хранилища".
- Использование сайта [Windows Server UserVoice](https://windowsserver.uservoice.com)
- адрес электронной почты smsfeed@microsoft.com.

Для файлов ошибок:

- Используйте средство "центр обратной связи", входящее в Windows 10, щелкнув "сообщить о проблеме" и указав категорию "Windows Server" и подкатегорию "миграция хранилища".
- Откройте обращение в службу поддержки через [Служба поддержки Майкрософт](https://support.microsoft.com)

Для получения поддержки:

 - Публикация вопроса в техническом [сообществе Windows Server](https://techcommunity.microsoft.com/t5/Windows-Server/ct-p/Windows-Server)
 - Публикация на [форуме по Windows Server 2019](https://docs.microsoft.com/answers/topics/windows-server-2019.html)
 - Откройте обращение в службу поддержки через [Служба поддержки Майкрософт](https://support.microsoft.com)

## <a name="additional-references"></a>Дополнительные ссылки

- [Обзор службы миграции хранилища](overview.md)
