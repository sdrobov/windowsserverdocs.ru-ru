---
title: Развертывание сетевой файловой системы
description: Описывает развертывание сетевой файловой системы.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 22c8725c227719ee143baa8f4abd3a5cc5dcf883
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71393969"
---
# <a name="deploy-network-file-system"></a>Развертывание сетевой файловой системы

>Относится к: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Сетевая файловая система (NFS) предоставляет решение для совместного использования файлов, позволяющее передавать файлы между компьютерами под управлением операционных систем Windows Server и UNIX с помощью протокола NFS. В этом разделе описаны действия, которые необходимо выполнить для развертывания NFS.

## <a name="whats-new-in-network-file-system"></a>Новые возможности в сетевой файловой системе

Вот именно изменения для NFS в Windows Server 2012:

- **Поддержка NFS версии 4,1**. Эта версия протокола включает следующие улучшения.
  - Навигация по брандмауэрам упрощается, что повышает доступность.
  - Поддерживает протокол рпксек\_GSS, обеспечивая более надежную защиту и позволяя клиентам и серверам согласовывать безопасность.
  - Поддерживает семантику файлов UNIX и Windows.
  - Использует преимущества кластерных развертываний файловых серверов.
  - Поддерживает составные глобальные процедуры, поддерживающие глобальную сеть.

- **Модуль NFS для Windows PowerShell**. Доступность встроенных командлетов NFS упрощает автоматизацию различных операций. Имена командлетов согласуются с другими командлетами Windows PowerShell (с использованием глаголов, таких как Get и Set), что упрощает для пользователей, знакомых с Windows PowerShell, изучать использование новых командлетов.
- **Улучшения управления NFS**. Новая централизованная консоль управления на основе пользовательского интерфейса упрощает настройку и управление общими папками SMB и NFS, квотами, экранами и классификацией файлов в дополнение к управлению кластерными файловыми серверами.
- **Улучшения сопоставления удостоверений**. Новая поддержка пользовательского интерфейса и командлеты Windows PowerShell на основе задач для настройки сопоставления удостоверений, что позволяет администраторам быстро настраивать источник сопоставления удостоверений, а затем создавать отдельные сопоставленные удостоверения для пользователей. Улучшения облегчают администраторам настройку общего ресурса для доступа по нескольким протоколам как NFS, так и SMB.
- **Реструктуризация модели ресурсов кластера**. Это улучшение обеспечивает согласованность между моделью ресурсов кластера для серверов Windows NFS и протоколов SMB и упрощает администрирование. Для серверов NFS с большим количеством общих ресурсов сеть ресурсов и число вызовов инструментария WMI, требующих отработки отказа для тома, содержащего большое число общих папок NFS, сокращаются.
- **Интеграция с диспетчером ключей возобновления**. Диспетчер ключей возобновления является компонентом, отслеживающим файловый сервер и состояние файловой системы, и позволяет серверам протоколов Windows SMB и NFS выполнять отработку отказа без нарушения работы клиентов или серверных приложений, хранящих данные на файловом сервере. Это улучшение является ключевым компонентом возможности непрерывной доступности файлового сервера под Windows Server 2012.

## <a name="scenarios-for-using-network-file-system"></a>Сценарии использования сетевой файловой системы

NFS поддерживает смешанную среду операционных систем на основе Windows и UNIX. Следующие сценарии развертывания являются примерами того, как можно развернуть постоянно доступный файловый сервер Windows Server 2012 с помощью NFS.

### <a name="provision-file-shares-in-heterogeneous-environments"></a>Предоставление файловых ресурсов в разнородных средах

Этот сценарий относится к организациям с разнородными средами, которые состоят из Windows и других операционных систем, таких как клиентские компьютеры под управлением UNIX или Linux. В этом сценарии вы можете предоставить доступ с несколькими протоколами к одной и той же общей папке по протоколам SMB и NFS. Как правило, при развертывании файлового сервера Windows в этом сценарии необходимо упростить совместную работу пользователей на компьютерах под управлением Windows и UNIX. Если общая папка настроена, она используется совместно с протоколами SMB и NFS, когда пользователи Windows обращаются к своим файлам по протоколу SMB, а пользователи на компьютерах UNIX обычно обращаются к своим файлам по протоколу NFS.

Для этого сценария необходимо иметь действительную конфигурацию источника сопоставления удостоверений. Windows Server 2012 поддерживает следующие хранилища сопоставления удостоверений.

- Файл сопоставления
- Доменные службы Active Directory (AD DS)
- Хранилища LDAP, соответствующие RFC 2307, такие как службы Active Directory облегченного доступа к каталогам (AD LDS)
- Сервер сопоставление имен пользователей (УНМ)

### <a name="provision-file-shares-in-unix-based-environments"></a>Предоставление файловых ресурсов в средах на базе UNIX

В этом сценарии файловые серверы Windows развертываются в среде с предварительной средой UNIX, чтобы предоставить доступ к общим файловым ресурсам NFS для клиентских компьютеров на базе UNIX. Изначально параметр несопоставленного доступа пользователей UNIX (УУУА) был первоначально реализован для общих папок NFS в Windows Server 2008 R2, поэтому серверы Windows можно использовать для хранения данных NFS без создания сопоставления учетных записей UNIX и Windows. УУУА позволяет администраторам быстро подготавливать и развертывать NFS без необходимости настраивать сопоставление учетных записей. Если параметр включен для NFS, УУУА создает пользовательские идентификаторы безопасности (SID) для представления несопоставленных пользователей. Сопоставленные учетные записи пользователей используют стандартные идентификаторы безопасности Windows (SID), а несопоставленные пользователи используют настраиваемые идентификаторы (SID) NFS.

## <a name="system-requirements"></a>Системные требования

Сервер для NFS можно установить на любой версии Windows Server 2012. NFS можно использовать с компьютерами на базе UNIX, на которых выполняется NFS-сервер или клиент NFS, если эти серверные реализации NFS и клиенты соответствуют одной из следующих спецификаций протокола:

1. Спецификация протокола NFS версии 4,1 (как определено в RFC [5661](https://tools.ietf.org/html/rfc5661))
2. Спецификация протокола NFS версии 3 (как определено в RFC [1813](https://tools.ietf.org/html/rfc1813))
3. Спецификация протокола NFS версии 2 (как определено в RFC [1094](https://tools.ietf.org/html/rfc1094))

## <a name="deploy-nfs-infrastructure"></a>Развертывание инфраструктуры NFS

Необходимо развернуть следующие компьютеры и подключить их в локальной сети (LAN):

- Один или несколько компьютеров под управлением Windows Server 2012, на которых будут установлены две основные службы для компонентов NFS: Сервер для NFS и клиент для NFS. Эти компоненты можно установить на одном компьютере или на разных компьютерах.
- Один или несколько компьютеров на базе UNIX, на которых выполняется NFS-сервер и клиентское программное обеспечение NFS. На компьютере UNIX под управлением NFS-сервера размещается файловый ресурс NFS или экспорт, доступ к которому осуществляется с помощью компьютера под управлением Windows Server 2012 в качестве клиента с клиентом для NFS. Вы можете установить сервер NFS и клиентское программное обеспечение на одном компьютере UNIX или на разных компьютерах с ОС UNIX.
- Контроллер домена, работающий на функциональном уровне Windows Server 2008 R2. Контроллер домена предоставляет сведения о проверке подлинности пользователя и сопоставление для среды Windows.
- Если контроллер домена не развернут, можно использовать сервер служба NIS (NIS) для предоставления сведений о проверке подлинности пользователя для среды UNIX. Или, при желании, можно использовать файлы паролей и группы, которые хранятся на компьютере, на котором запущена служба сопоставление имен пользователей.

### <a name="install-network-file-system-on-the-server-with-server-manager"></a>Установите сетевую файловую систему на сервере с диспетчер сервера

1. В мастере добавления ролей и компонентов в разделе ролей сервера выберите **файловые службы и службы хранилища** (если они еще не установлены).
2. В разделе **файлы и службы iSCSI**выберите **файловый сервер** и **сервер для NFS**. Выберите **Добавить компоненты** , чтобы включить выбранные компоненты NFS.
3. Нажмите кнопку **установить** , чтобы установить компоненты NFS на сервере.

### <a name="install-network-file-system-on-the-server-with-windows-powershell"></a>Установка сетевой файловой системы на сервере с помощью Windows PowerShell

1. Запустите Windows PowerShell. Щелкните правой кнопкой мыши значок PowerShell на панели задач и выберите **Запуск от имени администратора**.
2. Выполните следующие команды Windows PowerShell:

```PowerShell
Import-Module ServerManager
Add-WindowsFeature FS-NFS-Service
Import-Module NFS
```

## <a name="configure-nfs-authentication"></a>Настройка проверки подлинности NFS

При использовании протоколов NFS версии 4,1 и NFS версии 3,0 доступны следующие параметры проверки подлинности и безопасности.

- РПКСЕК\_GSS
  - **Krb5**. Использует протокол Kerberos версии 5 для проверки подлинности пользователей перед предоставлением доступа к общей папке.
  - **Krb5i**. Использует протокол Kerberos версии 5 для проверки подлинности с помощью проверки целостности (CHECKSUM), которая проверяет, не были ли изменены данные.
  - **Krb5p** Использует протокол Kerberos версии 5, который проверяет подлинность трафика NFS с шифрованием для обеспечения конфиденциальности.
- ПРОВЕРКА\_ПОДЛИННОСТИ SYS

Кроме того, можно отказаться от использования авторизации сервера\_(Authentication sys), которая дает возможность включить Несопоставленный доступ пользователей. При использовании несопоставленного доступа пользователей можно указать, чтобы разрешить Несопоставленный доступ пользователей по UID/GID, который является значением по умолчанию или разрешить анонимный доступ.

Инструкции по настройке проверки подлинности NFS см. в следующем разделе.

## <a name="create-an-nfs-file-share"></a>Создание общей папки NFS

Файловый ресурс NFS можно создать с помощью диспетчер сервера или командлетов Windows PowerShell NFS.

### <a name="create-an-nfs-file-share-with-server-manager"></a>Создание общей папки NFS с диспетчер сервера

1. Войдите на сервер от имени члена локальной группы администраторов.
2. Автоматически запустится диспетчер сервера. Если он не запускается автоматически, нажмите кнопку **Пуск**, введите **servermanager. exe**, а затем выберите **Диспетчер сервера**.
3. Слева выберите **файл и службы хранилища**, а затем щелкните **Общие папки**.
4. Выберите **, чтобы создать общую папку, и запустите мастер создания общего ресурса**.
5. На странице **Выбор профиля** выберите **общий ресурс NFS — быстрый** или **NFS — дополнительно**, а затем нажмите кнопку **Далее**.
6. На странице **Общая** папка выберите сервер и том, а затем нажмите кнопку **Далее**.
7. На странице **имя общего ресурса** укажите имя новой общей папки и нажмите кнопку **Далее**.
8. На странице **Проверка подлинности** укажите метод проверки подлинности, который будет использоваться для этой общей папки.
9. На странице **разрешения для общего доступа** выберите **Добавить**, а затем укажите узел, группу клиентов или сетевую подгруппу, которой требуется предоставить разрешение на доступ к общей папке.
10. В окне **разрешения**настройте тип управления доступом, который должны иметь пользователи, и нажмите кнопку **ОК**.
11. На странице **Подтверждение** Проверьте конфигурацию и щелкните **создать** , чтобы создать общую папку NFS.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell

Следующий командлет Windows PowerShell также может создать файловый ресурс NFS (где `nfs1` — это имя общей папки, а `C:\\shares\\nfsfolder` — путь к файлу):

```PowerShell
New-NfsShare -name nfs1 -Path C:\shares\nfsfolder
```

### <a name="known-issue"></a>Известная проблема
NFS версии 4,1 позволяет создавать или копировать имена файлов с помощью недопустимых символов. Если вы попытаетесь открыть файлы с помощью редактора VI, она будет отображаться как поврежденная. Вы не можете сохранить файл из VI, переименовать, переместить или изменить разрешения. Старайтесь не использовать недопустимые символы.
