---
title: Развертывание удаленного доступа в кластере
description: Этот раздел является частью руководств по развертыванию удаленного доступа в кластере в Windows Server 2016.
manager: dougkim
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 7b9ab144c19b81d2229ea0618aebc9a94b9fdccf
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80861467"
---
# <a name="deploy-remote-access-in-a-cluster"></a>Развертывание удаленного доступа в кластере

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Windows Server 2016 и Windows Server 2012 объединяют службы DirectAccess и удаленного доступа \(RAS\) VPN в одну роль удаленного доступа. Удаленный доступ можно развернуть в ряде корпоративных сценариев. В этом обзоре содержатся общие сведения о корпоративном сценарии развертывания нескольких серверов удаленного доступа в кластерной балансировке нагрузки Windows \(NLB\) или с внешней подсистемой балансировки нагрузки \(ELB\), например F5 BIG\-IP.  

## <a name="scenario-description"></a><a name="BKMK_OVER"></a>Описание сценария  
При развертывании кластера несколько серверов удаленного доступа собираются в единый блок, который затем выступает в качестве единой точки контакта для удаленных клиентских компьютеров, подключающихся через DirectAccess или VPN к внутренней корпоративной сети с помощью внешнего виртуального IP-адреса \(\) адрес кластера удаленного доступа.  Трафик к кластеру распределяется с помощью балансировки сетевой нагрузки Windows или с внешней подсистемой балансировки нагрузки \(например F5 BIG\-IP\).  

## <a name="prerequisites"></a>Предварительные требования  
Перед началом развертывания этого сценария ознакомьтесь со списком важных требований.  

-   Балансировка нагрузки по умолчанию с помощью Windows NLB.  

-   Поддерживаются внешние подсистемы балансировки нагрузки.  

-   Одноадресный режим установлен по умолчанию и рекомендуется для NLB.  

-   Изменение политик вне консоли управления DirectAccess или командлетов PowerShell не поддерживается.  

-   При использовании балансировки сетевой нагрузки или внешней подсистемы балансировки нагрузки невозможно изменить префикс IPHTTPS на любой другой, кроме \/59.  

-   Узлы с балансировкой нагрузки узлы должны находиться в той же подсети IPv4.  

-   В ELB развертываниях, если требуется управление, клиенты DirectAccess не могут использовать&nbsp;Teredo. Для\-конечных\-можно использовать только IPHTTPS.  

-   Убедитесь, что установлены все известные исправления\/ELB балансировки сетевой нагрузки.  

-   ISATAP в корпоративной сети не поддерживается. Если вы используете протокол ISATAP, необходимо удалить его и перейти на собственный IPv6.  

## <a name="in-this-scenario"></a>Содержание сценария  
Сценарий развертывания в кластере включает несколько этапов.  

1.  [Разверните VPN-сервер Always On с дополнительными параметрами](../../vpn/always-on-vpn/deploy/always-on-vpn-adv-options.md). Перед настройкой развертывания кластера необходимо развернуть один сервер удаленного доступа с дополнительными параметрами.  

2.  [Спланируйте развертывание кластера удаленного доступа](plan/Plan-a-Remote-Access-Cluster-Deployment.md). Для создания кластера из развертывания с одним сервером требуется ряд дополнительных действий, включая подготовку сертификатов для развертывания кластера.  

3.  [Настройка кластера удаленного доступа](configure/Configure-a-Remote-Access-Cluster.md). Это состоит из нескольких этапов настройки, включая подготовку одного сервера для Windows NLB или внешней подсистемы балансировки нагрузки, подготовку дополнительных серверов к присоединению кластера и включение балансировки нагрузки.  

## <a name="practical-applications"></a><a name="BKMK_APP"></a>Практические приложения  
Объединение нескольких серверов в кластер серверов предоставляет следующие преимущества.  

-   Масштабируемость. Один сервер удаленного доступа обеспечивает ограниченный уровень надежности сервера и масштабируемой производительности. Посредством объединения ресурсов двух или более серверов в единый кластер вы увеличиваете емкость для количества пользователей и пропускную способность.  

-   Высокий уровень доступности. Кластер обеспечивает высокий уровень доступности всегда\-при доступе. Если происходит отказ одного из серверов в кластере, то удаленные пользователи могут сохранить доступ к корпоративной сети через другой сервер в кластере. Все серверы в кластере имеют одинаковый набор виртуальных IP-адресов \(VIP\), сохраняя при этом уникальные выделенные IP-адреса для каждого сервера.  

-   Простота\-управления\-. Кластер позволяет управлять несколькими серверами как единой сущностью. На всех серверах кластера можно легко установить общие параметры. Параметрами удаленного доступа можно управлять с любого сервера в кластере или удаленно с помощью средства удаленного администрирования сервера \(RSAT\). Кроме того, наблюдение за всем кластером можно осуществлять с одной консоли управления удаленным доступом.  

## <a name="roles-and-features-included-in-this-scenario"></a><a name="BKMK_NEW"></a>Роли и компоненты, входящие в этот сценарий  
В следующей таблице перечислены роли и компоненты, необходимые для сценария.  

|Функция\/ролей|Способ поддержки сценария|  
|---------|-----------------|  
|Роль удаленного доступа|Эта роль устанавливается и удаляется с помощью консоли Диспетчера серверов. Она включает DirectAccess, который ранее был компонентом в Windows Server 2008 R2, а также службы маршрутизации и удаленного доступа \(RRAS\), который ранее был службой роли в службах политики сети и доступа \(NPAS\) Server Role. Роль удаленного доступа включает два компонента.<p>-Always On VPN и службы маршрутизации и удаленного доступа \(RRAS\) VPN. Управление DirectAccess и VPN осуществляется вместе в консоли управления удаленным доступом.<br />— Маршрутизация RRAS. Управление функциями маршрутизации RRAS осуществляется с помощью устаревшей консоли маршрутизации и удаленного доступа.<p>Существуют следующие зависимости.<p>-Службы IIS \(IIS\) веб-сервер. Эта функция необходима для настройки сервера сетевых расположений и веб-проверки по умолчанию.<br />— Внутренняя база данных Windows — используется для локального учета на сервере удаленного доступа.|  
|Средства управления удаленным доступом|Этот компонент устанавливается описанным ниже образом.<p>— Он устанавливается по умолчанию на сервере удаленного доступа при установке роли удаленного доступа и поддерживает пользовательский интерфейс консоли удаленного управления.<br />— Его можно дополнительно установить на сервере, на котором не запущена роль сервера удаленного доступа. В этом случае компонент используется для удаленного управления компьютером с возможностью удаленного доступа, на котором установлены DirectAccess и VPN.<p>Средства управления удаленным доступом включают следующие элементы:<p>— Графический интерфейс удаленного доступа и средства командной строки<br />— Модуль удаленного доступа для Windows PowerShell<p>Зависимости включают следующее:<p>— Консоль управления групповыми политиками<br />— Пакет администрирования диспетчера подключений RAS \(CMAK\)<br />— Windows PowerShell 3,0<br />-Графические средства управления и инфраструктура|  
|Подсистема балансировки сетевой нагрузки|Данный компонент обеспечивает балансировку нагрузки в кластере при помощи компонента балансировки сетевой нагрузки Windows.|  

## <a name="hardware-requirements"></a><a name="BKMK_HARD"></a>Требования к оборудованию  
Для этого сценария действуют следующие требования к оборудованию.  

-   По крайней мере два компьютера соответствуют требованиям к оборудованию для Windows Server 2012.  

-   Для сценария с внешним Load Balancerом требуется специальное оборудование \(т. е. F5 BigIP\).  

-   Чтобы протестировать сценарий, необходимо иметь хотя бы один компьютер под управлением Windows 10, настроенный в качестве Always On VPN-клиента.   

## <a name="software-requirements"></a><a name="BKMK_SOFT"></a>Требования к программному обеспечению  
Для этого сценария действуют следующие требования.  

-   Требования к программному обеспечению для развертывания на одном сервере. Дополнительные сведения см. [в статье Развертывание одного сервера DirectAccess с дополнительными параметрами](../../directaccess/single-server-advanced/Deploy-a-Single-DirectAccess-Server-with-Advanced-Settings.md). Один удаленный доступ).  

-   Помимо требований к программному обеспечению для одного сервера существует ряд\-конкретных требований к кластеру:  

    -   На каждом сервере кластера имя субъекта сертификата IP-\-HTTPS должно совпадать с адресом ssASnoversion. Развертывание кластера поддерживает использование подстановочных знаков и не\-подстановочных сертификатов на серверах кластера.  

    -   Если на сервере удаленного доступа установлен сервер сетевых расположений, то на каждом сервере кластера сертификат сервера сетевых расположений должен иметь одно и то же имя субъекта. Кроме того, имя сертификата сервера сетевых расположений не должно совпадать с именем какого-либо сервера в развертывании DirectAccess.  

    -   Сертификаты IP-\-HTTPS и сервера сетевого расположения должны выдаваться с помощью того же метода, с которым был выдан сертификат для одного сервера. Например, если один сервер использует общедоступный центр сертификации \(CA\) то все серверы в кластере должны иметь сертификат, выданный общедоступным центром сертификации. Или, если один сервер использует самозаверяющий сертификат для IP-\-HTTPS, все серверы в кластере должны выполнять аналогично\-.  

    -   Префикс IPv6, назначенный клиентскому компьютеру DirectAccess в кластере сервера, должен иметь длину 59 бит. Если включена VPN, то префикс VPN тоже должен быть длиной 59 бит.  

## <a name="known-issues"></a><a name="KnownIssues"></a>Известные проблемы  
Ниже приводятся известные проблемы, возникающие при настройке сценария кластера.  

-   После настройки DirectAccess в IPv4\-развертывать только с одним сетевым адаптером, а после DNS64 по умолчанию \(IPv6-адрес, содержащий ": 3333::"\) автоматически настраивается на сетевом адаптере, при попытке включить балансировку нагрузки\-с помощью консоли управления удаленным доступом пользователь получает запрос на предоставление адреса IPv6 DIP. Если указать DIP IPv6, после нажатия кнопки **Зафиксировать** возникает ошибка: "Неправильный параметр".  

    Порядок разрешения этой проблемы  

    1.  Скачайте сценарии резервного копирования и восстановления из раздела [Настройка резервного копирования и восстановления конфигурации удаленного доступа](https://gallery.technet.microsoft.com/Back-up-and-Restore-Remote-e157e6a6).  

    2.  Создайте резервную копию объектов групповой политики удаленного доступа с помощью скачанного скрипта Backup\-RemoteAccess. ps1.  

    3.  Попытайтесь включить балансировку нагрузки, пока не возникнет ошибка. В диалоговом окне Включение балансировки нагрузки разверните область сведения, щелкните правой кнопкой мыши\-щелкните в области сведений и выберите **Копировать скрипт**.  

    4.  Откройте Блокнот и вставьте содержимое буфера обмена. Например:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0','fdc4:29bd:abde:3333::2/128') -InternetVirtualIPAddress @('fdc4:29bd:abde:3333::1/128', '10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    5.  Закройте все открытые диалоговые окна удаленного доступа и закройте консоль управления удаленным доступом.  

    6.  Измените вставленный текст и удалите IPv6-адреса. Например:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0') -InternetVirtualIPAddress @('10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    7.  В окне PowerShell с повышенными привилегиями выполните команду из предыдущего шага.  

    8.  Если выполнение командлета завершится сбоем \(не из-за неверных входных значений\), выполните команду RESTORE\-RemoteAccess. ps1 и следуйте инструкциям, чтобы убедиться, что целостность исходной конфигурации сохраняется.  

    9. Теперь снова откройте консоль управления удаленным доступом.  
