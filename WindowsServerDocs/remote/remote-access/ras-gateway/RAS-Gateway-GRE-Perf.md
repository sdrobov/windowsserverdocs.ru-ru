---
title: Производительность и пропускная способность туннеля GRE шлюза RAS-сервера
description: Эта статья, предназначенная для ИТ-специалистов, предоставляет сведения о производительности для туннелей GRE-трафика шлюза RAS.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.assetid: c051b2ec-de0f-49d1-82b9-5742b259cd7c
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 3ac381270714ecebc0aa624152700155fe170400
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80814467"
---
# <a name="ras-gateway-gre-tunnel-throughput-and-performance"></a>Производительность и пропускная способность туннеля GRE шлюза RAS-сервера

>Область применения: Windows Server \(полугодовой канал\)

С помощью этого раздела вы узнаете о сервере удаленного доступа \(службе RAS\) шлюза универсального инкапсуляции маршрутизации \(GRE\) производительность туннеля в Windows Server версии 1709 в сети, не определяемой программным обеспечением \(SDN\) в тестовой среде.

Шлюз RAS — это программный маршрутизатор и шлюз, которые можно использовать в режиме одного клиента или в режиме клиента. В этом разделе рассматривается однорежим клиента, конфигурация высокого уровня доступности с отказоустойчивой кластеризацией. Статистика производительности туннелирования GRE, представленная в этом разделе, действительна для шлюза RAS в режимах клиента Синжеле и в многоклиентской среде.

>[!NOTE]
>Отказоустойчивая кластеризация — это компонент Windows Server, позволяющий объединять несколько серверов в отказоустойчивый кластер. Дополнительные сведения см. в разделе [отказоустойчивая кластеризация](../../../failover-clustering/failover-clustering-overview.md) .

Режим "один клиент" позволяет организациям любого размера развертывать Шлюз в качестве внешней сети или в Интернете\-до\(VPN-\) Server. В режиме одного клиента можно развернуть шлюз RAS на физическом сервере или виртуальной машине \(\)ВИРТУАЛЬНОЙ машины. В этом разделе описывается развертывание шлюза RAS на двух виртуальных машинах \(виртуальных машин\), настроенных в отказоустойчивом кластере.

>[!IMPORTANT]
>Так как туннели GRE обеспечивают инкапсуляцию, но не шифрование, не следует использовать шлюз RAS, настроенный с помощью GRE, в качестве шлюза Интернет-интерфейсов. Дополнительные сведения об оптимальных способах использования шлюза RAS с туннелями GRE см. [в статье туннелирование GRE в Windows Server](gre-tunneling-windows-server.md).

GRE — это упрощенный протокол туннелирования, который может инкапсулировать широкий спектр протоколов сетевого уровня в виртуальную точку\-, чтобы\-ссылки на точки по сети протокола IP. Реализация Microsoft GRE инкапсулирует как IPv4, так и IPv6.

Дополнительные сведения см. в разделе **сценарии развертывания шлюза RAS** в разделе [шлюз RAS](https://docs.microsoft.com/windows-server/remote/remote-access/ras-gateway/ras-gateway#bkmk_deploy). 

В этом сценарии тестирования, который показан на следующем рисунке, переданный поток трафика перемещается из интрасети организации 2 в интрасеть Организации 1. Виртуальные машины рабочей нагрузки клиента отправляют сетевой трафик из интрасети 2 в интрасеть 1 с помощью шлюза RAS.

![Обзор сценария тестирования туннеля GRE шлюза RAS](../../media/GRE-Tunnel-Perf/Gre-Infrastructure.jpg)

## <a name="test-environment-configuration"></a>Конфигурация тестовой среды

В этом разделе содержатся сведения о среде тестирования и конфигурации шлюза RAS.

В тестовой среде виртуальные машины шлюза RAS развертываются на узлах Hyper\-V в отказоустойчивом кластере для обеспечения высокой доступности.

### <a name="hyper-v-host-configuration"></a>Конфигурация узла Hyper\-V

Два узла Hyper\-V настроены для поддержки сценария тестирования следующим образом. 

- Два сетевых физических компьютера с двумя\-ами настраиваются с помощью Windows Server, версия 1709
- Два физических сетевых адаптера на каждом из двух серверов подключены к разным подсетям. оба они представляют подсети интрасети организации. И сеть, и поддерживающее оборудование имеют емкость 10 Гбит/с.
- Технология Hyper-Threading на физических серверах отключена. Это обеспечивает максимальную пропускную способность от физических сетевых адаптеров.
- Роль сервера Hyper\-V устанавливается на обоих серверах и настраивается с помощью двух внешних коммутаторов Hyper-\-V, по одному для каждого физического сетевого адаптера.
- Так как оба сервера подключены к одной интрасети, серверы могут взаимодействовать друг с другом.
- Узлы Hyper\-V настраиваются в отказоустойчивом кластере по сети интрасети. 

>[!NOTE]
>Дополнительные сведения см. в разделе [Виртуальный коммутатор Hyper-V](https://docs.microsoft.com/windows-server/virtualization/hyper-v-virtual-switch/hyper-v-virtual-switch).

### <a name="vm-configuration"></a>Конфигурация виртуальной машины

Две виртуальные машины настроены для поддержки сценария тестирования следующим образом.

- На каждом сервере установлена виртуальная машина под управлением Windows Server версии 1709. Для каждой виртуальной машины настроено 10 ядер и 8 ГБ ОЗУ.
- Для каждой виртуальной машины также настроены два виртуальных сетевых адаптера. Один виртуальный сетевой адаптер подключен к виртуальному коммутатору интрасети 1, а другой виртуальный сетевой адаптер подключен к виртуальному коммутатору интрасети 2.
- На каждой виртуальной машине установлен шлюз RAS, который настроен в качестве VPN-сервера на основе\-GRE.
- Виртуальные машины шлюза настраиваются в отказоустойчивом кластере. Если кластеризованный, одна виртуальная машина активна и другая виртуальная машина является пассивной.

### <a name="workload-hyper-v-hosts-and-vms"></a>Рабочие нагрузки узлов и виртуальных машин Hyper\-V

Для этого теста в интрасети устанавливаются два узла рабочей нагрузки Hyper\-V, на каждом из которых установлена одна виртуальная машина. Если вы дублируете этот тест в собственной тестовой среде, можно установить столько серверов рабочей нагрузки и виртуальных машин, сколько подходит для ваших целей.

- На узлах рабочей нагрузки Hyper\-V установлен один физический сетевой адаптер, подключенный к интрасети организации.
- В виртуальном коммутаторе Hyper\-V на каждом узле создается один виртуальный коммутатор. Параметр является внешним и привязан к одному сетевому адаптеру, подключенному к интрасети.
- Для виртуальных машин рабочей нагрузки настраивается ОЗУ объемом 2 ГБ и 2 ядра.
- У виртуальных машин рабочей нагрузки есть один виртуальный сетевой адаптер, подключенный к виртуальному коммутатору в интрасети.

### <a name="traffic-generator-tool"></a>Средство создания трафика

Средство создания трафика, используемое в этом тесте, — это средство Ктстраффик. Репозиторий Git для этого средства находится по адресу [https://github.com/Microsoft/ctsTraffic](https://github.com/Microsoft/ctsTraffic).

## <a name="ras-gateway-performance"></a>Производительность шлюза RAS

На иллюстрациях в этом разделе показано, как диспетчер задач отображает пропускную способность туннеля GRE с несколькими TCP-подключениями.

Можно достичь до 2,0 Гбит/с на нескольких\-основных виртуальных машинах, настроенных как шлюзы RAS GRE.

### <a name="gre-tunnel-performance-with-multiple-tcp-sessions"></a>Производительность туннеля GRE с несколькими сеансами TCP

При наличии нескольких сеансов TCP загрузка ЦП достигает 100%, а максимальная пропускная способность на туннеле GRE составляет 2,0 Гбит/с.

На следующем рисунке показано использование ЦП на обеих виртуальных машинах шлюза RAS. Активная виртуальная машина, ВИРТУАЛЬная машина шлюза RAS #1, находится слева, а пассивная ВИРТУАЛЬная машина, ВИРТУАЛЬная машина шлюза RAS #2, находится справа.

![Загрузка ЦП виртуальной машины шлюза в диспетчере задач](../../media/GRE-Tunnel-Perf/Gre-Tunnel-01.jpg)

На следующем рисунке показана пропускная способность сети Ethernet на виртуальных машинах шлюза RAS. Активная виртуальная машина, ВИРТУАЛЬная машина шлюза RAS #1, находится слева, а пассивная ВИРТУАЛЬная машина, ВИРТУАЛЬная машина шлюза RAS #2, находится справа.

![Пропускная способность сети Ethernet для виртуальной машины шлюза в диспетчере задач](../../media/GRE-Tunnel-Perf/Gre-Tunnel-02.jpg)


### <a name="gre-tunnel-performance-with-one-tcp-connection"></a>Производительность туннеля GRE с одним TCP-подключением

После изменения конфигурации теста с нескольких сеансов TCP на один сеанс TCP только одно ядро ЦП достигает максимальной емкости на виртуальных машинах шлюза RAS.

Максимальная пропускная способность для туннеля GRE составляет от 400-500 Мбит/с.

На следующем рисунке показано использование ЦП на обеих виртуальных машинах шлюза RAS. Активная виртуальная машина, ВИРТУАЛЬная машина шлюза RAS #1, находится слева, а пассивная ВИРТУАЛЬная машина, ВИРТУАЛЬная машина шлюза RAS #2, находится справа.

![Загрузка ЦП виртуальной машины шлюза в диспетчере задач](../../media/GRE-Tunnel-Perf/Gre-Tunnel-03.jpg)


На следующем рисунке показана пропускная способность сети Ethernet на виртуальных машинах шлюза RAS. Активная виртуальная машина, ВИРТУАЛЬная машина шлюза RAS #1, находится слева, а пассивная ВИРТУАЛЬная машина, ВИРТУАЛЬная машина шлюза RAS #2, находится справа.

![Пропускная способность сети Ethernet для виртуальной машины шлюза в диспетчере задач](../../media/GRE-Tunnel-Perf/Gre-Tunnel-04.jpg)

Дополнительные сведения о производительности шлюза RAS см. [в статье Настройка производительности шлюза HNV в разделе программно определяемые сети](https://docs.microsoft.com/windows-server/administration/performance-tuning/subsystem/software-defined-networking/hnv-gateway-performance).