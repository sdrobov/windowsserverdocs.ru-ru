---
title: Настройка веб-клиента удаленного рабочего стола для пользователей
description: Описывается, как администратор может настроить веб-клиент удаленного рабочего стола.
ms.prod: windows-server-threshold
ms.technology: remote-desktop-services
ms.author: helohr
ms.date: 11/2/2018
ms.topic: article
author: Heidilohr
ms.localizationpriority: medium
ms.openlocfilehash: 45164e9eca0873c82148aa3b7baa179a3f626dd7
ms.sourcegitcommit: 3743cf691a984e1d140a04d50924a3a0a19c3e5c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2019
ms.locfileid: "66804972"
---
# <a name="set-up-the-remote-desktop-web-client-for-your-users"></a>Настройка веб-клиента удаленного рабочего стола для пользователей

Веб-клиент удаленного рабочего стола позволяет пользователям обращаться к инфраструктуре удаленных рабочих столов организации через совместимый браузер. Они смогут взаимодействовать с удаленными приложениями или рабочими столами, как с локальным компьютером, независимо от того, где они находятся. После настройки веб-клиента удаленного рабочего стола все, что нужно будет пользователям, чтобы приступить к работе — это URL-адрес, по которому они смогут обратиться к клиенту, а также учетные данные и поддерживаемый веб-браузер.

>[!IMPORTANT]
>Сейчас веб-клиент не поддерживает использование прокси приложения Azure и вообще не поддерживает прокси-службу веб-приложения. Дополнительные сведения см. в разделе [С помощью служб удаленных рабочих столов с помощью служб прокси-сервера приложений](../rds-supported-config.md#using-remote-desktop-services-with-application-proxy-services).

## <a name="what-youll-need-to-set-up-the-web-client"></a>Что потребуется для настройки веб-клиента

Перед началом работы необходимо помнить следующее.

* Убедитесь, что в вашем [развертывании Удаленного рабочего стола](../rds-deploy-infrastructure.md) есть шлюз удаленных рабочих столов, посредник подключений к удаленному рабочему столу и служба веб-доступа к удаленным рабочим столам на платформе Windows Server 2016 или Windows Server 2019.
* Убедитесь, что развертывание настроено для использования [клиентских лицензий "на пользователя"](../rds-client-access-license.md), а не клиентских лицензий "на устройство". В противном случае будут использованы все лицензии.
* Установите [обновление KB4025334 для Windows 10](https://support.microsoft.com/en-us/help/4025334/windows-10-update-kb4025334) на шлюзе удаленных рабочих столов. Более поздние накопительные пакеты обновления могут уже содержать обновление из этой статьи базы знаний.
* Убедитесь, что общедоступные доверенные сертификаты настроены для ролей шлюза удаленных рабочих столов и веб-доступа к удаленным рабочим столам.
* Убедитесь, что все компьютеры, к которым ваши пользователи будут подключаться, работают под управлением одной из следующих версий операционной системы:
  * Windows 10
  * Windows Server 2008 R2 или более поздней версии.

Пользователи ощутят более высокую производительность подключения к Windows Server 2016 (или более поздней версии) и Windows 10 (версии 1611 или более поздней версии).

>[!IMPORTANT]
>Если вы использовали веб-клиент во время действия предварительной версии и установили версию, предшествующую версии 1.0.0, то сначала необходимо удалить более ранний клиент, а затем перейти на новую версию. Если появится сообщение об ошибке: "The web client was installed using an older version of RDWebClientManagement and must first be removed before deploying the new version" (Веб-клиент был установлен с помощью более ранней версии RDWebClientManagement и должен быть удален перед развертыванием новой версии), выполните следующие действия.
>
>1. Откройте командную строку с повышенными привилегиями PowerShell.
>2. Выполните командлет **RDWebClientManagement Uninstall-Module**, чтобы удалить новый модуль.
>3. Закройте и снова откройте командную строку с повышенными привилегиями PowerShell.
>4. Выполните командлет **RDWebClientManagement Install-Module - RequiredVersion \<более_ранняя_версия>, чтобы установить более ранний модуль.**
>5. Выполните командлет **RDWebClient удаления**, чтобы удалить более ранний веб-клиент.
>6. Выполните командлет **RDWebClientManagement Uninstall-Module**, чтобы удалить более ранний модуль.
>7. Закройте и снова откройте командную строку с повышенными привилегиями PowerShell.
>8. Выполните шаги обычной установки, как описано ниже.

## <a name="how-to-publish-the-remote-desktop-web-client"></a>Как опубликовать веб-клиент удаленного рабочего стола

Чтобы впервые установить веб-клиент, выполните следующие действия.

1. На сервере посредника подключений к удаленному рабочему столу получите сертификат, используемый для подключений к удаленному рабочему столу, и экспортируйте его как CER-файл. Скопируйте CER-файл из посредника подключений к удаленному рабочему столу на сервер, которому назначена роль веб-доступа к удаленным рабочим столам.
2. На сервере веб-доступа к удаленным рабочим столам откройте командную строку с повышенными привилегиями PowerShell.
3. В Windows Server 2016 обновите модуль PowerShellGet, так как версия папки "Входящие" не поддерживает установку модуля управления веб-клиентом. Чтобы обновить PowerShellGet, выполните следующий командлет.
    ```PowerShell
    Install-Module -Name PowerShellGet -Force
    ```

    >[!IMPORTANT]
    >Необходимо будет перезапустить PowerShell, чтобы обновление вступило в силу, в противном случае модуль может не работать.

4. Установите модуль PowerShell управления веб-клиентом удаленного рабочего стола из коллекции PowerShell с помощью следующего командлета.
    ```PowerShell
    Install-Module -Name RDWebClientManagement
    ```

5. После этого выполните приведенный ниже командлет, чтобы скачать последнюю версию веб-клиента удаленного рабочего стола.
    ```PowerShell
    Install-RDWebClientPackage
    ```

6. Затем выполните этот командлет, заменив значение в квадратных скобках путем к CER-файлу, который был скопирован из посредника подключений к удаленному рабочему столу.
    ```PowerShell
    Import-RDWebClientBrokerCert <.cer file path>
    ```

7. Наконец, выполните следующий командлет, чтобы опубликовать веб-клиент удаленного рабочего стола.
    ```PowerShell
    Publish-RDWebClientPackage -Type Production -Latest
    ```
    Убедитесь, что можете получить доступ к веб-клиенту по его URL-адресу с именем вашего сервера в следующем формате: <https://server_FQDN/RDWeb/webclient/index.html>. В URL-адресе важно использовать имя сервера, которое соответствует общедоступному сертификату для веб-доступа к удаленным рабочим столам (обычно это полное доменное имя сервера).

    >[!NOTE]
    >При выполнении командлета **Publish-RDWebClientPackage** может появиться предупреждение о том, что клиентские лицензии "на устройство" не поддерживаются, даже если развертывание настроено для использования клиентских лицензий "на пользователя". Если в развертывании используются клиентские лицензии "на пользователя", это предупреждение можно игнорировать. Мы отображаем его, чтобы убедиться, что вам известно об ограничении конфигурации.
8. Когда все будет готово для предоставления пользователям доступа к веб-клиенту, просто отправьте им созданный вами URL-адрес веб-клиента.

>[!NOTE]
>Чтобы просмотреть список всех поддерживаемых командлетов модуля RDWebClientManagement, выполните следующий командлет PowerShell.
>```PowerShell
>Get-Command -Module RDWebClientManagement
>```

## <a name="how-to-update-the-remote-desktop-web-client"></a>Как обновить веб-клиент удаленного рабочего стола

Если доступна новая версия веб-клиента удаленного рабочего стола, выполните следующие действия, чтобы обновить развертывание, установив новый клиент.

1. Откройте командную строку с повышенными привилегиями PowerShell на сервере веб-доступа к удаленным рабочим столам и выполните следующий командлет, чтобы скачать последнюю доступную версию веб-клиента.
    ```PowerShell
    Install-RDWebClientPackage
    ```

2. При необходимости вы можете опубликовать клиент для тестирования перед официальным выпуском, выполнив следующий командлет.
    ```PowerShell
    Publish-RDWebClientPackage -Type Test -Latest
    ```

    Клиент должен быть доступен по тестовому URL-адресу, который соответствует URL-адресу вашего веб-клиента (например, <https://server_FQDN/RDWeb/webclient-test/index.html>).
3. Опубликуйте клиент для пользователей, выполнив следующий командлет.
    ```PowerShell
    Publish-RDWebClientPackage -Type Production -Latest
    ```

    Это заменит клиент для всех пользователей, когда они повторно откроют веб-страницу.

## <a name="how-to-uninstall-the-remote-desktop-web-client"></a>Как удалить веб-клиент удаленного рабочего стола

Чтобы удалить все следы веб-клиента, выполните следующие действия.

1. На сервере веб-доступа к удаленным рабочим столам откройте командную строку с повышенными привилегиями PowerShell.
2. Отмените публикацию тестового и рабочего клиентов, удалите все локальные пакеты, а затем удалите параметры веб-клиента.

   ```PowerShell
   Uninstall-RDWebClient
   ```

3. Удалите модуль PowerShell управления веб-клиентом удаленного рабочего стола.

   ```PowerShell
   Uninstall-Module -Name RDWebClientManagement
   ```

## <a name="how-to-install-the-remote-desktop-web-client-without-an-internet-connection"></a>Как установить веб-клиент удаленного рабочего стола без подключения к Интернету

Выполните следующие действия, чтобы развернуть веб-клиент на сервере веб-доступа к удаленным рабочим столам, который не подключен к Интернету.

> [!NOTE]
> Установка без подключения к Интернету доступна для версии 1.0.1 и более поздних версий модуля PowerShell RDWebClientManagement.

> [!NOTE]
> По-прежнему требуется компьютер администратора с доступом к Интернету, чтобы скачать необходимые файлы перед их передачей на автономный сервер.

> [!NOTE]
> Пока что на компьютере пользователя требуется подключение к Интернету. Это будет устранено в будущем выпуске клиента, чтобы обеспечить сценарий полностью автономного режима.

### <a name="from-a-device-with-internet-access"></a>На устройстве с доступом к Интернету

1. Откройте командную строку PowerShell.

2. Импортируйте модуль PowerShell управления веб-клиентом удаленного рабочего стола из коллекции PowerShell.
    ```PowerShell
    Import-Module -Name RDWebClientManagement
    ```

3. Скачайте последнюю версию веб-клиента удаленного рабочего стола для установки на другом устройстве.
    ```PowerShell
    Save-RDWebClientPackage "C:\WebClient\"
    ```

4. Скачайте последнюю версию модуля PowerShell RDWebClientManagement.
    ```PowerShell
    Find-Module -Name "RDWebClientManagement" -Repository "PSGallery" | Save-Module -Path "C:\WebClient\"
    ```

5. Скопируйте содержимое C:\WebClient\" на сервер веб-доступа к удаленным рабочим столам.

### <a name="from-the-rd-web-access-server"></a>На сервере веб-доступа к удаленным рабочим столам

Следуйте инструкциям в разделе [Как опубликовать веб-клиент удаленного рабочего стола](remote-desktop-web-client-admin.md#how-to-publish-the-remote-desktop-web-client), но вместо шагов 4 и 5 выполните следующее.

4. Импортируйте модуль PowerShell управления веб-клиентом удаленного рабочего стола из локальной папки.
    ```PowerShell
    Import-Module -Name "C:\WebClient\"
    ```

5. Разверните последнюю версию веб-клиента удаленного рабочего стола в локальной папке (замените соответствующий ZIP-файл).
    ```PowerShell
    Install-RDWebClientPackage -Source "C:\WebClient\rdwebclient-1.0.1.zip"
    ```

## <a name="connecting-to-rd-broker-without-rd-gateway-in-windows-server-2019"></a>Подключение к посреднику подключений к удаленному рабочему столу без шлюза удаленных рабочих столов в Windows Server 2019
В этом разделе описывается, как обеспечить подключение веб-клиента к посреднику подключений к удаленному рабочему столу без шлюза удаленных рабочих столов в Windows Server 2019.

### <a name="setting-up-the-rd-broker-server"></a>Настройка сервера посредника подключений к удаленному рабочему столу

#### <a name="follow-these-steps-if-there-is-no-certificate-bound-to-the-rd-broker-server"></a>Выполните следующие действия, если к серверу посредника подключений к удаленному рабочему столу не привязан сертификат.

1. Выберите **Диспетчер серверов** > **Службы удаленных рабочих столов**.

2. В разделе **Обзор развертывания** выберите раскрывающееся меню **Задачи**.

3. Выберите **Edit Deployment Properties** (Изменить свойства развертывания), откроется новое окно **Свойства развертывания** будет открыт.

4. В окне **Свойства развертывания** в меню слева выберите **Сертификаты**.

5. Из списка "Уровни сертификатов" выберите **Посредник подключений к удаленному рабочему столу: включение единого входа в систему**. Доступны два варианта: создайте новый сертификат или используйте существующий сертификат.

#### <a name="follow-these-steps-if-there-is-a-certificate-previously-bound-to-the-rd-broker-server"></a>Выполните следующие действия, если к серверу посредника подключений к удаленному рабочему столу ранее был привязан сертификат.

1. Откройте сертификат, привязанный к посреднику, и скопируйте значение **Thumbprint**.

2. Чтобы привязать этот сертификат к защищенному порту 3392, откройте командную строку с повышенными привилегиями PowerShell и выполните следующую команду, заменив **"< thumbprint >"** значением, скопированным на предыдущем шаге.

    ```PowerShell
    netsh http add sslcert ipport=0.0.0.0:3392 certhash="<thumbprint>" certstorename="Remote Desktop" appid="{00000000-0000-0000-0000-000000000000}"
    ```

    > [!NOTE]
    > Чтобы проверить, был ли сертификат привязан правильно, выполните следующую команду.
    >
    > ```PowerShell
    > netsh http show sslcert
    > ```
    >
    > В списке привязок SSL-сертификатов убедитесь, что правильный сертификат привязан к порту 3392.

3. Откройте реестр Windows (regedit), перейдите к ```HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp``` и найдите раздел **WebSocketURI**. Его значением должно быть <strong>https://+:3392/rdp/</strong>.

### <a name="setting-up-the-rd-session-host"></a>Настройка узла сеансов удаленных рабочих столов
Если сервер узла сеансов удаленных рабочих столов отличается от сервера посредника подключений к удаленному рабочему столу, выполните следующие действия.

1. Создайте сертификат для компьютера узла сеансов удаленных рабочих столов, откройте его и скопируйте значение **Thumbprint**.

2. Чтобы привязать этот сертификат к защищенному порту 3392, откройте командную строку с повышенными привилегиями PowerShell и выполните следующую команду, заменив **"< thumbprint >"** значением, скопированным на предыдущем шаге.

    ```PowerShell
    netsh http add sslcert ipport=0.0.0.0:3392 certhash="<thumbprint>" appid="{00000000-0000-0000-0000-000000000000}"
    ```

    > [!NOTE]
    > Чтобы проверить, был ли сертификат привязан правильно, выполните следующую команду.
    >
    > ```PowerShell
    > netsh http show sslcert
    > ```
    >
    > В списке привязок SSL-сертификатов убедитесь, что правильный сертификат привязан к порту 3392.

3. Откройте реестр Windows (regedit), перейдите к ```HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp``` и найдите раздел **WebSocketURI**. Его значением должно быть <https://+:3392/rdp/>.

### <a name="general-observations"></a>Общие наблюдения

* Убедитесь, что узел сеансов удаленных рабочих столов и сервер посредника подключений к удаленному рабочему столу выполняются в Windows Server 2019.

* Убедитесь, что для узла сеансов удаленных рабочих столов и сервера посредника подключений к удаленному рабочему столу настроены общедоступные доверенные сертификаты.
    > [!NOTE]
    > Если узел сеансов удаленных рабочих столов и сервер посредника подключений к удаленному рабочему столу работают на одном компьютере, необходимо настроить только сертификат сервера посредника подключений к удаленному рабочему столу. Если узел сеансов удаленных рабочих столов и сервер посредника подключений к удаленному рабочему столу используют разные компьютеры, то для них должны быть настроены уникальные сертификаты.

* В качестве **альтернативного имени субъекта (SAN)** для каждого сертификата нужно задать **полное доменное имя (FQDN)** компьютера. **Общее имя (CN)** должно соответствовать имени SAN для каждого сертификата.

## <a name="how-to-pre-configure-settings-for-remote-desktop-web-client-users"></a>Как предварительно настроить параметры для пользователей веб-клиента удаленного рабочего стола
В этом разделе мы расскажем о том, как использовать PowerShell для настройки параметров развертывания веб-клиента удаленного рабочего стола. Эти командлеты PowerShell позволяют управлять возможностями пользователя изменять параметры в соответствии с требованиями безопасности или рабочим процессом вашей организации. Следующие параметры находятся на боковой панели **Параметры** веб-клиента. 

### <a name="suppress-telemetry"></a>"Suppress telemetry" (Отключение телеметрии)
По умолчанию пользователь может включить или отключить сбор данных телеметрии, которые отправляются в корпорацию Майкрософт. Сведения о собираемых корпорацией Майкрософт данных телеметрии доступны в заявлении о конфиденциальности, к которому можно перейти по ссылке **About** (О программе) на боковой панели.

Будучи администратором, вы можете отключить сбор данных телеметрии для развертывания с помощью следующего командлета PowerShell.

   ```PowerShell
    Set-RDWebClientDeploymentSetting -SuppressTelemetry $true
   ```

По умолчанию пользователь может включить или отключить сбор данных телеметрии. Логическое значение **$false** будет соответствовать поведению клиента по умолчанию. Логическое значение **$true** отключает телеметрию и запрещает включение телеметрии пользователем.

### <a name="remote-resource-launch-method"></a>"Remote resource launch method" (Метод запуска удаленного ресурса)
По умолчанию пользователи могут выбрать, как запускать удаленные ресурсы: сделать это в браузере или скачать RDP-файл для обработки другим клиентом, установленным на своем компьютере. Будучи администратором, вы можете ограничить метод запуска удаленных ресурсов для развертывания с помощью следующей команды PowerShell.

   ```PowerShell
    Set-RDWebClientDeploymentSetting -LaunchResourceInBrowser ($true|$false)
   ```
 По умолчанию пользователь может выбрать любой из методов запуска. Логическое значение **$true** вынудит пользователя запускать ресурсы в браузере. Логическое значение **$false** вынудит пользователя запускать ресурсы, скачивая RDP-файл для обработки с помощью локально установленного клиента RDP.

### <a name="reset-rdwebclientdeploymentsetting-configurations-to-default"></a>Сброс конфигурации RDWebClientDeploymentSetting до значений по умолчанию
Чтобы сбросить все параметры развертывания веб-клиента до конфигурации по умолчанию, выполните следующий командлет PowerShell.

   ```PowerShell
    Reset-RDWebClientDeploymentSetting 
   ```

## <a name="troubleshooting"></a>Поиск и устранение неисправностей

Если пользователь сообщает о следующих проблемах при первом запуске веб-клиента, в разделах ниже описывается, как устранить эти проблемы.

### <a name="what-to-do-if-the-users-browser-shows-a-security-warning-when-they-try-to-access-the-web-client"></a>Что делать, если в браузере пользователя отображается предупреждение о безопасности при попытке получения доступа к веб-клиенту

Возможно, роль веб-доступа к удаленным рабочим столам не использует доверенный сертификат. Убедитесь, что для роли веб-доступа к удаленным рабочим столам настроен общедоступный доверенный сертификат.

Если это не помогло, возможно, имя сервера в URL-адресе клиента отличается от имени, указанного в сертификате для веб-доступа к удаленным рабочим столам. Убедитесь, что в URL-адресе используется полное доменное имя сервера, на котором размещена роль веб-доступа к удаленным рабочим столам.

### <a name="what-to-do-if-the-user-cant-connect-to-a-resource-with-the-web-client-even-though-they-can-see-the-items-under-all-resources"></a>Что делать, если пользователь не может подключиться к ресурсу с помощью веб-клиента, хотя и видит соответствующий элемент в разделе "Все ресурсы"

Если пользователь сообщил, что он не может подключиться к ресурсам с помощью веб-клиента, хотя видит их в списке, проверьте следующее.

* Правильно ли настроена роль шлюза удаленных рабочих столов для использования общедоступного доверенного сертификата?
* Установлены ли необходимые обновления на сервер шлюза удаленных рабочих столов? Убедитесь, что на сервере установлено [обновление KB4025334](https://support.microsoft.com/en-us/help/4025334/windows-10-update-kb4025334).

Если пользователь при попытке подключения получает сообщение об ошибке "unexpected server authentication certificate was received" (был получен непредвиденный сертификат аутентификации), то в нем будет отображен отпечаток сертификата. Выполните поиск в диспетчере сертификатов на сервере посредника подключений к удаленному рабочему столу с помощью этого отпечатка, чтобы найти соответствующий сертификат. Убедитесь, что сертификат настроен для использования для роли посредника подключений к удаленному рабочему столу на странице свойств развертывания Удаленного рабочего стола. Убедившись, что срок действия сертификата еще не истек, скопируйте сертификат в виде CER-файла на сервер веб-доступа к удаленным рабочим столам и выполните следующую команду на сервере веб-доступа к удаленным рабочим столам, заменив значение в квадратных скобках путем к файлу сертификата.

```PowerShell
Import-RDWebClientBrokerCert <certificate file path>
```

### <a name="diagnose-issues-with-the-console-log"></a>Диагностика проблем с помощью журнал консоли

Если не удается устранить проблему, следуя инструкциям по устранению неполадок в этой статье, попробуйте самостоятельно диагностировать источник проблемы, просмотрев журнал консоли в браузере. Веб-клиент предоставляет метод для записи действий из журнала консоли браузера при использовании веб-клиента для диагностики проблем.

* Щелкните многоточие в правом верхнем углу и перейдите на страницу **About** (О программе) с помощью раскрывающегося меню.
* В разделе **Capture support information** (Запись сведения для поддержки) нажмите кнопку **Start recording** (Начать запись).
* Выполните операции в веб-клиенте, в работе которого возникла диагностируемая проблема.
* Перейдите на страницу **About** (О программе) и нажмите кнопку **Stop recording** (Остановить запись).
* Браузер автоматически скачает TXT-файл **RD Console Logs.txt**. Этот файл будет содержать все действия из журнала консоли, созданные при воспроизведении изучаемой проблемы.

В консоль также можно перейти непосредственно через браузер. Консоль обычно находится в разделе средств разработчика. Например, можно открыть журнал в Microsoft Edge, нажав клавишу **F12** или щелкнув многоточие, а затем открыв меню **Дополнительные средства** > **Средства разработчика**.

## <a name="get-help-with-the-web-client"></a>Помощь в работе с веб-клиентом

Если возникла проблема, которую не удается устранить с помощью сведений в этой статье, вы можете сообщить нам о ней [по электронной почте](mailto:rdwbclnt@microsoft.com). Вы можете также запросить новые возможности или проголосовать за них с помощью [поля для предложений](https://aka.ms/rdwebfbk).
