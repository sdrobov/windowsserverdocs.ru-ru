---
title: Обновление версии виртуальной машины в Hyper-V в Windows 10 или Windows Server
description: Содержит инструкции и рекомендации по обновлению версии виртуальной машины.
ms.prod: windows-server
ms.service: na
manager: dongill
ms.technology: compute-hyper-v
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 897f2454-5aee-445c-a63e-f386f514a0f6
author: jasongerend
ms.author: jgerend
ms.date: 05/22/2019
ms.openlocfilehash: 96678dfab2a3d5b6f503d8ce9d00850a3c437b35
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71392931"
---
# <a name="upgrade-virtual-machine-version-in-hyper-v-on-windows-10-or-windows-server"></a>Обновление версии виртуальной машины в Hyper-V в Windows 10 или Windows Server

>Область применения. Windows 10, Windows Server 2019, Windows Server 2016, Windows Server (половина ежегодного канала)

Сделайте последние компоненты Hyper-V доступными на виртуальных машинах, обновив версию конфигурации. Не делать это до:

- Вы обновляете узлы Hyper-V до последней версии Windows или Windows Server.
- Вы обновляете функциональный уровень кластера.
- Вы уверены, что вам не потребуется перемещать виртуальную машину обратно на узел Hyper-V, работающий под управлением предыдущей версии Windows или Windows Server.

Дополнительные сведения см. в статьях [последовательное обновление операционной системы кластера](../../../failover-clustering/Cluster-Operating-System-Rolling-Upgrade.md) и [выполнение последовательного обновления кластера узлов Hyper-V в VMM](https://docs.microsoft.com/system-center/vmm/hyper-v-rolling-upgrade).

## <a name="step-1-check-the-virtual-machine-configuration-versions"></a>Шаг 1. Проверка версий конфигурации виртуальной машины

1. На рабочем столе Windows нажмите кнопку "Пуск" и введите любую часть имени **Windows PowerShell**.
2. Щелкните правой кнопкой мыши Windows PowerShell и выберите команду **Запуск от имени администратора**.
3. Используйте командлет [Get-VM](https://docs.microsoft.com/powershell/module/hyper-v/get-vm). Выполните следующую команду, чтобы получить версии виртуальных машин.

```PowerShell
Get-VM * | Format-Table Name, Version
```

Вы также можете просмотреть версию конфигурации в диспетчере Hyper-V, выбрав виртуальную машину и просмотрев на вкладке **Сводка** .

## <a name="step-2-upgrade-the-virtual-machine-configuration-version"></a>Шаг 2. Обновление версии конфигурации виртуальной машины

1. Завершите работу виртуальной машины в диспетчере Hyper-V.
2. Выберите действие > обновить версию конфигурации. Если этот параметр недоступен для виртуальной машины, то он уже имеет самую новую версию конфигурации, поддерживаемую узлом Hyper-V.

Чтобы обновить версию конфигурации виртуальной машины с помощью Windows PowerShell, используйте командлет [Update-VMVersion](https://docs.microsoft.com/powershell/module/hyper-v/update-vmversion) . Выполните следующую команду, где vmname — это имя виртуальной машины.

```PowerShell
Update-VMVersion <vmname>
```

## <a name="supported-virtual-machine-configuration-versions"></a>Поддерживаемые версии конфигурации виртуальной машины

Выполните командлет PowerShell [Get-вмхостсуппортедверсион](https://docs.microsoft.com/powershell/module/hyper-v/get-vmhostsupportedversion) , чтобы узнать, какие версии конфигурации виртуальных машин поддерживает узел Hyper-V. При создании виртуальной машины она создается с использованием версии конфигурации по умолчанию. Чтобы узнать, что такое по умолчанию, выполните следующую команду.

```PowerShell
Get-VMHostSupportedVersion -Default
```

Если необходимо создать виртуальную машину, которую можно переместить на узел Hyper-V, на котором работает более старая версия Windows, используйте командлет [New-VM](https://docs.microsoft.com/powershell/module/hyper-v/new-vm) с параметром-version. Например, чтобы создать виртуальную машину, которую можно переместить на узел Hyper-V под управлением Windows Server 2012 R2, выполните следующую команду. Эта команда создаст виртуальную машину с именем "WindowsCV5" и конфигурацией версии 5,0.

```PowerShell
New-VM -Name "WindowsCV5" -Version 5.0
```

>[!NOTE]
>Вы можете импортировать виртуальные машины, созданные для узла Hyper-V, работающего под управлением более старой версии Windows, или восстановить их из резервной копии. Если версия конфигурации виртуальной машины не указана как поддерживаемая для ОС узла Hyper-V в приведенной ниже таблице, перед запуском виртуальной машины необходимо обновить версию конфигурации виртуальной машины.

### <a name="supported-vm-configuration-versions-for-long-term-servicing-hosts"></a>Поддерживаемые версии конфигурации виртуальных машин для долгосрочных узлов обслуживания

В следующей таблице перечислены версии конфигурации виртуальных машин, которые поддерживаются на узлах, работающих под управлением долгосрочной служебной версии Windows.

| Версия Windows для узла Hyper-V | 9,1 | 9,0 | 8.3 | 8.2 | 8.1 | 8.0 | 7.1 | 7.0 | 6.2 | 5.0 |
| --- |---|---|---|---|---|---|---|---|---|---|
|Windows Server 2019|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная LTSC 2019|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows Server 2016|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная 2016 с долгосрочным обслуживанием|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная 2015 с долгосрочным обслуживанием|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|
|Windows Server 2012 R2|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|
|Windows 8.1|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|

### <a name="supported-vm-configuration-versions-for-semi-annual-channel-hosts"></a>Поддерживаемые версии конфигурации виртуальных машин для полугодовых узлов канала

В следующей таблице перечислены версии конфигурации виртуальных машин, на которых выполняется Текущая поддерживаемая версия Windows на основе полугодового канала. Чтобы получить дополнительные сведения о одноежегодных версиях Windows, посетите следующие страницы для [Windows Server](../../../get-started-19/servicing-channels-19.md) и [Windows 10](https://docs.microsoft.com/windows/deployment/update/waas-overview#servicing-channels) .

| Версия Windows для узла Hyper-V | 9,1 | 9,0 | 8.3 | 8.2 | 8.1 | 8.0 | 7.1 | 7.0 | 6.2 | 5.0 |
| --- |---|---|---|---|---|---|---|---|---|---|
| Обновление Windows 10, 2019, Май (версия 1903) |&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;| &#10004;|
| Windows Server версии 1903 |&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;| &#10004;|
|Windows Server, версия 1809|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Обновление Windows 10 октября 2018 (версия 1809)|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows Server версии 1803|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Обновление Windows 10 от апреля 2018 (версия 1803)|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Обновление для дизайнеров Windows 10 (версия 1709)|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Обновление Windows 10 для дизайнеров (версия 1703)|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Юбилейное обновление Windows 10 (версия 1607)|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|

## <a name="why-should-i-upgrade-the-virtual-machine-configuration-version"></a>Зачем нужно обновлять версию конфигурации виртуальной машины?

При перемещении или импорте виртуальной машины на компьютер под управлением Hyper-V в Windows Server 2019, Windows Server 2016 или Windows 10 Конфигурация виртуальной машины не обновляется автоматически. Это означает, что виртуальную машину можно переместить обратно на узел Hyper-V, работающий под управлением предыдущей версии Windows или Windows Server. Но это также означает, что вы не можете использовать некоторые новые функции виртуальных машин, пока вы вручную не обновите версию конфигурации. Вы не сможете понизить версию конфигурации виртуальной машины после ее обновления.

Версия конфигурации виртуальной машины представляет собой совместимость конфигурации виртуальной машины, сохраненного состояния и файлов моментальных снимков с версией Hyper-V. При обновлении версии конфигурации изменяется структура файла, используемая для хранения конфигурации виртуальных машин и файлов контрольных точек. Вы также обновляете версию конфигурации до последней версии, поддерживаемой этим узлом Hyper-V. Обновленные виртуальные машины используют новый формат файлов конфигурации, который повышает эффективность чтения и записи данных. Кроме того, при обновлении снижается вероятность повреждения данных в случае ошибки хранилища.

В следующей таблице перечислены описания, расширения имен файлов и расположения по умолчанию для каждого типа файлов, используемых для новых или обновленных виртуальных машин.

 |Типы файлов виртуальной машины | Описание|
 |---|---|
|Конфигурация |Сведения о конфигурации виртуальной машины, которые хранятся в двоичном формате файла. <br /> Расширение имени файла:. vmcx <br /> Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines|
 |Состояние среды выполнения|Сведения о состоянии среды выполнения виртуальной машины, которые хранятся в двоичном формате файла. <br />Расширение имени файла:. vmrs и. вмгс <br />Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines|
|Виртуальный жесткий диск|Хранит виртуальные жесткие диски для виртуальной машины. <br /> Расширение имени файла:. VHD или. VHDX <br />Расположение по умолчанию: Жесткие диски К:\програмдата\микрософт\виндовс\хипер-в\виртуал|
 |Автоматический виртуальный жесткий диск |Файлы разностного диска, используемые для контрольных точек виртуальной машины. <br /> Расширение имени файла:. avhdx <br /> Расположение по умолчанию: Жесткие диски К:\програмдата\микрософт\виндовс\хипер-в\виртуал|
 |Контрольная точка|Контрольные точки хранятся в нескольких файлах. Каждая контрольная точка создает файл конфигурации и файл состояния среды выполнения <br /> Расширения имен файлов:. vmrs и. vmcx <br />Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Snapshots|

## <a name="what-happens-if-i-dont-upgrade-the-virtual-machine-configuration-version"></a>Что произойдет, если я не буду обновлять версию конфигурации виртуальной машины?

При наличии виртуальных машин, созданных с помощью более ранней версии Hyper-V, некоторые функции, доступные в более новой ОС узла, могут не работать с этими виртуальными машинами до тех пор, пока не будет обновлена версия конфигурации.

В качестве общего руководства рекомендуется обновлять версию конфигурации после успешного обновления узлов виртуализации до более новой версии Windows и уверенности в том, что откат не требуется. При использовании функции [последовательного обновления ОС кластера](https://docs.microsoft.com/windows-server/failover-clustering/Cluster-Operating-System-Rolling-Upgrade) это обычно происходит после обновления функционального уровня кластера. Таким образом вы получите преимущества от новых функций, а также внутренних изменений и оптимизаций.

>[!NOTE]
>После обновления версии конфигурации ВИРТУАЛЬНОЙ машины виртуальная машина не сможет запуститься на узлах, которые не поддерживают обновленную версию конфигурации.

В следующей таблице показана минимальная версия конфигурации виртуальной машины, необходимая для использования некоторых функций Hyper-V.

|Компонент|Минимальная версия конфигурации виртуальной машины|
|---|---|
|Горячее добавление и удаление памяти|6.2|
|Безопасная загрузка виртуальных машин Linux|6.2|
|Рабочие контрольные точки|6.2|
|PowerShell Direct |6.2|
|Группирование виртуальных машин|6.2|
|Виртуальный доверенный платформенный модуль (vTPM)|7.0|
|Несколько очередей виртуальной машины (ВММК)|7.1|
|Поддержка КССАВЕ|8.0|
|Диск хранилища ключей|8.0|
|Поддержка безопасности на основе гостевой виртуализации (VBS)|8.0|
|Вложенная виртуализация|8.0|
|Число виртуальных процессоров|8.0|
|Виртуальные машины с большими объемами памяти|8.0|
|Увеличьте максимальное значение по умолчанию для виртуальных устройств, равное 64 на устройство (например, сети и назначенные устройства).|8.3|
|Разрешить дополнительные функции процессора для PerfMon|9,0|
|Автоматически предоставлять [одновременную многопотоковую](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types#background) настройку для виртуальных машин, работающих на узлах, с помощью [базового планировщика](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types#windows-server-2019-hyper-v-defaults-to-using-the-core-scheduler)|9,0|
|Поддержка спящего режима|9,0|

Дополнительные сведения об этих возможностях см. [в статье новые возможности Hyper-V в Windows Server](../What-s-new-in-Hyper-V-on-Windows.md).

