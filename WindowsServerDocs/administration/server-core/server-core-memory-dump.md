---
title: Настройка файлов дампа памяти для установки Server Core
description: Узнайте, как настроить файлы дампа памяти для установки основных серверных компонентов Windows Server
ms.prod: windows-server-threshold
ms.mktglfcycl: manage
ms.sitesec: library
author: lizap
ms.localizationpriority: medium
ms.date: 10/17/2017
ms.openlocfilehash: 0cea3118abce156acdd9ad933518015a25f8afbf
ms.sourcegitcommit: 216d97ad843d59f12bf0b563b4192b75f66c7742
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68476552"
---
# <a name="configure-memory-dump-files-for-server-core-installation"></a>Настройка файлов дампа памяти для установки Server Core

>Относится к: Windows Server 2019, Windows Server 2016 и Windows Server (половина ежегодного канала)

Чтобы настроить дамп памяти для установки Server Core, выполните следующие действия. 

## <a name="step-1-disable-the-automatic-system-page-file-management"></a>Шаг 1. Отключение автоматического управления системными файлами страниц

Первым шагом является ручная настройка параметров сбоя и восстановления системы. Это необходимо для выполнения оставшихся действий.

Выполните следующую команду: 

```
wmic computersystem set AutomaticManagedPagefile=False
```
 
## <a name="step-2-configure-the-destination-path-for-a-memory-dump"></a>Шаг 2. Настройка пути назначения для дампа памяти

Вам не нужно иметь файл подкачки в разделе, где установлена операционная система. Чтобы разместить файл подкачки в другом разделе, необходимо создать новую запись реестра с именем **дедикатеддумпфиле**. Размер файла подкачки можно определить с помощью записи реестра **думпфилесизе** . Чтобы создать записи реестра Дедикатеддумпфиле и Думпфилесизе, выполните следующие действия. 

1. В командной строке выполните команду regedit  , чтобы открыть редактор реестра.
2. Найдите и выберите следующий подраздел реестра. HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl
3. Щелкните **изменить > новый > строковый параметр**.
4. Назовите новое значение **дедикатеддумпфиле**и нажмите клавишу ВВОД.
5. Щелкните правой кнопкой мыши **дедикатеддумпфиле**и выберите пункт **изменить**.
6. В качестве типа  **\<\>данных значение диск\\:\>дедикатеддумпфиле. sys, а затем нажмите кнопку ОК.\<**

   >[!NOTE] 
   > Замените \< \<\> диск\> на диск, на котором достаточно места на диске для файла подкачки, и замените дедикатеддумпфиле. dmp на полный путь к выделенному файлу.
 
7. Щелкните **изменить > создать > значение DWORD**.
8. Введите **думпфилесизе**и нажмите клавишу ВВОД.
9. Щелкните правой кнопкой мыши **думпфилесизе**и выберите пункт **изменить**.
10. В поле **изменить значение DWORD**в разделе **базовый**щелкните **десятичный**.
11. В поле **данные значения**введите соответствующее значение и нажмите кнопку **ОК**.
    >[!NOTE]
    > Размер файла дампа находится в мегабайтах (МБ).
12. Закройте редактор реестра.

Определив расположение раздела дампа памяти, настройте путь назначения для файла подкачки. Чтобы просмотреть текущий конечный путь к файлу подкачки, выполните следующую команду:

```
wmic RECOVEROS get DebugFilePath
```

По умолчанию для **дебугфилепас** задано значение%системрут%\мемори.ДМП. Чтобы изменить текущий целевой путь, выполните следующую команду:

```
wmic RECOVEROS set DebugFilePath = <FilePath>
```

Задайте \<путьк целевому пути.\> Например, следующая команда устанавливает путь назначения дампа памяти в К:\ВИНДОВС\МЕМОРИ. DMP 

```
wmic RECOVEROS set DebugFilePath = C:\WINDOWS\MEMORY.DMP
```
 
## <a name="step-3-set-the-type-of-memory-dump"></a>Шаг 3. Задание типа дампа памяти

Определите тип дампа памяти, который необходимо настроить для сервера. Чтобы просмотреть текущий тип дампа памяти, выполните следующую команду:

```
wmic RECOVEROS get DebugInfoType
```

Чтобы изменить текущий тип дампа памяти, выполните следующую команду: 

```
wmic RECOVEROS set DebugInfoType = <Value>
```

\<Значение\> может быть равно 0, 1, 2 или 3, как определено ниже.

- 0,0 Отключить удаление дампа памяти.
- 1\. Полный дамп памяти. Записывает все содержимое системной памяти при неожиданной остановке компьютера. Полный дамп памяти может содержать данные из процессов, которые были запущены при сборе дампа памяти.
- 2\. Дамп памяти ядра (по умолчанию). Записывает только память ядра. Это ускоряет процесс записи данных в файл журнала при неожиданной остановке компьютера.
- 3\. Малый дамп памяти. Записывает наименьший набор полезных сведений, которые могут помочь определить причину неожиданной остановки компьютера.

## <a name="step-4-configure-the-server-to-restart-automatically-after-generating-a-memory-dump"></a>Шаг 4. Настроить автоматический перезапуск сервера после создания дампа памяти

По умолчанию сервер автоматически перезапускается после создания дампа памяти. Чтобы просмотреть текущую конфигурацию, выполните следующую команду:

```
wmic RECOVEROS get AutoReboot
```

Если для параметра перезагрузки задано значение true, сервер будет автоматически перезагружен после создания дампа памяти. Настройка не требуется, и вы можете перейти к следующему шагу.

Если для параметра перезагрузки задано значение false, сервер не будет автоматически перезапускаться. Чтобы изменить значение, выполните следующую команду:

```
wmic RECOVEROS set AutoReboot = true
```
 
## <a name="step-5-configure-the-server-to-overwrite-the-existing-memory-dump-file"></a>Шаг 5. Настройка сервера для перезаписи существующего файла дампа памяти

По умолчанию сервер перезаписывает существующий файл дампа памяти при создании нового. Чтобы определить, были ли уже настроены перезапись существующих файлов дампа памяти, выполните следующую команду:

```
wmic RECOVEROS get OverwriteExistingDebugFile
```

Если значение равно 1, сервер перезапишет существующий файл дампа памяти. Настройка не требуется, и вы можете перейти к следующему шагу.

Если значение равно 0, сервер не перезаписывает существующий файл дампа памяти. Чтобы изменить значение, выполните следующую команду: 

```
wmic RECOVEROS set OverwriteExistingDebugFile = 1
```
 
## <a name="step-6-set-an-administrative-alert"></a>Шаг 6. Задание административного оповещения

Определите, подходит ли административное оповещение, и задайте соответствующим образом **сендадминалерт** . Чтобы просмотреть текущее значение для Сендадминалерт, выполните следующую команду:

```
wmic RECOVEROS get SendAdminAlert
```

Возможные значения для Сендадминалерт: TRUE или FALSE. Чтобы изменить существующее значение Сендадминалерт на true, выполните следующую команду: 

```
wmic RECOVEROS set SendAdminAlert = true
```
 
## <a name="step-7-set-the-memory-dumps-page-file-size"></a>Шаг 7. Задание размера файла подкачки в дампе памяти

Чтобы проверить текущие параметры файла подкачки, выполните одну из следующих команд:

   ```
   wmic.exe pagefile
   ```

   или диспетчер конфигурации служб

   ```
   wmic.exe pagefile list /format:list
   ```

Например, выполните следующую команду, чтобы настроить исходный и максимальный размеры файла подкачки:

```
wmic pagefileset where name="c:\\pagefile.sys" set InitialSize=1000,MaximumSize=5000
```

## <a name="step-8-configure-the-server-to-generate-a-manual-memory-dump"></a>Шаг 8. Настройка сервера для создания дампа памяти вручную

Дамп памяти можно создать вручную с помощью клавиатуры PS/2. Эта функция отключена по умолчанию и недоступна для клавиатур с универсальной последовательной шиной (USB).

Чтобы включить дампы памяти вручную с помощью клавиатуры PS/2, выполните следующую команду:

```
reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters /v CrashOnCtrlScroll /t REG_DWORD /d 1 /f
```

Чтобы определить, правильно ли включен компонент, выполните следующую команду:

```
Reg query HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ i8042prt \ Parameters / v CrashOnCtrlScroll
```

Чтобы изменения вступили в силу, необходимо перезапустить сервер. Вы можете перезапустить сервер, выполнив следующую команду:

```
Shutdown / r / t 0
```

Вы можете создавать дампы памяти вручную с помощью клавиатуры PS/2, подключенной к серверу, удерживая ПРАВую клавишу CTRL и дважды нажав клавишу SCROLL LOCK. Это позволяет проверить ошибки компьютера с кодом ошибки 0xE2. После перезагрузки сервера в пути назначения, установленном на шаге 2, появится новый файл дампа.

## <a name="step-9-verify-that-memory-dump-files-are-being-created-correctly"></a>Шаг 9. Проверка правильности создания файлов дампа памяти

Чтобы убедиться, что файлы дампа памяти создаются правильно, можно использовать программу Dumpchk. exe утлити. Служебная программа Dumpchk. exe не устанавливается вместе с вариантом установки Server Core, поэтому ее придется запускать с сервера с возможностями рабочего стола или из Windows 10. Кроме того, должны быть установлены средства отладки для продуктов Windows.  

Служебная программа Dumpchk. exe позволяет передавать файл дампа памяти из установки Server Core Windows Server 2008 на другой компьютер с использованием выбранного носителя.

> [!WARNING]
> Файлы подкачки могут быть очень большими, поэтому внимательно рассмотрите метод перемещения и ресурсы, необходимые для этого метода.
 

Дополнительные ссылки

Общие сведения об использовании файлов дампа памяти см. в разделе [Обзор параметров файла дампа памяти для Windows](https://support.microsoft.com/help/254649/overview-of-memory-dump-file-options-for-windows).

Дополнительные сведения о выделенных файлах дампа см. в разделе [Использование значения реестра дедикатеддеумпфиле для преодоления ограничений на пространство на системном диске при записи дампа системной памяти](https://blogs.msdn.microsoft.com/ntdebugging/2010/04/02/how-to-use-the-dedicateddumpfile-registry-value-to-overcome-space-limitations-on-the-system-drive-when-capturing-a-system-memory-dump/).



