---
title: dfsrmig
description: Справочная статья по команде Dfsrmig, которая переносит репликацию SYSvol с FRS на репликация DFS, предоставляет сведения о ходе выполнения миграции и изменяет объекты AD DS для поддержки миграции.
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: e1b6a464-6a93-4e66-9969-04f175226d8d
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 87882ebe0beb687f704c5573091f56c067c278ee
ms.sourcegitcommit: 2afed2461574a3f53f84fc9ec28d86df3b335685
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85928641"
---
# <a name="dfsrmig"></a>dfsrmig

> Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Средство миграции для службы репликация DFS, dfsrmig.exe, устанавливается вместе со службой репликация DFS. Это средство переносит репликацию SYSvol из службы репликации файлов (FRS) в репликацию распределенная файловая система (DFS). В нем также содержатся сведения о ходе миграции и изменении объектов домен Active Directory Services (AD DS) для поддержки миграции.

## <a name="syntax"></a>Синтаксис

```
dfsrmig [/setglobalstate <state> | /getglobalstate | /getmigrationstate | /createglobalobjects |
/deleterontfrsmember [<read_only_domain_controller_name>] | /deleterodfsrmember [<read_only_domain_controller_name>] | /?]
```

### <a name="parameters"></a>Параметры

| Параметр | Описание |
| --------- | ----------- |
| `/setglobalstate <state>` | Задает в качестве глобального состояния миграции домена значение, соответствующее значению, заданному параметром *State*. Состояние глобального миграции можно задать в стабильном состоянии. К значениям *состояния* относятся:<ul><li>**0** — начальное состояние</li><li>**1** -подготовленное состояние</li><li>**2** — перенаправленное состояние</li><li>**3** — Удаленное состояние</li></ul> |
| /жетглобалстате | Возвращает текущее глобальное состояние миграции для домена из локальной копии AD DS базы данных при запуске в эмуляторе основного контроллера домена. Используйте этот параметр, чтобы убедиться, что задано правильное состояние глобальной миграции.<p>**Важно.** Эту команду следует выполнять только в эмуляторе основного контроллера домена. |
| /жетмигратионстате | Извлекает текущее состояние локальной миграции для всех контроллеров домена в домене и определяет, соответствуют ли эти локальные состояния текущему глобальному состоянию миграции. Используйте этот параметр, чтобы определить, достигло ли все контроллеров домена состояния глобальной миграции. |
| /креатеглобалобжектс | Создает глобальные объекты и параметры в AD DS, используемых репликация DFS использует. При использовании этого параметра для ручного создания объектов и параметров следует использовать следующие ситуации:<ul><li>**Новый контроллер домена только для чтения повышается во время миграции**. Если новый контроллер домена только для чтения повышается в домене после перехода в состояние **готовности** , но до перехода в удаленное состояние **,** объекты, соответствующие новому контроллеру домена, не создаются, что приводит к сбою репликации и миграции.</li><li>**Глобальные параметры для службы репликация DFS отсутствуют или были удалены**. Если эти параметры отсутствуют для контроллера домена, миграция из состояния **запуска** в **подготовленное** состояние приведет к зависанию состояния **подготовки** . **Примечание.** Поскольку глобальные параметры AD DS для службы репликация DFS для контроллера домена только для чтения создаются на эмуляторе PDC, эти параметры необходимо реплицировать на контроллер домена только для чтения из эмулятора PDC, прежде чем служба репликация DFS на контроллере домена только для чтения сможет использовать эти параметры. Из-за Active Directory задержки репликации может потребоваться некоторое время. |
| `/deleterontfrsmember [<read_only_domain_controller_name>]` | Удаляет глобальные параметры AD DS для репликации FRS, соответствующие указанному контроллеру домена только для чтения, или удаляет глобальные параметры AD DS репликации FRS для всех контроллеров домена только для чтения, если для параметра не указано значение `<read_only_domain_controller_name>` .<p>Не следует использовать этот параметр во время обычного процесса миграции, так как служба репликация DFS автоматически удаляет эти параметры AD DS во время миграции из **перенаправленного** **состояния в удаленное состояние.** Используйте этот параметр, чтобы вручную удалить параметры AD DS только в случае сбоя автоматического удаления на контроллере домена только для чтения и зависания контроллера домена только для чтения для длительного IME во время миграции из **перенаправленного** **состояния в удаленное состояние.** |
| `/deleterodfsrmember [<read_only_domain_controller_name>]` | Удаляет глобальные параметры AD DS для репликация DFS, соответствующих указанному контроллеру домена только для чтения, или удаляет глобальные параметры AD DS для репликация DFS для всех контроллеров домена только для чтения, если для параметра не указано значение `<read_only_domain_controller_name>` .<p>Используйте этот параметр, чтобы вручную удалить параметры AD DS только в случае сбоя автоматического удаления на контроллере домена только для чтения и зависания контроллера домена только для чтения в течение длительного времени при откате миграции с подготовленного состояния на состояние запуска. |
| /? | Отображение справки в командной строке. |

#### <a name="remarks"></a>Комментарии

- Используйте `/setglobalstate <state>` команду, чтобы задать глобальное состояние миграции в AD DS эмуляторе основного контроллера домена, чтобы инициировать процесс миграции и управлять им. Если эмулятор основного контроллера домена недоступен, эта команда завершается с ошибкой.

- Миграция в **Удаленное состояние** необратима и откат невозможна, поэтому используйте значение **3** для параметра *State* только при полной фиксации в использовании репликация DFS для репликации SYSvol.

- Глобальные состояния миграции должны быть стабильными.

- Active Directory репликация реплицирует глобальное состояние на другие контроллеры домена в домене, но из-за задержек репликации можно получить несоответствия при запуске `dfsrmig /getglobalstate` на контроллере домена, отличном от эмулятора PDC.

- Выходные данные `dsfrmig /getmigrationstate` показывают, является ли миграция к текущему глобальному состоянию завершенной, перечисление состояния локальной миграции для всех контроллеров домена, которые еще не достигли текущего состояния глобальной миграции. Локальное состояние миграции для контроллеров домена также может включать состояния переходов для контроллеров домена, которые не достигли текущего состояния глобальной миграции.

- Контроллеры домена только для чтения не могут удалять параметры из AD DS, эмулятор основного контроллера домена выполняет эту операцию, и изменения в конечном итоге реплицируются на контроллеры домена только для чтения после подходящих задержек репликации Active Directory.

- Команда **Dfsrmig** поддерживается только на контроллерах домена, работающих на режиме работы домена Windows Server, так как миграция SYSVOL с FRS на репликация DFS возможна только на контроллерах домена, работающих на этом уровне.

- Команду **Dfsrmig** можно выполнить на любом контроллере домена, но операции, создающие или управляющие объектами AD DS, разрешены только на контроллерах домена с поддержкой чтения и записи (не на контроллерах домена только для чтения).

## <a name="examples"></a>Примеры

Чтобы задать для глобального состояния миграции значение подготовлено (**1**) и начать миграцию или выполнить откат из подготовленного состояния, введите:

```
dfsrmig /setglobalstate 1
```

Чтобы задать для глобального состояния миграции значение запуск (**0**) и начать откат до начального состояния, введите:

```
dfsrmig /setglobalstate 0
```

Чтобы отобразить состояние глобальной миграции, введите:

```
dfsrmig /getglobalstate
```

Выходные данные `dfsrmig /getglobalstate` команды:

```
Current DFSR global state: Prepared
Succeeded.
```

Чтобы отобразить сведения о том, совпадают ли локальные состояния миграции на всех контроллерах домена с глобальным состоянием миграции и существуют ли локальные состояния миграции, в которых локальное состояние не соответствует глобальному, введите:

```
dfsrmig /GetMigrationState
```

Выходные данные `dfsrmig /getmigrationstate` команды, когда состояние локальной миграции на всех контроллерах домена соответствует глобальному состоянию миграции:

```
All Domain Controllers have migrated successfully to Global state (Prepared).
Migration has reached a consistent state on all Domain Controllers.
Succeeded.
```

Выходные данные `dfsrmig /getmigrationstate` команды, если локальные состояния миграции на некоторых контроллерах домена не соответствуют глобальному состоянию миграции.

```
The following Domain Controllers are not in sync with Global state (Prepared):
Domain Controller (Local Migration State) DC type
=========
CONTOSO-DC2 (start) ReadOnly DC
CONTOSO-DC3 (Preparing) Writable DC
Migration has not yet reached a consistent state on all domain controllers
State information might be stale due to AD latency.
```

Чтобы создать глобальные объекты и параметры, которые репликация DFS используют в AD DS на контроллерах домена, где эти параметры не были автоматически созданы во время миграции, или если эти параметры отсутствуют, введите:

```
dfsrmig /createglobalobjects
```

Чтобы удалить глобальные параметры AD DS репликации FRS для контроллера домена только для чтения с именем Contoso-DC2, если эти параметры не были автоматически удалены процессом миграции, введите:

```
dfsrmig /deleterontfrsmember contoso-dc2
```

Чтобы удалить глобальные параметры AD DS для репликации FRS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены процессом миграции, введите:

```
dfsrmig /deleterontfrsmember
```

Чтобы удалить глобальные параметры AD DS для репликация DFS контроллера домена только для чтения с именем Contoso-DC2, если эти параметры не были автоматически удалены процессом миграции, введите:

```
dfsrmig /deleterodfsrmember contoso-dc2
```

Чтобы удалить глобальные параметры AD DS для репликация DFS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены процессом миграции, введите:

```
dfsrmig /deleterodfsrmember
```

Чтобы отобразить справку в командной строке, выполните следующую команду:

```
dfsrmig
```

```
dfsrmig /?
```

## <a name="additional-references"></a>Дополнительные ссылки

- [Условные обозначения синтаксиса команд командной строки](https://go.microsoft.com/fwlink/?LinkId=122056)

- [Серия миграции SYSvol. часть 2 dfsrmig.exe: средство миграции SYSvol](https://techcommunity.microsoft.com/t5/storage-at-microsoft/sysvol-migration-series-part-2-8211-dfsrmig-exe-the-sysvol/ba-p/423470)

- [Доменные службы Active Directory](../../identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview.md)
