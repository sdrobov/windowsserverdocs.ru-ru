---
title: certreq
description: Справочная статья по команде certreq, который запрашивает сертификаты из центра сертификации (ЦС), получает ответ на предыдущий запрос от центра сертификации, создает новый запрос из INF-файла, принимает и устанавливает ответ на запрос, создает запрос на перекрестную сертификацию или квалифицированное подчинение из существующего сертификата или запроса ЦС и подписывает запрос на перекрестную сертификацию или квалифицированное подчинение.
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: 7a04e51f-f395-4bff-b57a-0e9efcadf973
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 22fc496eddc17f4e6a1a5f02321c921009f9fd95
ms.sourcegitcommit: 2afed2461574a3f53f84fc9ec28d86df3b335685
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85924818"
---
# <a name="certreq"></a>certreq

Команду certreq можно использовать для запроса сертификатов из центра сертификации (ЦС), получение ответа на предыдущий запрос из центра сертификации для создания нового запроса из INF-файла для принятия и установки ответа на запрос, создания запроса на перекрестную сертификацию или квалифицированного подчинения из существующего сертификата или запроса ЦС, а также для подписания запроса на перекрестную сертификацию или запрос на квалифицированное подчинение.

> [!IMPORTANT]
> Более ранние версии команды certreq могут не предоставлять все описанные здесь параметры. Чтобы просмотреть Поддерживаемые параметры на основе конкретных версий средства certreq, выполните команду справки командной строки, `certreq -v -?` .
>
> Команда certreq не поддерживает создание нового запроса на сертификат на основе шаблона аттестации ключей в среде CEP/CES.

> [!WARNING]
> Содержимое этого раздела основано на параметрах по умолчанию для Windows Server; Например, можно задать длину ключа 2048, выбрать поставщик хранилища ключей программного обеспечения Майкрософт в качестве CSP и использовать алгоритм SHA-1 (SHA1). Оцените эти варианты в соответствии с требованиями политики безопасности вашей компании.

## <a name="syntax"></a>Синтаксис

```
certreq [-submit] [options] [requestfilein [certfileout [certchainfileout [fullresponsefileOut]]]]
certreq -retrieve [options] requestid [certfileout [certchainfileout [fullresponsefileOut]]]
certreq -new [options] [policyfilein [requestfileout]]
certreq -accept [options] [certchainfilein | fullresponsefilein | certfilein]
certreq -sign [options] [requestfilein [requestfileout]]
certreq –enroll [options] templatename
certreq –enroll –cert certId [options] renew [reusekeys]
```

### <a name="parameters"></a>Параметры

| Параметр | Описание |
| -------- | ----------- |
| -Отправить | Отправляет запрос в центр сертификации. |
| — получение`<requestid>` | Извлекает ответ на предыдущий запрос от центра сертификации. |
| -создать | Создает новый запрос из INF-файла. |
| — принять | Принимает и устанавливает ответ на запрос сертификата. |
| политика | Задает политику для запроса. |
| -Sign | Подписывает запрос на перекрестную сертификацию или квалифицированное подчинение. |
| регистрация | Регистрирует или обновляет сертификат. |
| -? | Отображает список синтаксиса, параметров и описаний средства Certreq. |
| `<parameter>` -? | Отображает справку по указанному параметру. |
| -v-? | Отображает подробный список синтаксиса, параметров и описаний Certreq. |

## <a name="examples"></a>Примеры

### <a name="certreq--submit"></a>certreq — отправка

Чтобы отправить запрос на простой сертификат, сделайте следующее:

```
certreq –submit certrequest.req certnew.cer certnew.pfx
```

#### <a name="remarks"></a>Комментарии

- Это параметр certreq.exe по умолчанию. Если в командной строке не указан параметр, certreq.exe пытается отправить запрос на сертификат в центр сертификации. При использовании параметра **– Submit** необходимо указать файл запроса сертификата. Если этот параметр пропущен, отображается общее окно **открытия файла** , позволяющее выбрать соответствующий файл запроса сертификата.

- Сведения о запросе сертификата путем указания атрибута SAN см. в разделе *Использование служебной программы certreq.exe для создания и отправки запроса на сертификат* в статье базы знаний Майкрософт 931351 [Добавление альтернативного имени субъекта к защищенному сертификату LDAP](https://support.microsoft.com/kb/931351).

### <a name="certreq--retrieve"></a>certreq — получение

Чтобы получить сертификат с ИДЕНТИФИКАТОРом 20 и создать файл сертификата (CER) с именем *мойсертификат*:

```
certreq -retrieve 20 MyCertificate.cer
```

#### <a name="remarks"></a>Комментарии

- Используйте certreq — получение *RequestId* для получения сертификата после его выдачи центром сертификации. Идентификатор *RequestId* ПКК может быть десятичным или шестнадцатеричным с префиксом 0x. он может быть серийным номером сертификата без префикса 0x. Его также можно использовать для получения сертификата, который когда-либо был выдан центром сертификации, включая отозванные или просроченные сертификаты, независимо от того, находится ли запрос сертификата в состоянии ожидания.

- Если отправить запрос в центр сертификации, то модуль политики центра сертификации может оставить запрос в состоянии ожидания и вернуть код *запроса* в certreq для отображения. В конечном итоге администратор центра сертификации выдаст сертификат или отклонит запрос.

### <a name="certreq--new"></a>certreq — new

Создание нового запроса:

```
[newrequest]
; At least one value must be set in this section
subject = CN=W2K8-BO-DC.contoso2.com
```

Ниже приведены некоторые из возможных разделов, которые можно добавить в INF-файл.

#### <a name="newrequest"></a>newRequest

Эта область INF-файла является обязательной для всех новых шаблонов запросов сертификатов и должна включать хотя бы один параметр со значением.

| Ключ<sup>1</sup> | Описание | Значение<sup>2</sup> | Пример |
| --- | ---------- | ----- | ------- |
| Субъект | Несколько приложений используют сведения о субъекте в сертификате. Рекомендуется указывать значение для этого ключа. Если тема не задана, мы рекомендуем включить имя субъекта как часть расширения сертификата альтернативного имени субъекта. | Строковые значения относительного различающегося имени | Subject = CN = COMPUTER1. contoso. com subject = CN = John Smith, CN = Users, DC = contoso, DC = com |
| Exportable | Если задано значение TRUE, закрытый ключ можно экспортировать вместе с сертификатом. Чтобы обеспечить высокий уровень безопасности, закрытые ключи не должны быть экспортированы. Однако в некоторых случаях это может потребоваться, если несколько компьютеров или пользователей должны совместно использовать один закрытый ключ. | `true | false` | `Exportable = TRUE`. Ключи CNG могут различать этот и экспортируемый текст. Ключи CAPI1 не могут быть. |
| експортаблинкриптед | Указывает, должен ли закрытый ключ быть настроен для экспорта. | `true | false` | `ExportableEncrypted = true`<p>**Совет.** Не все размеры открытых ключей и алгоритмы будут работать со всеми алгоритмами хэширования. Указанный CSP также должен поддерживать указанный хэш-алгоритм. Чтобы просмотреть список поддерживаемых хэш-алгоритмов, можно выполнить команду:`certutil -oid 1 | findstr pwszCNGAlgid | findstr /v CryptOIDInfo` |
| HashAlgorithm | Хэш-алгоритм, используемый для этого запроса. | `Sha256, sha384, sha512, sha1, md5, md4, md2` | `HashAlgorithm = sha1`. Чтобы просмотреть список поддерживаемых хэш-алгоритмов, используйте команду certutil-OID 1. | Findstr Пвсзкнгалгид | Findstr/v Криптоидинфо|
| KeyAlgorithm| Алгоритм, который будет использоваться поставщиком услуг для создания пары открытого и закрытого ключей.| `RSA, DH, DSA, ECDH_P256, ECDH_P521, ECDSA_P256, ECDSA_P384, ECDSA_P521` | `KeyAlgorithm = RSA` |
| KeyContainer | Не рекомендуется задавать этот параметр для новых запросов, в которых создается новый материал ключа. Контейнер ключей автоматически создается и обслуживается системой.<p>Для запросов, в которых следует использовать существующий ключевой материал, это значение можно задать в качестве имени контейнера ключа для существующего ключа. Используйте `certutil –key` команду, чтобы отобразить список доступных контейнеров ключей для контекста компьютера. Используйте `certutil –key –user` команду для контекста текущего пользователя.| Случайное строковое значение<p>**Совет.** Используйте двойные кавычки вокруг любого значения ключа INF, которое содержит пробелы или специальные символы, чтобы избежать потенциальных проблем синтаксического анализа INF. | `KeyContainer = {C347BD28-7F69-4090-AA16-BC58CF4D749C}` |
| KeyLength | Определяет длину открытого и закрытого ключей. Длина ключа влияет на уровень безопасности сертификата. Большая длина ключа обычно обеспечивает более высокий уровень безопасности. Однако некоторые приложения могут иметь ограничения, связанные с длиной ключа. | Любая допустимая длина ключа, поддерживаемая поставщиком служб шифрования. | `KeyLength = 2048` |
| KeySpec | Определяет, можно ли использовать ключ для подписей, для обмена (шифрования) или для обоих. | `AT_NONE, AT_SIGNATURE, AT_KEYEXCHANGE` | `KeySpec = AT_KEYEXCHANGE` |
| кэйусаже | Определяет, для чего следует использовать ключ сертификата. | <ul><li>`CERT_DIGITAL_SIGNATURE_KEY_USAGE -- 80 (128)`</li><li>`CERT_NON_REPUDIATION_KEY_USAGE -- 40 (64)`</li><li>`CERT_KEY_ENCIPHERMENT_KEY_USAGE -- 20 (32)`</li><li>`CERT_DATA_ENCIPHERMENT_KEY_USAGE -- 10 (16)`</li><li>`CERT_KEY_AGREEMENT_KEY_USAGE -- 8`</li><li>`CERT_KEY_CERT_SIGN_KEY_USAGE -- 4`</li><li>`CERT_OFFLINE_CRL_SIGN_KEY_USAGE -- 2`</li><li>`CERT_CRL_SIGN_KEY_USAGE -- 2`</li><li>`CERT_ENCIPHER_ONLY_KEY_USAGE -- 1`</li><li>`CERT_DECIPHER_ONLY_KEY_USAGE -- 8000 (32768)`</li></ul> | `KeyUsage = CERT_DIGITAL_SIGNATURE_KEY_USAGE | CERT_KEY_ENCIPHERMENT_KEY_USAGE`<p>**Совет.** Несколько значений используют канал (|) разделитель символов. Обязательно используйте двойные кавычки при использовании нескольких значений, чтобы избежать проблем с синтаксическим анализом INF. Отображаемые значения — это шестнадцатеричные (десятичные) значения для каждого определения бита. Более старый синтаксис также можно использовать: одно шестнадцатеричное значение с несколькими наборами битов вместо символьного представления. Например, `KeyUsage = 0xa0`. |
| кэйусажепроперти | Извлекает значение, определяющее конкретную цель, для которой можно использовать закрытый ключ. | <ul><li>`NCRYPT_ALLOW_DECRYPT_FLAG -- 1`</li><li>`NCRYPT_ALLOW_SIGNING_FLAG -- 2`</li><li>`NCRYPT_ALLOW_KEY_AGREEMENT_FLAG -- 4`</li><li>`NCRYPT_ALLOW_ALL_USAGES -- ffffff (16777215)`</li></ul> | `KeyUsageProperty = NCRYPT_ALLOW_DECRYPT_FLAG | NCRYPT_ALLOW_SIGNING_FLAG` |
| MachineKeySet | Этот ключ важен, если необходимо создать сертификаты, принадлежащие компьютеру, а не пользователю. Создаваемый ключевой материал сохраняется в контексте безопасности субъекта безопасности (учетной записи пользователя или компьютера), создавшего запрос. Когда администратор создает запрос на сертификат от имени компьютера, материал ключа должен быть создан в контексте безопасности компьютера, а не в контексте безопасности администратора. В противном случае компьютер не сможет получить доступ к закрытому ключу, так как он был бы в контексте безопасности администратора. | `true | false`. Значение по умолчанию — false. | `MachineKeySet = true` |
| NotBefore | Указывает дату или дату и время, до которого запрос не может быть выдан. `NotBefore`может использоваться с `ValidityPeriod` и `ValidityPeriodUnits` . | Дата или Дата и время | `NotBefore = 7/24/2012 10:31 AM`<p>**Совет.** `NotBefore` и `NotAfter` предназначены только для R `equestType=cert` . Попытки синтаксического анализа даты, зависящие от языкового стандарта. Использование названий месяцев не позволит устранить неоднозначность и будет работать в каждом языковом стандарте. |
| NotAfter | Указывает дату или дату и время, по истечении которых запрос не может быть выдан. `NotAfter`не может использоваться с `ValidityPeriod` или `ValidityPeriodUnits` . | Дата или Дата и время | `NotAfter = 9/23/2014 10:31 AM`<p>**Совет.** `NotBefore` и `NotAfter` предназначены `RequestType=cert` только для. Попытки синтаксического анализа даты, зависящие от языкового стандарта. Использование названий месяцев не позволит устранить неоднозначность и будет работать в каждом языковом стандарте. |
| приватекэйарчиве | Параметр Приватекэйарчиве работает, только если для соответствующего параметра RequestType задано значение CMC, так как только сообщения управления сертификатами в формате запроса CMS (CMC) позволяют безопасно передавать закрытый ключ инициатора запроса в ЦС для архивирования ключей. | `true | false` | `PrivateKeyArchive = true` |
| EncryptionAlgorithm | Используемый алгоритм шифрования. | Возможные параметры различаются в зависимости от версии операционной системы и набора установленных поставщиков служб шифрования. Чтобы просмотреть список доступных алгоритмов, выполните команду: `certutil -oid 2 | findstr pwszCNGAlgid` . Указанный CSP должен также поддерживать указанный алгоритм симметричного шифрования и длину. | `EncryptionAlgorithm = 3des` |
| енкриптионленгс | Длина используемого алгоритма шифрования. | Любая длина, разрешенная указанным EncryptionAlgorithm. | `EncryptionLength = 128` |
| ProviderName | Имя поставщика — это отображаемое имя CSP. | Если вы не умеете использовать имя поставщика CSP, запустите `certutil –csplist` из командной строки. Команда отобразит имена всех CSP, доступных в локальной системе. | `ProviderName = Microsoft RSA SChannel Cryptographic Provider` |
| ProviderType | Тип поставщика используется для выбора конкретных поставщиков на основе конкретных возможностей алгоритма, таких как RSA Full. | Если вы не знакомы с типом поставщика CSP, запустите `certutil –csplist` из командной строки. Команда отобразит тип поставщика всех CSP, доступных в локальной системе. | `ProviderType = 1` |
| реневалцерт | Если необходимо продлить сертификат, существующий в системе, в которой создается запрос сертификата, необходимо указать его хэш сертификата в качестве значения для этого ключа. | Хэш сертификата любого сертификата, доступного на компьютере, на котором создается запрос на сертификат. Если вы не узнаете хэш сертификата, используйте оснастку MMC "сертификаты" и просмотрите сертификат, который следует обновить. Откройте свойства сертификата и просмотрите `Thumbprint` атрибут сертификата. Для продления сертификата требуется `PKCS#7` `CMC` Формат запроса или. | `RenewalCert = 4EDF274BD2919C6E9EC6A522F0F3B153E9B1582D` |
| RequesterName | Выполняет запрос на регистрацию от имени другого запроса пользователя. Запрос также должен быть подписан с помощью сертификата агента регистрации, иначе центр сертификации отклонит запрос. Используйте `-cert` параметр, чтобы указать сертификат агента регистрации. Имя запросившего можно указать для запросов на сертификат, если для задано `RequestType` значение `PKCS#7` или `CMC` . Если параметр `RequestType` имеет значение `PKCS#10` , этот ключ будет проигнорирован. `Requestername`Может быть установлен только в составе запроса. Вы не можете управлять `Requestername` в ожидающем запросе. | `Domain\User` | `Requestername = Contoso\BSmith` |
| RequestType | Определяет стандарт, используемый для создания и отправки запроса на сертификат. | <ul><li>`PKCS10 -- 1`</li><li>`PKCS7 -- 2`</li><li>`CMC -- 3`</li><li>`Cert -- 4`</li><li>`SCEP -- fd00 (64768)`</li></ul>**Совет.** Этот параметр указывает на самозаверяющий или самостоятельно выданный сертификат. Он не создает запрос, а вместо нового сертификата, а затем устанавливает сертификат. По умолчанию используется Self-подпись. Укажите сертификат подписи с помощью параметра – CERT, чтобы создать самозаверяющий сертификат, который не является самозаверяющим. | `RequestType = CMC` |
| SecurityDescriptor | Содержит сведения о безопасности, связанные с защищаемыми объектами. Для большинства защищаемых объектов можно указать дескриптор безопасности объекта в вызове функции, который создает объект. Строки, основанные на [языке определения дескрипторов безопасности](https://msdn.microsoft.com/library/aa379567(v=vs.85).aspx).<p>**Совет.** Это относится только к несмартным ключам машинного контекста. | `SecurityDescriptor = D:P(A;;GA;;;SY)(A;;GA;;;BA)` |
| алтернатесигнатуреалгорисм | Указывает и получает логическое значение, указывающее, является ли идентификатор объекта алгоритма подписи для запроса или подписи сертификата PKCS # 10 дискретным или Объединенным. | `true | false` | `AlternateSignatureAlgorithm = false`<p>Для сигнатуры RSA `false` указывает `Pkcs1 v1.5` , а `true` указывает на `v2.1` сигнатуру. |
| Автоматически | По умолчанию этот параметр позволяет CSP получать доступ к рабочему столу интерактивного пользователя и запрашивать такие сведения, как ПИН-код с картой пользователя. Если этот ключ имеет значение TRUE, CSP не должен взаимодействовать с рабочим столом и будет блокировать отображение пользовательского интерфейса для пользователя. | `true | false` | `Silent = true` |
| ЗАШИФРОВАН | Если этот параметр имеет значение TRUE, то в запрос добавляется расширение с идентификатором объекта 1.2.840.113549.1.9.15. Количество идентификаторов объектов зависит от установленной версии операционной системы и возможности CSP, которые относятся к алгоритмам симметричного шифрования, которые могут использоваться приложениями, использующими безопасные многоцелевые расширения электронной почты Интернета (S/MIME), например Outlook. | `true | false` | `SMIME = true` |
| усиксистингкэйсет | Этот параметр используется, чтобы указать, что при создании запроса на сертификат следует использовать существующую пару ключей. Если для этого раздела задано значение TRUE, необходимо также указать имя для ключа Реневалцерт или KeyContainer. Не следует задавать экспортируемый ключ, так как нельзя изменить свойства существующего ключа. В этом случае материал ключа не создается при создании запроса на сертификат. | `true | false` | `UseExistingKeySet = true` |
| кэйпротектион | Задает значение, указывающее, как защищен закрытый ключ перед использованием. | <ul><li>`XCN_NCRYPT_UI_NO_PROTCTION_FLAG -- 0`</li><li>`XCN_NCRYPT_UI_PROTECT_KEY_FLAG -- 1`</li><li>`XCN_NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG -- 2`</li></ul> | `KeyProtection = NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG` |
| суппрессдефаултс | Задает логическое значение, указывающее, включаются ли в запрос расширения по умолчанию и атрибуты. Значения по умолчанию представлены идентификаторами объектов (OID). | `true | false` | `SuppressDefaults = true` |
| FriendlyName | Понятное имя для нового сертификата. | Text | `FriendlyName = Server1` |
| ValidityPeriodUnits | Указывает число единиц, которое будет использоваться с Валидитипериод. Примечание. используется, только если `request type=cert` . | Числовой | `ValidityPeriodUnits = 3` |
| ValidityPeriod | Валидитипериод должен быть одновременным периодом английского языка (США). Примечание. используется, только если тип запроса — CERT. | `Years |  Months | Weeks | Days | Hours | Minutes | Seconds` | `ValidityPeriod = Years` |

<sup>1</sup> Параметр слева от знака равенства (=)

<sup>2</sup> Параметр справа от знака равенства (=)

#### <a name="extensions"></a>расширений

Этот раздел является необязательным.

| OID расширения | Определение | Пример |
| ------------- | ---------- | ----- | ------- |
| 2.5.29.17 | | 2.5.29.17 = {текст} |
| *continue* | | `continue = UPN=User@Domain.com&` |
| *continue* | | `continue = EMail=User@Domain.com&` |
| *continue* | | `continue = DNS=host.domain.com&` |
| *continue* | | `continue = DirectoryName=CN=Name,DC=Domain,DC=com&` |
| *continue* | | `continue = URL=<http://host.domain.com/default.html&>` |
| *continue* | | `continue = IPAddress=10.0.0.1&` |
| *continue* | | `continue = RegisteredId=1.2.3.4.5&` |
| *continue* | | `continue = 1.2.3.4.6.1={utf8}String&` |
| *continue* | | `continue = 1.2.3.4.6.2={octet}AAECAwQFBgc=&` |
| *continue* | | `continue = 1.2.3.4.6.2={octet}{hex}00 01 02 03 04 05 06 07&` |
| *continue* | | `continue = 1.2.3.4.6.3={asn}BAgAAQIDBAUGBw==&` |
| *continue* | | `continue = 1.2.3.4.6.3={hex}04 08 00 01 02 03 04 05 06 07` |
| 2.5.29.37 | | `2.5.29.37={text}` |
| *continue* | | `continue = 1.3.6.1.5.5.7` |
| *continue* | | `continue = 1.3.6.1.5.5.7.3.1` |
| 2.5.29.19 | | `{text}ca=0pathlength=3` |
| Критически важно | | `Critical=2.5.29.19` |
| KeySpec | | <ul><li>`AT_NONE -- 0`</li><li>`AT_SIGNATURE -- 2`</li><li>`AT_KEYEXCHANGE -- 1`</ul></li> |
| RequestType | | <ul><li>`PKCS10 -- 1`</li><li>`PKCS7 -- 2`</li><li>`CMC -- 3`</li><li>`Cert -- 4`</li><li>`SCEP -- fd00 (64768)`</li></ul> |
| кэйусаже | | <ul><li>`CERT_DIGITAL_SIGNATURE_KEY_USAGE -- 80 (128)`</li><li>`CERT_NON_REPUDIATION_KEY_USAGE -- 40 (64)`</li><li>`CERT_KEY_ENCIPHERMENT_KEY_USAGE -- 20 (32)`</li><li>`CERT_DATA_ENCIPHERMENT_KEY_USAGE -- 10 (16)`</li><li>`CERT_KEY_AGREEMENT_KEY_USAGE -- 8`</li><li>`CERT_KEY_CERT_SIGN_KEY_USAGE -- 4`</li><li>`CERT_OFFLINE_CRL_SIGN_KEY_USAGE -- 2`</li><li>`CERT_CRL_SIGN_KEY_USAGE -- 2`</li><li>`CERT_ENCIPHER_ONLY_KEY_USAGE -- 1`</li><li>`CERT_DECIPHER_ONLY_KEY_USAGE -- 8000 (32768)`</li></ul> |
| кэйусажепроперти | | <ul><li>`NCRYPT_ALLOW_DECRYPT_FLAG -- 1`</li><li>`NCRYPT_ALLOW_SIGNING_FLAG -- 2`</li><li>`NCRYPT_ALLOW_KEY_AGREEMENT_FLAG -- 4`</li><li>`NCRYPT_ALLOW_ALL_USAGES -- ffffff (16777215)`</li></ul> |
| кэйпротектион | | <ul><li>`NCRYPT_UI_NO_PROTECTION_FLAG -- 0`</li><li>`NCRYPT_UI_PROTECT_KEY_FLAG -- 1`</li><li>`NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG -- 2`</li></ul> |
| субжектнамефлагс | шаблон | <ul><li>`CT_FLAG_SUBJECT_REQUIRE_COMMON_NAME -- 40000000 (1073741824)`</li><li>`CT_FLAG_SUBJECT_REQUIRE_DIRECTORY_PATH -- 80000000 (2147483648)`</li><li>`CT_FLAG_SUBJECT_REQUIRE_DNS_AS_CN -- 10000000 (268435456)`</li><li>`CT_FLAG_SUBJECT_REQUIRE_EMAIL -- 20000000 (536870912)`</li><li>`CT_FLAG_OLD_CERT_SUPPLIES_SUBJECT_AND_ALT_NAME -- 8`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_DIRECTORY_GUID -- 1000000 (16777216)`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_DNS -- 8000000 (134217728)`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_DOMAIN_DNS -- 400000 (4194304)`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_EMAIL -- 4000000 (67108864)`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_SPN -- 800000 (8388608)`</li><li>`CT_FLAG_SUBJECT_ALT_REQUIRE_UPN -- 2000000 (33554432)`</li></ul> |
| X500NameFlags | | <ul><li>`CERT_NAME_STR_NONE -- 0`</li><li>`CERT_OID_NAME_STR -- 2`</li><li>`CERT_X500_NAME_STR -- 3`</li><li>`CERT_NAME_STR_SEMICOLON_FLAG -- 40000000 (1073741824)`</li><li>`CERT_NAME_STR_NO_PLUS_FLAG -- 20000000 (536870912)`</li><li>`CERT_NAME_STR_NO_QUOTING_FLAG -- 10000000 (268435456)`</li><li>`CERT_NAME_STR_CRLF_FLAG -- 8000000 (134217728)`</li><li>`CERT_NAME_STR_COMMA_FLAG -- 4000000 (67108864)`</li><li>`CERT_NAME_STR_REVERSE_FLAG -- 2000000 (33554432)`</li><li>`CERT_NAME_STR_FORWARD_FLAG -- 1000000 (16777216)`</li><li>`CERT_NAME_STR_DISABLE_IE4_UTF8_FLAG -- 10000 (65536)`</li><li>`CERT_NAME_STR_ENABLE_T61_UNICODE_FLAG -- 20000 (131072)`</li><li>`CERT_NAME_STR_ENABLE_UTF8_UNICODE_FLAG -- 40000 (262144)`</li><li>`CERT_NAME_STR_FORCE_UTF8_DIR_STR_FLAG -- 80000 (524288)`</li><li>`CERT_NAME_STR_DISABLE_UTF8_DIR_STR_FLAG -- 100000 (1048576)`</li><li>`CERT_NAME_STR_ENABLE_PUNYCODE_FLAG -- 200000 (2097152)`</li></ul> |

> [!NOTE]
> `SubjectNameFlags`позволяет INF-файлу указать, какие поля **темы** и расширения **SubjectAltName** должны автоматически заполняться программой Certreq на основе текущего пользователя или свойств текущего компьютера: DNS-имя, UPN и т. д. Использование шаблона Literal означает, что вместо них используются флаги имени шаблона. Это позволяет использовать один файл INF в нескольких контекстах для создания запросов с информацией о теме, зависящей от контекста.
>
> `X500NameFlags`Задает флаги, передаваемые непосредственно в `CertStrToName` API при `Subject INF keys` преобразовании значения в различающееся **имя**в кодировке ASN. 1.

#### <a name="example"></a>Пример

Чтобы создать файл политики (. INF) в блокноте и сохранить его как *рекуестконфиг. INF*:

```
[NewRequest]
Subject = CN=<FQDN of computer you are creating the certificate>
Exportable = TRUE
KeyLength = 2048
KeySpec = 1
KeyUsage = 0xf0
MachineKeySet = TRUE
[RequestAttributes]
CertificateTemplate=WebServer
[Extensions]
OID = 1.3.6.1.5.5.7.3.1
OID = 1.3.6.1.5.5.7.3.2
```

На компьютере, для которого запрашивается сертификат, выполните следующие действия.

```
certreq –new requestconfig.inf certrequest.req
```

Использование синтаксиса раздела [Strings] для идентификаторов объектов и других сложностей для интерпретации данных. Новый пример синтаксиса {Text} для расширения EKU, в котором используется список идентификаторов объектов с разделителями-запятыми:

```
[Version]
Signature=$Windows NT$

[Strings]
szOID_ENHANCED_KEY_USAGE = 2.5.29.37
szOID_PKIX_KP_SERVER_AUTH = 1.3.6.1.5.5.7.3.1
szOID_PKIX_KP_CLIENT_AUTH = 1.3.6.1.5.5.7.3.2

[NewRequest]
Subject = CN=TestSelfSignedCert
Requesttype = Cert

[Extensions]
%szOID_ENHANCED_KEY_USAGE%={text}%szOID_PKIX_KP_SERVER_AUTH%,
_continue_ = %szOID_PKIX_KP_CLIENT_AUTH%
```

### <a name="certreq--accept"></a>certreq — Accept

`–accept`Параметр связывает ранее созданный закрытый ключ с выданным сертификатом и удаляет ожидающий запрос сертификата из системы, в которой запрошен сертификат (при наличии соответствующего запроса).

Чтобы вручную принять сертификат, сделайте следующее:

```
certreq -accept certnew.cer
```

> [!WARNING]
> С помощью `-accept` параметра с `-user` параметрами и `–machine` указывается, следует ли устанавливать сертификат установки в контексте **пользователя** или **компьютера** . Если в любом контексте, соответствующем установленному открытому ключу, есть необработанный запрос, эти параметры не нужны. Если нет необработанных запросов, необходимо указать один из них.

### <a name="certreq--policy"></a>certreq — политика

Файл Policy. INF — это файл конфигурации, определяющий ограничения, применяемые к сертификации ЦС при определении квалифицированного подчинения.

Чтобы создать перекрестный запрос сертификатов, выполните следующие действия.

```
certreq -policy certsrv.req policy.inf newcertsrv.req
```

`certreq -policy`При использовании без какого-либо дополнительного параметра открывается диалоговое окно, позволяющее выбрать запрошенные файлом (. req,. CMC,. txt,. der,. cer или. CRT). После выбора требуемого файла и нажатия кнопки **Открыть**открывается другое диалоговое окно, в котором можно выбрать файл Policy. INF.

#### <a name="examples"></a>Примеры

Найдите пример файла Policy. INF в [синтаксисе CAPolicy. INF](https://docs.microsoft.com/windows-server/networking/core-network-guide/cncg/server-certs/prepare-the-capolicy-inf-file).

### <a name="certreq--sign"></a>certreq-Sign

Чтобы создать новый запрос на сертификат, подпишите его и отправьте.

```
certreq -new policyfile.inf myrequest.req
certreq -sign myrequest.req myrequest.req
certreq -submit myrequest_sign.req myrequest_cert.cer
```

#### <a name="remarks"></a>Комментарии

- `certreq -sign`При использовании без каких-либо дополнительных параметров откроется диалоговое окно, в котором можно выбрать запрошенный файл (req, CMC, txt, Der, CER или CRT).

- Для подписывания запроса на квалифицированное подчинение может потребоваться учетные данные **администратора предприятия** . Это рекомендуемый способ выдачи сертификатов подписи для квалифицированного подчинения.

- Сертификат, используемый для подписания запроса на квалифицированное подчинение, использует шаблон квалифицированного подчинения. Администраторы предприятия должны подписать запрос или предоставить пользователям разрешения на подпись сертификата.

- После этого может потребоваться дополнительное подписание сотрудником запроса CMC. Это будет зависеть от уровня гарантии, связанного с квалифицированным подчиненным.

- Если родительский ЦС устанавливаемого квалифицированного подчиненного ЦС находится в автономном режиме, необходимо получить сертификат ЦС для квалифицированного подчиненного ЦС из автономного родительского сайта. Если родительский ЦС находится в сети, укажите сертификат ЦС для квалифицированного подчиненного ЦС в мастере **установки служб сертификатов** .

### <a name="certreq--enroll"></a>certreq — регистрация

Этот комментарий можно использовать для регистрации или обновления сертификатов.

#### <a name="examples"></a>Примеры

Чтобы зарегистрировать сертификат с *помощью шаблона и выбрать сервер политики* с помощью U/I:

```
certreq -enroll –machine –policyserver * WebServer
```

Чтобы продлить сертификат с помощью серийного номера, сделайте следующее:

```
certreq –enroll -machine –cert 61 2d 3c fe 00 00 00 00 00 05 renew
```

Можно обновить только действительные сертификаты. Сертификаты с истекшим сроком действия не могут быть обновлены. их необходимо заменить новым сертификатом.

## <a name="options"></a>Варианты

| Параметры | Описание |
| ------- | ----------- |
| -Any | `Force ICertRequest::Submit`для определения типа кодировки.|
| -ATTRIB`<attributestring>` | Задает пары строк **имя** и **значение** , разделенные двоеточием.<p>Разделяйте пары " **имя** -значение" и строки **значений** с помощью `\n` (например, Name1: value1\nName2: value2). |
| -Binary | Форматирует выходные файлы в двоичном виде, а не в кодировке Base64. |
| -полицисервер`<policyserver>` | LDAP`<path>`<br>Вставьте универсальный код ресурса (URI) или уникальный идентификатор компьютера, на котором запущена веб-служба политики регистрации сертификатов.<p>Чтобы указать, что вы хотите использовать файл запроса при просмотре, просто используйте знак минуса (-) для `<policyserver>` . |
| -config`<ConfigString>` | Обрабатывает операцию с помощью центра сертификации, указанного в строке конфигурации, которая является **кахостнаме\канаме**. Для подключения HTTPS: \\ \ укажите URI сервера регистрации. Для центра сертификации локального компьютера используйте знак "минус" (-). |
| — Анонимный | Используйте анонимные учетные данные для веб-служб регистрации сертификатов. |
| — Kerberos | Используйте учетные данные Kerberos (домен) для веб-служб регистрации сертификатов. |
| -clientcertificate`<ClientCertId>` | Можно заменить на `<ClientCertId>` отпечаток сертификата, CN, EKU, шаблона, электронной почты, имени участника-пользователя или нового `name=value` синтаксиса. |
| -username`<username>` | Используется с веб-службами регистрации сертификатов. Можно заменить `<username>` на имя SAM или **домен \ имя_пользователя** . Этот параметр предназначен для использования с `-p` параметром. |
| -p`<password>` | Используется с веб-службами регистрации сертификатов. Замените `<password>` фактическим паролем пользователя. Этот параметр предназначен для использования с `-username` параметром. |
| пользователь | Настраивает `-user` контекст для нового запроса на сертификат или задает контекст для приема сертификата. Это контекст по умолчанию, если в INF-файле или шаблоне не указано ни одного. |
| -Machine | Настраивает новый запрос на сертификат или задает контекст для приема сертификата для контекста компьютера. Для новых запросов он должен соответствовать ключу INF-файла MachineKeyset и контексту шаблона. Если этот параметр не указан и шаблон не задает контекст, то по умолчанию используется контекст пользователя. |
| — список отзыва сертификатов | Включает списки отзыва сертификатов (CRL) в выходных данных в файл PKCS #7 в кодировке Base64, указанный в параметре `certchainfileout` или, в файл в кодировке Base64, заданный параметром `requestfileout` . |
| -RPC | Предписывает Active Directory службам сертификации (AD CS) использовать подключение сервера удаленного вызова процедур (RPC) вместо распределенного COM. |
| -админфорцемачине | Используйте службу ключей или олицетворение, чтобы отправить запрос из контекста локальной системы. Требует, чтобы пользователь, вызывающий этот параметр, был членом локальных администраторов. |
| -реневонбехалфоф | Отправьте продление от имени субъекта, указанного в сертификате для подписи. Это задает CR_IN_ROBO при вызове [метода интерфейса ICertRequest:: submit](https://docs.microsoft.com/windows/win32/api/certcli/nf-certcli-icertrequest-submit) |
| -f | Принудительная перезапись существующих файлов. Это также обходит шаблоны кэширования и политики. |
| -Q | Использовать режим молчания; подавлять все интерактивные запросы. |
| — Юникод | Записывает выходные данные в Юникоде, когда стандартные выходные данные перенаправляются или передаются другой команде, что помогает при вызове из сценариев Windows PowerShell. |
| -уникодетекст | Отправляет выходные данные в формате Юникод при записи больших двоичных объектов данных в кодировке Base64 в файлы. |

## <a name="formats"></a>Форматы

| Форматы | Описание |
| ------- | ----------- |
| рекуестфилеин | Имя входного файла в кодировке Base64: запрос сертификата PKCS #10, запрос на сертификат CMS, запрос на продление сертификата PKCS #7, сертификат X. 509 для перекрестной сертификации или запрос сертификата в формате тега KeyGen. |
| рекуестфилеаут | Имя выходного файла в кодировке Base64. |
| цертфилеаут | Имя файла X-509 в кодировке Base64. |
| PKCS10fileout | Для использования только с `certreq -policy` параметром. Имя выходного файла PKCS10 в кодировке Base64. |
| цертчаинфилеаут | Имя файла PKCS #7 в кодировке Base64. |
| фуллреспонсефилеаут | Полное имя файла ответа в кодировке Base64. |
| полицифилеин | Для использования только с `certreq -policy` параметром. INF-файл, содержащий текстовое представление расширений, используемых для уточнения запроса. |

## <a name="additional-resources"></a>Дополнительные ресурсы

В следующих статьях содержатся примеры использования certreq:

- [Добавление альтернативного имени субъекта к защищенному сертификату LDAP](https://support.microsoft.com/help/931351/how-to-add-a-subject-alternative-name-to-a-secure-ldap-certificate)

- [Test Lab Guide: Deploying an AD CS Two-Tier PKI Hierarchy](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831348(v=ws.11))

- [Приложение 3. синтаксис Certreq.exe](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc736326(v=ws.10))

- [Как создать сертификат SSL веб-сервера вручную](https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/how-to-create-a-web-server-ssl-certificate-manually/ba-p/1128529)

- [Запрос сертификата инициализации AMT с помощью центра сертификации Windows Server 2008](https://social.technet.microsoft.com/wiki/contents/articles/548.request-an-amt-provisioning-certificate-using-a-windows-server-2008-ca.aspx)

- [Регистрация сертификата для агента System Center Operations Manager](https://social.technet.microsoft.com/wiki/contents/articles/2017.certificate-enrollment-for-system-center-operations-manager-agent.aspx)

- [Пошаговое руководство по службам AD CS: развертывание иерархии PKI на двух уровнях](https://social.technet.microsoft.com/wiki/contents/articles/15037.ad-cs-step-by-step-guide-two-tier-pki-hierarchy-deployment.aspx)

- [Включение LDAP по протоколу SSL с помощью стороннего центра сертификации](https://support.microsoft.com/help/321051/how-to-enable-ldap-over-ssl-with-a-third-party-certification-authority)
