---
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: Планирование топологии развертывания AD FS
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 757cfc5264fe528cf4e859636403bf4cdf091389
ms.sourcegitcommit: 3632b72f63fe4e70eea6c2e97f17d54cb49566fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87519913"
---
# <a name="plan-your-ad-fs-deployment-topology"></a>Планирование топологии развертывания AD FS

Первым шагом в планировании развертывания службы федерации Active Directory (AD FS) (AD FS) является определение правильной топологии развертывания в соответствии с потребностями Организации.

Перед прочтением этого раздела ознакомьтесь с тем, как AD FS данные хранятся и реплицируются на другие серверы федерации в ферме серверов федерации, и убедитесь, что вы понимаете назначение и методы репликации, которые можно использовать для базовых данных, хранящихся в базе данных конфигурации AD FS.

Существует два типа баз данных, которые можно использовать для хранения AD FS данных конфигурации: Внутренняя база данных Windows (WID) и Microsoft SQL Server. Дополнительные сведения см. в разделе [Роль базы данных конфигурации AD FS](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md). Ознакомьтесь с различными преимуществами и ограничениями, связанными с использованием WID или SQL Server в качестве базы данных конфигурации AD FS, а также различных сценариев приложений, которые они поддерживают, а затем делают выбор.

> [!IMPORTANT]
> Для реализации базовой избыточности, балансировки нагрузки и возможности масштабировать службу федерации (при необходимости) рекомендуется развертывать по меньшей мере два сервера федерации на каждой ферме серверов федерации во всех рабочих средах независимо от используемого типа баз данных.

## <a name="determining-which-type-of-adfs-configuration-database-to-use"></a>Определение требуемого типа базы данных конфигурации AD FS
AD FS использует базу данных для хранения конфигурации и, в некоторых случаях, данные о транзакциях, связанные с служба федерации. AD FS программное обеспечение можно использовать для выбора встроенной внутренней базы данных Windows (WID) или Microsoft SQL Server 2008 или более поздней версии для хранения данных в служба федерации.

Для большинства целей эти два типа баз данных относительно эквивалентны. Тем не менее, прежде чем приступить к ознакомлению с различными топологиями развертывания, которые можно использовать с AD FS, необходимо помнить о некоторых различиях. В таблице ниже описаны различия в поддерживаемых функциях между внутренней базой данных Windows и базой данных SQL Server.

|Описание|Компонент|Поддерживается внутренней базой данных Windows?|Поддерживается SQL Server?
| --- | --- | --- |--- |
|AD FS функции|Развертывание фермы серверов федерации|Да. Ферма WID имеет ограничение в 30 серверов федерации, если у вас 100 или меньше отношений доверия проверяющей стороны.</br></br>Ферма WID не поддерживает определение воспроизведения маркеров или разрешение артефактов (входит в состав протокола язык разметки зявлений системы безопасности (SAML) (SAML)). |Да. Действующих ограничений на число серверов федерации, которые можно развернуть на одной ферме, не существует
|AD FS функции|Разрешение артефактов SAML. </br></br>**Примечание.** Эта функция не требуется для служб Microsoft Online Services, Microsoft Office 365, Microsoft Exchange или Microsoft Office сценариев SharePoint.|Нет|да
|AD FS функции|Обнаружение воспроизведения токенов SAML и WS-Federation|Нет|да
|Возможности базы данных|Избыточность основной базы данных, реализованная с помощью репликации по запросу, когда один или несколько серверов, на которых размещена доступная только для чтения копия базы данных, запрашивает изменения, внесенные на исходном сервере, на котором размещена доступная для чтения и записи копия базы данных|да|Нет
|Возможности базы данных|Избыточность базы данных с помощью решений с высоким уровнем доступности, таких как отказоустойчивая кластеризация или зеркальное отображение (только на уровне базы данных) **. Примечание.** все топологии развертывания AD FS поддерживают кластеризацию на уровне служб AD FS.|Нет|да

## <a name="sql-server-considerations"></a>Особенности SQL Server
При выборе SQL Server в качестве базы данных конфигурации для развертываемой системы AD FS необходимо учитывать следующие факты о развертывании.

- **Функции SAML и их влияние на размер и рост базы данных**. Если включено разрешение артефактов SAML или обнаружение воспроизведения токенов SAML, AD FS сохраняет информацию в базе данных конфигурации SQL Server для каждого выданного токена AD FS. В результате этого наблюдается незначительный рост базы данных SQL Server, масштабы которого зависят от настроенного периода хранения воспроизведения токена. Каждая запись артефакта имеет размер около 30 килобайт (КБ).

- **Число необходимых для развертывания серверов**. Необходимо добавить по крайней мере один дополнительный сервер (на общее число серверов, необходимых для развертывания инфраструктуры AD FS), которое будет действовать как выделенный узел экземпляра SQL Server. Если планируется использовать отказоустойчивую кластеризацию или зеркальное отображение, чтобы обеспечить отказоустойчивость и масштабируемость базы данных конфигурации SQL Server, необходимо по меньшей мере два сервера SQL Server.

## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>Влияние выбранного типа базы данных конфигурации на аппаратные ресурсы
Влияние аппаратных ресурсов на сервер федерации, развернутый в ферме с использованием внутренней базы данных Windows, и сервер федерации, развернутый на ферме с использованием базы данных SQL Server, незначительно. Однако важно помнить, что при использовании внутренней базы данных Windows для фермы каждый сервер федерации на этой ферме должен сохранять, обслуживать изменения репликации для своей локальной копии базы данных конфигурации AD FS и управлять ими, продолжая при этом обеспечивать нормальное функционирование службы федерации.

В отличие от этого серверы федерации, развернутые на ферме, использующей базу данных SQL Server, не обязательно содержат локальный экземпляр базы данных конфигурации AD FS. Следовательно, требования к аппаратным ресурсам в этом случае несколько ниже.

## <a name="where-to-place-a-federation-server"></a><a name="BKMK_1"></a>Место размещения сервера федерации
В целях безопасности рекомендуется размещать AD FS серверы федерации перед брандмауэром и подключать их к корпоративной сети для предотвращения раскрытия из Интернета. Это важно, так как серверы федерации имеют полную авторизацию для предоставления маркеров безопасности. Следовательно, они должны иметь ту же защиту, что и контроллер домена. В случае компрометации сервера федерации злоумышленник может выдавать полные маркеры доступа всем веб-приложениям и серверам федерации, защищенным AD FS.

> [!NOTE]
> В целях безопасности рекомендуется избегать непосредственного доступа к серверам федерации через Интернет. Рассмотрите возможность предоставления серверам федерации прямого доступа к Интернету только при настройке тестовой среды или в том случае, если у вашей организации нет сети периметра.

Для обычных корпоративных сетей брандмауэр для интрасети устанавливается между корпоративной сетью и сетью периметра, а брандмауэр для Интернета часто устанавливается между сетью периметра и Интернетом. В этом случае сервер федерации находится в корпоративной сети и недоступен для интернет-клиентов напрямую.

> [!NOTE]
> Клиентские компьютеры, подключенные к корпоративной сети, могут напрямую взаимодействовать с сервером федерации через встроенную проверку подлинности Windows.

Перед настройкой серверов брандмауэра для использования с AD FS необходимо поместить прокси-сервер федерации в сеть периметра.

## <a name="supported-deployment-topologies"></a>Поддерживаемые топологии развертывания
В следующих разделах описываются различные топологии развертывания, которые можно использовать с AD FS. Здесь же описаны преимущества и ограничения каждой топологии развертывания, что позволяет выбрать наиболее подходящую для конкретных условий ведения бизнеса.

- [Ферма серверов федерации с использованием WID](Federation-Server-Farm-Using-WID.md)

- [Ферма серверов федерации с использованием WID и прокси-серверов](Federation-Server-Farm-Using-WID-and-Proxies.md)

- [Ферма серверов федерации с использованием SQL Server](Federation-Server-Farm-Using-SQL-Server.md)

## <a name="see-also"></a>См. также:
[Руководство по разработке служб федерации Active Directory в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)
