---
ms.assetid: 7e195f5b-b194-40f3-a26d-5cf4ade5fc4d
title: Резервное копирование и восстановление ЦС командлеты Windows PowerShell
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 796c10d36428e088f3c1fffe293fc7c414993eb2
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71389965"
---
# <a name="ca-backup-and-restore-windows-powershell-cmdlets"></a>Резервное копирование и восстановление ЦС командлеты Windows PowerShell

> Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012
> 
> **Автор**: Джастин Тернер, старший инженер по расширению поддержки с группой Windows  
> 
> [!NOTE]
> Этот материал создан инженером службы поддержки клиентов Майкрософт и предназначен для опытных администраторов и архитекторов систем, которым нужны более глубокие технические сведения о функциях и решениях в Windows Server 2012 R2, а не обычная информация, доступная в статьях на сайте TechNet. Однако он не был отредактирован согласно требованиям сайта, поэтому некоторые формулировки могут быть не такими выверенными, как на станицах TechNet.  
  
## <a name="overview"></a>Обзор  
Модуль Адксадминистратион Windows PowerShell появился в Window Server 2012.  В этот модуль в Windows Server 2012 R2 были добавлены два новых командлета для поддержки резервного копирования и восстановления центра сертификации.  
  
-   Backup-CARoleService  
  
-   Restore-CARoleService  
  
## <a name="backup-caroleservice"></a>Backup-CARoleService  
**Таблица SEQ таблица \\\* арабский 17: командлеты Backup и RESTORE Windows PowerShell**  
  
**Командлет Адксадминистратион: Backup-Каролесервице**  
  
|Аргументы — требуются аргументы **полужирного шрифта**|Описание|  
|------------------------------------------------|---------------|  
|**-Path**|-Строка — место для сохранения резервной копии<br />— Это единственный безымянный параметр.<br />-Позиционированный параметр<br /><br />**Пример.**<br /><br />Backup-Каролесервице.-путь c:\adcsbackup1<br /><br />Backup-Каролесервице c:\adcsbackup2|  
|-Кэйонли|— Резервное копирование сертификата ЦС без базы данных;<br /><br />**Пример.**<br /><br />Backup-Каролесервице c:\adcsbackup3-Кэйонли|  
|-Password|— Указывает пароль для защиты сертификатов ЦС и закрытых ключей.<br />— Должна быть защищенной строкой<br />-Недопустимо с параметром-Датабасеонли<br /><br />Пример.<br /><br />Backup-Каролесервице c:\adcsbackup4-пароль (чтение-хост-запрос "пароль:"-AsSecureString)<br /><br />Backup-Каролесервице c:\adcsbackup5 — Password (ConvertTo-SecureString "Pa55w0rd!" -AsPlainText-Force)|  
|-Датабасеонли|— Резервное копирование базы данных без сертификата ЦС;<br /><br />Backup-Каролесервице c:\adcsbackup6-Датабасеонли|  
|-Force|1. позволяет перезаписать резервную копию, которая существует в расположении, указанном в параметре-Path.<br /><br />Backup-Каролесервице c:\adcsbackup1 — Force|  
|-Добавочное|-Выполнить добавочное резервное копирование<br /><br />Backup-Каролесервице c:\adcsbackup7 — добавочный|  
|-Киплог|1. указывает команде на необходимость сохранения файлов журнала. Если параметр не указан, файлы журнала усекаются по умолчанию, за исключением случая добавочного сценария.<br /><br />Backup-Каролесервице c:\adcsbackup7-Киплог|  
  
### <a name="-password-secure-string"></a>-Password <Secure String>  
Если используется параметр-Password, указанный пароль должен быть защищенной строкой.  Используйте командлет **Read-Host** для запуска интерактивного запроса на ввод безопасного пароля или используйте командлет **ConvertTo-SecureString** , чтобы указать пароль в строке.  
  
Ознакомьтесь со следующими примерами.  
  
**Указание защищенной строки для параметра пароля с помощью командлета Read-Host**  
  
```powershell  
Backup-CARoleService c:\adcsbackup4 -Password (Read-Host -prompt "Password:" -AsSecureString)  
```  
  
**Указание защищенной строки для параметра Password с помощью ConvertTo-SecureString**  
  
```powershell  
Backup-CARoleService c:\adcsbackup5 -Password (ConvertTo-SecureString "Pa55w0rd!" -AsPlainText -Force)  
```  
  
## <a name="restore-caroleservice"></a>Restore-CARoleService  
**Командлет Адксадминистратион: Restore-Каролесервице**  
  
|Аргументы — требуются аргументы **полужирного шрифта**|Описание|  
|------------------------------------------------|---------------|  
|**-Path**|-Строка — расположение для восстановления резервной копии<br />— Это единственный безымянный параметр.<br />-Позиционированный параметр<br /><br />**Пример.**<br /><br />Restore-Каролесервице.-path c:\adcsbackup1 — Force<br /><br />Restore-Каролесервице c:\adcsbackup2-Force|  
|-Кэйонли|— Восстановить сертификат ЦС без базы данных;<br />— Необходимо указать, если резервная копия была сделана с параметром-Кэйонли<br /><br />**Пример.**<br /><br />Restore-Каролесервице c:\adcsbackup3-Кэйонли-Force|  
|-Password|— Указывает пароль сертификатов ЦС и закрытых ключей.<br />— Должна быть защищенной строкой<br /><br />**Пример.**<br /><br />Restore-Каролесервице c:\adcsbackup4-Password (чтение-хост-запрос "пароль:"-AsSecureString)-Force<br /><br />Restore-Каролесервице c:\adcsbackup5-Password (ConvertTo-SecureString "Pa55w0rd!" -AsPlainText-Force) — Force|  
|-Датабасеонли|Восстановление базы данных без сертификата ЦС<br /><br />Restore-Каролесервице c:\adcsbackup6-Датабасеонли|  
|-Force|— Позволяет перезаписать существующие ключи<br />— Необязательный параметр, но при восстановлении на месте, скорее всего, требуется<br /><br />Restore-Каролесервице c:\adcsbackup1-Force|  
  
### <a name="issues"></a>Проблемы  
Резервная копия, не защищенная паролем, создается, если функция ConvertTo-SecureString завершается сбоем при использовании параметра Backup-Каролесервице с параметром-password.  
  
![Резервное копирование и восстановление ЦС](media/CA-Backup-and-Restore-Windows-PowerShell-cmdlets/GTR_ADDS_BackupCARole.gif)  
  
**Таблица SEQ таблица \\\* Арабский 18: распространенные ошибки**  
  
|Действие|Ошибка|Примечание|  
|----------|---------|-----------|  
|**Restore-Каролесервице К:\адксбаккуп**|Restore-Каролесервице: процесс не может получить доступ к файлу, так как он используется другим процессом. (Исключение из HRESULT:<br /><br />0x80070020|Перед запуском командлета Restore-Каролесервице завершите работу службы служб сертификатов Active Directory|  
|**Restore-Каролесервице К:\адксбаккуп**|Restore-Каролесервице: Каталог не пуст. (Исключение из HRESULT: 0x80070091)|Используйте параметр-Force для перезаписи существующих ключей|  
|**Backup-Каролесервице К:\адксбаккуп-пароль (чтение-хост-запрос "пароль:"-AsSecureString)-Датабасеонли**|Backup-Каролесервице: не удается разрешить набор параметров с использованием указанных именованных параметров.|Параметр-Password используется только для защиты паролем закрытых ключей и, следовательно, является недопустимым, если архивация не выполняется|  
|**Restore-Каролесервице C:\ADCSBack15-Password (чтение-хост-запрос "пароль:"-AsSecureString)-Датабасеонли**|Restore-Каролесервице: не удается разрешить набор параметров с помощью указанных именованных параметров.|Параметр-Password используется только для защиты паролем закрытых ключей и поэтому является недопустимым, если вы не восстанавливаете их.|  
|**Restore-Каролесервице C:\ADCSBack14-Password (чтение-хост-запрос "пароль:"-AsSecureString)**|Restore-Каролесервице: системе не удается найти указанный файл. (Исключение из HRESULT: 0x80070002)|Указанный путь не содержит допустимой резервной копии базы данных.  Возможно, путь является недопустимым или резервная копия была сделана с параметром-Кэйсонли?|  
  
## <a name="additional-resources"></a>Дополнительные ресурсы  
[Руководство по переносу служб сертификатов Active Directory](https://technet.microsoft.com/library/ee126170(v=ws.10).aspx)  
  
[Резервное копирование базы данных и закрытого ключа ЦС](https://technet.microsoft.com/library/ee126140(v=ws.10).aspx#BKMK_BackUpDB)  
  
[Восстановление базы данных и конфигурации ЦС на сервере назначения](https://technet.microsoft.com/library/ee126140(v=ws.10).aspx#BKMK_RestoreCA)  
  
## <a name="try-this-backup-the-ca-in-your-lab-using-windows-powershell"></a>Попробуйте сделать это: Создайте резервную копию центра сертификации в лаборатории с помощью Windows PowerShell  
  
1.  Используйте команды на этом занятии, чтобы создать резервную копию базы данных ЦС и закрытого ключа, защищенных паролем.  
  
2.  Подождите, пока не будет восстановлен ЦС.  
  


